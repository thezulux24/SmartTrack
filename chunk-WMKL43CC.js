import{a as N}from"./chunk-SXTDX4H3.js";import{a as j}from"./chunk-XSDINV7M.js";import{g as z,j as D,p as H,t as F}from"./chunk-3OSVPALZ.js";import{$ as p,Ab as L,Bb as m,Ia as l,Nb as V,Pb as A,S as v,Sa as M,Xa as b,Y as C,Z as w,_ as c,cb as S,ib as x,la as f,lb as y,m as k,mb as E,nb as t,ob as i,pb as s,qb as T,tb as _,ub as h,zb as o}from"./chunk-MBDN4FSM.js";import"./chunk-X5YLR3NI.js";import{a as K,b as P,i as u}from"./chunk-ODN5LVDJ.js";var $=(r,n)=>n.id;function G(r,n){r&1&&(t(0,"div",25)(1,"div",29),s(2,"div",30),i()())}function B(r,n){r&1&&(t(0,"div",26),c(),t(1,"svg",31),s(2,"path",32),i(),p(),t(3,"h3",33),o(4,"No hay kits pendientes"),i(),t(5,"p",34),o(6,"Todos los kits han sido procesados"),i()())}function R(r,n){if(r&1&&(t(0,"div",51)(1,"strong"),o(2,"Observaciones:"),i(),o(3),i()),r&2){let e=h().$implicit;l(3),m(" ",e.observaciones," ")}}function O(r,n){r&1&&(t(0,"span",69),o(1," OK "),i())}function q(r,n){r&1&&(t(0,"span",70),o(1," Sin Stock "),i())}function J(r,n){if(r&1&&(t(0,"tr",62)(1,"td",67),o(2),i(),t(3,"td",67),o(4),i(),t(5,"td",67),o(6),i(),t(7,"td",68),b(8,O,2,0,"span",69)(9,q,2,0,"span",70),i()()),r&2){let e=n.$implicit,a=h(3);l(2),m(" ",(e.producto==null?null:e.producto.nombre)||"N/A"," "),l(2),m(" ",e.cantidad_solicitada," "),l(2),m(" ",a.calcularStockTotal(e)," "),l(2),x(a.tieneStockSuficiente(e)?8:9)}}function Q(r,n){r&1&&(c(),t(0,"svg",66),s(1,"circle",71)(2,"path",72),i())}function U(r,n){if(r&1){let e=T();t(0,"div",35)(1,"div",36)(2,"div",37)(3,"div",38)(4,"div",39)(5,"h3",40),o(6),i(),t(7,"span",41),o(8," PENDIENTE "),i()(),t(9,"div",42)(10,"div",43),c(),t(11,"svg",44),s(12,"path",45),i(),p(),t(13,"span",46)(14,"strong",47),o(15,"Cirug\xEDa:"),i(),o(16),i()(),t(17,"div",43),c(),t(18,"svg",44),s(19,"path",48),i(),p(),t(20,"span",46)(21,"strong",47),o(22,"Cliente:"),i(),o(23),i()(),t(24,"div",43),c(),t(25,"svg",44),s(26,"path",49),i(),p(),t(27,"span",46)(28,"strong",47),o(29,"Fecha:"),i(),o(30),V(31,"date"),i()(),t(32,"div",43),c(),t(33,"svg",44),s(34,"path",50),i(),p(),t(35,"span",46)(36,"strong",47),o(37,"Hospital:"),i(),o(38),i()()(),b(39,R,4,1,"div",51),i()(),t(40,"div",52)(41,"h4",53),c(),t(42,"svg",54),s(43,"path",55),i(),o(44),i(),p(),t(45,"div",56)(46,"div",57)(47,"table",58)(48,"thead",59)(49,"tr")(50,"th",60),o(51,"Producto"),i(),t(52,"th",60),o(53,"Cant."),i(),t(54,"th",60),o(55,"Stock"),i(),t(56,"th",60),o(57,"Estado"),i()()(),t(58,"tbody",61),y(59,J,10,4,"tr",62,$),i()()()()(),t(61,"div",63)(62,"button",64),_("click",function(){let g=C(e).$implicit,d=h(2);return w(d.rechazarKit(g.id))}),o(63," Rechazar "),i(),t(64,"button",65),_("click",function(){let g=C(e).$implicit,d=h(2);return w(d.aprobarKit(g.id))}),b(65,Q,3,0,":svg:svg",66),o(66," Aprobar y Preparar "),i()()()()}if(r&2){let e=n.$implicit,a=h(2);l(6),L(e.numero_kit),l(10),m(" ",(e.cirugia==null?null:e.cirugia.numero_cirugia)||"N/A",""),l(7),m(" ",a.obtenerNombreCliente(e),""),l(7),m(" ",A(31,10,e.cirugia==null?null:e.cirugia.fecha_programada,"dd/MM/yyyy HH:mm"),""),l(8),m(" ",(e.cirugia==null||e.cirugia.hospital==null?null:e.cirugia.hospital.nombre)||"N/A",""),l(),x(e.observaciones?39:-1),l(5),m(" Productos Solicitados (",(e.productos==null?null:e.productos.length)||0,") "),l(15),E(e.productos),l(3),S("disabled",a.procesando()),l(2),S("disabled",a.procesando()),l(),x(a.procesando()?65:-1)}}function W(r,n){if(r&1&&(t(0,"div",27),y(1,U,67,13,"div",35,$),i()),r&2){let e=h();l(),E(e.kitsPendientes())}}var I=class r{router=v(H);kitService=v(j);productosService=v(N);kitsPendientes=f([]);loading=f(!0);procesando=f(!1);ngOnInit(){this.cargarKitsPendientes()}cargarKitsPendientes(){return u(this,null,function*(){try{this.loading.set(!0),console.log("Cargando kits con estado: solicitado"),this.kitService.getKitsPorEstado("solicitado").subscribe({next:n=>u(this,null,function*(){console.log("Kits recibidos:",n.length,n);let e=yield Promise.all(n.map(a=>u(this,null,function*(){let g=yield Promise.all((a.productos||[]).map(d=>u(this,null,function*(){return{id:d.id,producto_id:d.producto_id,nombre:d.producto?.nombre||"N/A",cantidad_solicitada:d.cantidad_solicitada,stock_disponible:d.producto?.stock_total||0,suficiente:(d.producto?.stock_total||0)>=d.cantidad_solicitada}})));return P(K({},a),{productos_con_stock:g})})));console.log("Kits con stock procesados:",e),this.kitsPendientes.set(e),this.loading.set(!1)}),error:n=>{console.error("Error cargando kits pendientes:",n),alert(`Error al cargar kits: ${n.message||"Error desconocido"}`),this.loading.set(!1)}})}catch(n){console.error("Error en cargarKitsPendientes:",n),this.loading.set(!1)}})}aprobarKit(n){return u(this,null,function*(){if(!this.procesando())try{this.procesando.set(!0),console.log("Aprobando kit:",n),yield k(this.kitService.actualizarEstadoKit(n,"preparando",{observaciones:"Kit aprobado por log\xEDstica"})),console.log("Kit aprobado exitosamente"),this.router.navigate(["/internal/logistica/kit-preparacion",n])}catch(e){console.error("Error aprobando kit:",e),alert("Error al aprobar el kit"),this.procesando.set(!1)}})}rechazarKit(n){return u(this,null,function*(){if(this.procesando())return;let e=prompt("\xBFPor qu\xE9 rechazas este kit?");if(e)try{this.procesando.set(!0),console.log("Rechazando kit:",n,"Motivo:",e),yield k(this.kitService.actualizarEstadoKit(n,"cancelado",{observaciones:`Rechazado por log\xEDstica: ${e}`})),console.log("Kit rechazado exitosamente"),yield this.cargarKitsPendientes()}catch(a){console.error("Error rechazando kit:",a),alert("Error al rechazar el kit")}finally{this.procesando.set(!1)}})}obtenerNombreCliente(n){let e=n.cirugia?.cliente;return e?`${e.nombre} ${e.apellido}`:"N/A"}obtenerNombreHospital(n){return n.cirugia?.hospital?.nombre||"N/A"}calcularStockTotal(n){return n?.producto?.inventario?n.producto.inventario.filter(e=>e.estado==="disponible").reduce((e,a)=>e+(a.cantidad||0),0):0}tieneStockSuficiente(n){return this.calcularStockTotal(n)>=n.cantidad_solicitada}volver(){this.router.navigate(["/internal/logistica"])}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=M({type:r,selectors:[["app-kits-pendientes-list"]],decls:32,vars:3,consts:[[1,"min-h-screen","relative","overflow-hidden"],[1,"absolute","inset-0","z-0"],[1,"absolute","inset-0","bg-[#10284C]"],["xmlns","http://www.w3.org/2000/svg",1,"absolute","w-full","h-full"],["cx","10%","cy","15%","r","120","fill","#0098A8","opacity","0.1"],["cx","85%","cy","25%","r","180","fill","#C8D900","opacity","0.08"],["cx","50%","cy","80%","r","150","fill","#0098A8","opacity","0.12"],["x","60%","y","5%","width","200","height","200","fill","#0098A8","opacity","0.06","transform","rotate(45 70 15)"],["x","15%","y","65%","width","160","height","160","fill","#C8D900","opacity","0.08","transform","rotate(30 20 70)"],["x1","0%","y1","30%","x2","100%","y2","35%","stroke","#0098A8","stroke-width","2","opacity","0.1"],["x1","0%","y1","60%","x2","100%","y2","55%","stroke","#C8D900","stroke-width","2","opacity","0.08"],["points","90,10 95,25 85,25","fill","#0098A8","opacity","0.1","transform","scale(8)"],["points","5,85 12,95 2,98","fill","#C8D900","opacity","0.09","transform","scale(10)"],[1,"absolute","inset-0","bg-gradient-to-b","from-[#10284C]/50","via-[#10284C]/80","to-[#10284C]/95"],[1,"relative","z-10","px-4","py-6"],[1,"max-w-7xl","mx-auto","space-y-6"],[1,"flex","flex-col","sm:flex-row","justify-between","items-center","gap-4"],["src","logo.webp","alt","Implameq",1,"h-10","w-auto","brightness-0","invert"],[1,"px-4","py-2","bg-[#C8D900]","text-[#10284C]","rounded-lg","hover:bg-[#d4e820]","transition-colors","font-medium","flex","items-center","gap-2","active:scale-95",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"hidden","sm:inline"],[1,"text-center"],[1,"text-3xl","sm:text-4xl","font-bold","text-[#C8D900]","mb-2"],[1,"text-white/80","text-sm"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","p-6","shadow-xl"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","p-12","text-center","shadow-xl"],[1,"space-y-4"],[1,"h-6"],[1,"flex","justify-center","items-center","h-64"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-[#C8D900]"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-24","h-24","mx-auto","text-[#C8D900]/50","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-xl","font-semibold","text-white","mb-2"],[1,"text-white/70"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","shadow-xl","hover:bg-[#0098A8]/25","transition-all","duration-200"],[1,"p-4","md:p-6"],[1,"flex","items-start","justify-between","mb-4"],[1,"flex-1"],[1,"flex","items-center","gap-3","mb-2","flex-wrap"],[1,"text-lg","md:text-xl","font-bold","text-white"],[1,"px-3","py-1","bg-yellow-500/30","text-[#C8D900]","text-xs","font-semibold","rounded-full","border","border-[#C8D900]/40"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3","text-sm","text-white/80"],[1,"flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","flex-shrink-0","text-[#C8D900]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],[1,"truncate"],[1,"text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"mt-3","p-3","bg-[#0098A8]/30","border","border-[#0098A8]/50","rounded-lg","text-sm","text-white","backdrop-blur-sm"],[1,"mt-4"],[1,"font-semibold","text-white","mb-3","flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-[#C8D900]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"],[1,"overflow-x-auto","-mx-4","md:mx-0","border","border-white/20","rounded-lg","backdrop-blur-sm"],[1,"inline-block","min-w-full","align-middle","px-4","md:px-0"],[1,"min-w-full","divide-y","divide-white/10"],[1,"bg-[#0098A8]/30"],[1,"px-3","md:px-4","py-3","text-left","text-xs","font-medium","text-white/90","uppercase","tracking-wider"],[1,"bg-[#10284C]/40","divide-y","divide-white/10"],[1,"hover:bg-white/5","transition-colors"],[1,"mt-6","flex","flex-col","sm:flex-row","items-stretch","sm:items-center","justify-end","gap-3"],[1,"px-6","py-2","bg-red-500/20","text-red-300","border","border-red-400/40","rounded-lg","hover:bg-red-500/30","disabled:opacity-50","disabled:cursor-not-allowed","transition-all","shadow-lg","text-center","active:scale-95","font-semibold",3,"click","disabled"],[1,"px-6","py-2","bg-[#C8D900]","text-[#10284C]","rounded-lg","hover:bg-[#d4e820]","disabled:opacity-50","disabled:cursor-not-allowed","transition-all","shadow-lg","flex","items-center","justify-center","gap-2","active:scale-95","font-semibold",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4"],[1,"px-3","md:px-4","py-3","text-sm","text-white/90"],[1,"px-3","md:px-4","py-3","text-sm"],[1,"px-2","py-1","bg-green-500/30","text-green-300","text-xs","font-semibold","rounded","border","border-green-400/40"],[1,"px-2","py-1","bg-red-500/30","text-red-300","text-xs","font-semibold","rounded","border","border-red-400/40"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(e,a){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2),c(),t(3,"svg",3),s(4,"circle",4)(5,"circle",5)(6,"circle",6)(7,"rect",7)(8,"rect",8)(9,"line",9)(10,"line",10)(11,"polygon",11)(12,"polygon",12),i()(),p(),s(13,"div",13),i(),t(14,"main",14)(15,"div",15)(16,"div",16),s(17,"img",17),t(18,"button",18),_("click",function(){return a.volver()}),c(),t(19,"svg",19),s(20,"path",20),i(),p(),t(21,"span",21),o(22,"Volver"),i()()(),t(23,"div",22)(24,"h1",23),o(25,"Kits Pendientes"),i(),t(26,"p",24),o(27,"Revisa y aprueba los kits solicitados por comercial"),i()(),b(28,G,3,0,"div",25)(29,B,7,0,"div",26)(30,W,3,0,"div",27),s(31,"div",28),i()()()),e&2&&(l(28),x(a.loading()?28:-1),l(),x(!a.loading()&&a.kitsPendientes().length===0?29:-1),l(),x(!a.loading()&&a.kitsPendientes().length>0?30:-1))},dependencies:[D,z,F],encapsulation:2})};export{I as KitsPendientesListComponent};
