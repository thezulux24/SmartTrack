import{a as Q,b as U}from"./chunk-MSYAIIH4.js";import{a as K}from"./chunk-HEZGMVBA.js";import"./chunk-C4VFUW4K.js";import{a as R,c as W,g as $,o as G,p as P,q as Z,x as J}from"./chunk-V2VKRV3B.js";import{c as N,e as O,j as B,p as j,q as H,t as q}from"./chunk-3OSVPALZ.js";import{$ as f,Ab as _,Bb as p,Cb as A,Eb as E,Fb as y,Gb as L,Ia as l,Ib as k,Mb as D,S as w,Sa as T,Xa as g,Y as u,Yb as V,Z as x,_ as b,cb as v,ib as C,la as S,lb as F,mb as I,nb as i,ob as n,pb as m,qb as h,tb as z,ub as s,zb as o}from"./chunk-MBDN4FSM.js";import"./chunk-X5YLR3NI.js";import{i as M}from"./chunk-ODN5LVDJ.js";var Y=()=>["/internal"],ee=()=>["nueva"],te=(r,t,e,a,d,c)=>({"bg-gray-500/20 text-gray-700 border border-gray-500/30":r,"bg-blue-500/20 text-blue-700 border border-blue-500/30":t,"bg-green-500/20 text-green-700 border border-green-500/30":e,"bg-red-500/20 text-red-700 border border-red-500/30":a,"bg-orange-500/20 text-orange-700 border border-orange-500/30":d,"bg-gray-700/20 text-gray-900 border border-gray-700/30":c}),ie=(r,t)=>t.id;function ne(r,t){r&1&&(i(0,"div",3)(1,"div",4)(2,"div",5),m(3,"div",6)(4,"div",7),n(),i(5,"p",8),o(6,"Cargando cotizaciones..."),n()()())}function oe(r,t){r&1&&(i(0,"div",44)(1,"div",45),b(),i(2,"svg",46),m(3,"path",47),n()(),f(),i(4,"p",48),o(5,"No hay cotizaciones"),n(),i(6,"p",49),o(7,"Crea tu primera cotizaci\xF3n para comenzar"),n()())}function ae(r,t){if(r&1&&(i(0,"span",56),o(1),n()),r&2){let e=s().$implicit,a=s(3);l(),p(" \u23F0 Vence en ",a.diasHastaVencimiento(e.fecha_vencimiento)," d\xEDas ")}}function re(r,t){if(r&1&&(i(0,"p",59),o(1),n()),r&2){let e=s().$implicit;l(),_(e.cliente==null?null:e.cliente.ciudad)}}function le(r,t){if(r&1){let e=h();i(0,"button",64),z("click",function(){u(e);let d=s().$implicit,c=s(3);return x(c.editar(d.id))}),o(1," Editar "),n(),i(2,"button",65),z("click",function(){u(e);let d=s().$implicit,c=s(3);return x(c.eliminar(d.id))}),b(),i(3,"svg",66),m(4,"path",67),n()()}}function de(r,t){if(r&1){let e=h();i(0,"div",50)(1,"div",51)(2,"div",52)(3,"div",53)(4,"h3",54),o(5),n(),i(6,"span",55),o(7),n(),g(8,ae,2,1,"span",56),n(),i(9,"div",57)(10,"p",58),o(11),n(),g(12,re,2,1,"p",59),i(13,"p",59),o(14),n()()(),i(15,"div",60)(16,"p",61),o(17),n()()(),i(18,"div",62)(19,"button",63),z("click",function(){let d=u(e).$implicit,c=s(3);return x(c.verDetalle(d.id))}),o(20," Ver Detalle "),n(),g(21,le,5,0),n()()}if(r&2){let e=t.$implicit,a=s(3);l(5),_(e.numero_cotizacion),l(),v("ngClass",D(10,te,e.estado==="borrador",e.estado==="enviada",e.estado==="aprobada",e.estado==="rechazada",e.estado==="vencida",e.estado==="cancelada")),l(),p(" ",a.getEstadoLabel(e.estado)," "),l(),C(e.estado==="enviada"&&a.diasHastaVencimiento(e.fecha_vencimiento)<=3?8:-1),l(3),_(a.getClienteNombre(e)),l(),C(e.cliente!=null&&e.cliente.ciudad?12:-1),l(2),A(" Emisi\xF3n: ",a.formatFecha(e.fecha_emision)," | Vence: ",a.formatFecha(e.fecha_vencimiento)," "),l(3),_(a.formatMoneda(e.total)),l(4),C(e.estado==="borrador"?21:-1)}}function se(r,t){if(r&1&&(i(0,"div",29),F(1,de,22,17,"div",50,ie),n()),r&2){let e=s(2);l(),I(e.cotizacionesFiltradas())}}function ce(r,t){if(r&1){let e=h();i(0,"div")(1,"div",9),m(2,"div",10),i(3,"div",11)(4,"div",12)(5,"div",13)(6,"div"),m(7,"img",14),n(),i(8,"div",15)(9,"button",16),b(),i(10,"svg",17),m(11,"path",18),n()()()(),f(),i(12,"div",19)(13,"h1",20),o(14,"Cotizaciones"),n(),i(15,"p",21),o(16,"Gestiona cotizaciones enviadas a clientes"),n()(),i(17,"div",22)(18,"div",23)(19,"div",24),o(20),n(),i(21,"div",25),o(22,"Total"),n()(),i(23,"div",23)(24,"div",24),o(25),n(),i(26,"div",25),o(27,"Borradores"),n()(),i(28,"div",23)(29,"div",24),o(30),n(),i(31,"div",25),o(32,"Enviadas"),n()(),i(33,"div",23)(34,"div",24),o(35),n(),i(36,"div",25),o(37,"Aprobadas"),n()()(),i(38,"button",26),o(39," + Nueva Cotizaci\xF3n "),n(),i(40,"div",27)(41,"h3",28),o(42,"Filtros"),n(),i(43,"div",29)(44,"div")(45,"label",30),o(46,"Buscar"),n(),i(47,"div",9)(48,"input",31),L("ngModelChange",function(d){u(e);let c=s();return y(c.busqueda,d)||(c.busqueda=d),x(d)}),n(),b(),i(49,"svg",32),m(50,"path",33),n()()(),f(),i(51,"div")(52,"label",30),o(53,"Estado"),n(),i(54,"select",34),L("ngModelChange",function(d){u(e);let c=s();return y(c.filtroEstado,d)||(c.filtroEstado=d),x(d)}),i(55,"option",35),o(56,"Todos los estados"),n(),i(57,"option",36),o(58,"Borrador"),n(),i(59,"option",37),o(60,"Enviada"),n(),i(61,"option",38),o(62,"Aprobada"),n(),i(63,"option",39),o(64,"Rechazada"),n(),i(65,"option",40),o(66,"Vencida"),n(),i(67,"option",41),o(68,"Cancelada"),n()()()()()()()(),i(69,"div",42)(70,"div",43),g(71,oe,8,0,"div",44)(72,se,3,0,"div",29),n()()()}if(r&2){let e=s();l(9),v("routerLink",k(9,Y)),l(11),p(" ",e.stats().total.toString().padStart(2,"0")," "),l(5),p(" ",e.stats().borradores.toString().padStart(2,"0")," "),l(5),p(" ",e.stats().enviadas.toString().padStart(2,"0")," "),l(5),p(" ",e.stats().aprobadas.toString().padStart(2,"0")," "),l(3),v("routerLink",k(10,ee)),l(10),E("ngModel",e.busqueda),l(6),E("ngModel",e.filtroEstado),l(17),C(e.cotizacionesFiltradas().length===0?71:72)}}var X=class r{cotizacionService=w(K);router=w(j);cotizaciones=S([]);loading=S(!0);filtroEstado="todos";busqueda="";cotizacionesFiltradas=V(()=>{let t=this.cotizaciones();this.filtroEstado!=="todos"&&(t=t.filter(a=>a.estado===this.filtroEstado));let e=this.busqueda.toLowerCase();return e&&(t=t.filter(a=>a.numero_cotizacion.toLowerCase().includes(e)||a.cliente?.nombre.toLowerCase().includes(e)||a.cliente?.apellido.toLowerCase().includes(e))),t});estadosDisponibles=[{value:"todos",label:"Todas"},{value:"borrador",label:"Borradores"},{value:"enviada",label:"Enviadas"},{value:"aprobada",label:"Aprobadas"},{value:"rechazada",label:"Rechazadas"},{value:"vencida",label:"Vencidas"},{value:"cancelada",label:"Canceladas"}];stats=V(()=>{let t=this.cotizaciones();return{total:t.length,borradores:t.filter(e=>e.estado==="borrador").length,enviadas:t.filter(e=>e.estado==="enviada").length,aprobadas:t.filter(e=>e.estado==="aprobada").length,rechazadas:t.filter(e=>e.estado==="rechazada").length,vencidas:t.filter(e=>e.estado==="vencida").length}});ngOnInit(){this.cargarCotizaciones()}cargarCotizaciones(){this.loading.set(!0),this.cotizacionService.getCotizaciones().subscribe({next:t=>{this.cotizaciones.set(t),this.loading.set(!1)},error:t=>{console.error("Error cargando cotizaciones:",t),this.loading.set(!1)}})}verDetalle(t){this.router.navigate(["/internal/cotizaciones",t])}crearNueva(){this.router.navigate(["/internal/cotizaciones/nueva"])}editar(t){this.router.navigate(["/internal/cotizaciones/editar",t])}eliminar(t){return M(this,null,function*(){let e=this.cotizaciones().find(d=>d.id===t);if(!e)return;if(e.estado!=="borrador"){alert("Solo se pueden eliminar cotizaciones en borrador");return}if(!confirm(`\xBFEliminar cotizaci\xF3n ${e.numero_cotizacion}?`))return;let a=yield this.cotizacionService.deleteCotizacion(e.id);a.exito?(alert("Cotizaci\xF3n eliminada exitosamente"),this.cargarCotizaciones()):alert(a.mensaje||"Error al eliminar")})}getEstadoLabel(t){return Q[t]}getEstadoColor(t){return U[t]}getEstadoBadgeClass(t){return{borrador:"bg-gray-500/20 text-gray-300 border-gray-500/30",enviada:"bg-blue-500/20 text-blue-300 border-blue-500/30",aprobada:"bg-green-500/20 text-green-300 border-green-500/30",rechazada:"bg-red-500/20 text-red-300 border-red-500/30",vencida:"bg-orange-500/20 text-orange-300 border-orange-500/30",cancelada:"bg-gray-500/20 text-gray-400 border-gray-500/30"}[t]}formatMoneda(t){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(t)}formatFecha(t){return new Date(t).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric"})}diasHastaVencimiento(t){let e=new Date,d=new Date(t).getTime()-e.getTime();return Math.ceil(d/(1e3*60*60*24))}esProximaAVencer(t){if(t.estado!=="enviada")return!1;let e=this.diasHastaVencimiento(t.fecha_vencimiento);return e>=0&&e<=3}getClienteNombre(t){return t.cliente?`${t.cliente.nombre} ${t.cliente.apellido}`:"N/A"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=T({type:r,selectors:[["app-cotizaciones-list"]],decls:3,vars:2,consts:[[1,"min-h-screen","bg-white"],["class","flex items-center justify-center min-h-screen",4,"ngIf"],[4,"ngIf"],[1,"flex","items-center","justify-center","min-h-screen"],[1,"text-center"],[1,"animate-pulse","space-y-4"],[1,"h-4","bg-gray-200","rounded","w-64","mx-auto"],[1,"h-4","bg-gray-200","rounded","w-48","mx-auto"],[1,"text-sm","text-gray-500","mt-4"],[1,"relative"],[1,"absolute","top-0","left-0","w-full","bg-[#10284C]",2,"height","720px","clip-path","polygon(0 0, 100% 0, 100% 60%, 0 90%)"],[1,"relative","z-10","px-4","py-6"],[1,"max-w-lg","mx-auto"],[1,"flex","justify-between","items-center","mb-8"],["src","https://www.implameq.com/wp-content/uploads/logotipo-impla-300x78.png.webp","alt","Implameq",1,"h-8","brightness-0","invert"],[1,"flex","items-center","space-x-3"],[1,"w-10","h-10","bg-[#C8D900]","rounded-lg","flex","items-center","justify-center","shadow-lg",3,"routerLink"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-[#10284C]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"],[1,"text-center","mb-8"],[1,"text-3xl","font-bold","text-[#C8D900]","mb-2"],[1,"text-white/90","text-sm"],[1,"grid","grid-cols-2","gap-4","mb-6"],[1,"bg-[#0098A8]","rounded-2xl","p-4","shadow-lg"],[1,"text-3xl","font-bold","text-[#C8D900]","mb-1"],[1,"text-white","text-sm"],[1,"w-full","bg-[#C8D900]","hover:bg-[#B8C900]","text-[#10284C]","font-bold","py-4","rounded-2xl","shadow-lg","transition-colors",3,"routerLink"],[1,"bg-[#0098A8]","rounded-2xl","p-5","mt-6","shadow-lg"],[1,"text-[#10284C]","font-bold","text-lg","mb-4"],[1,"space-y-4"],[1,"block","text-[#10284C]","text-sm","mb-2","font-medium"],["type","text","placeholder","N\xFAmero, cliente...",1,"w-full","px-4","py-2.5","bg-[#0098A8]/50","border","border-white/30","rounded-lg","text-white","placeholder-white/60","focus:outline-none","focus:ring-2","focus:ring-white/50",3,"ngModelChange","ngModel"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"absolute","right-3","top-1/2","-translate-y-1/2","w-5","h-5","text-white/60"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"w-full","px-4","py-2.5","bg-[#0098A8]/50","border","border-white/30","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-white/50",3,"ngModelChange","ngModel"],["value","todos"],["value","borrador"],["value","enviada"],["value","aprobada"],["value","rechazada"],["value","vencida"],["value","cancelada"],[1,"px-4","pb-8"],[1,"max-w-4xl","mx-auto"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","p-8","text-center"],[1,"text-[#0098A8]","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-[#10284C]","text-lg","font-semibold"],[1,"text-gray-600","text-sm","mt-1"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","p-6","shadow-xl","hover:shadow-2xl","hover:border-[#C8D900]/50","transition-all"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"flex","items-center","gap-3","mb-3"],[1,"text-[#10284C]","font-bold","text-lg"],[1,"px-3","py-1","rounded-lg","text-xs","font-semibold","uppercase",3,"ngClass"],[1,"bg-red-500/20","text-red-700","border","border-red-500/30","px-3","py-1","rounded-lg","text-xs","font-semibold"],[1,"space-y-1"],[1,"text-[#10284C]","font-semibold"],[1,"text-gray-600","text-sm"],[1,"text-right","ml-4"],[1,"text-[#C8D900]","text-2xl","font-bold"],[1,"flex","gap-2","mt-4","pt-4","border-t","border-white/10"],[1,"flex-1","bg-[#10284C]","hover:bg-[#10284C]/90","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],[1,"flex-1","bg-[#0098A8]","hover:bg-[#0098A8]/90","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],[1,"bg-red-600","hover:bg-red-700","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(e,a){e&1&&(i(0,"div",0),g(1,ne,7,0,"div",1)(2,ce,73,11,"div",2),n()),e&2&&(l(),v("ngIf",a.loading()),l(),v("ngIf",!a.loading()))},dependencies:[B,N,O,q,H,J,P,Z,R,G,W,$],encapsulation:2})};export{X as CotizacionesListComponent};
