import{a as I}from"./chunk-ZDERLOIW.js";import{a as A}from"./chunk-COD32GTM.js";import"./chunk-AF4TJ6YQ.js";import{$ as _,Ba as H,D as v,Da as F,F as l,Ha as N,I as M,Ka as j,M as h,P as w,S as g,V as C,W as E,X as t,Y as i,Z as s,_ as T,aa as x,ca as r,da as L,e as f,ea as c,oa as V,qa as z,t as k,v as y,w as S,x as m,y as p}from"./chunk-CV56RX3B.js";import"./chunk-LJ5XHLMQ.js";import{a as K,b as P,h as u}from"./chunk-FK42CRUA.js";var G=(o,n)=>n.id;function B(o,n){o&1&&(t(0,"div",15)(1,"div",18),s(2,"div",19),i()())}function D(o,n){o&1&&(t(0,"div",16),m(),t(1,"svg",20),s(2,"path",21),i(),p(),t(3,"h3",22),r(4,"No hay kits pendientes"),i(),t(5,"p",23),r(6,"Todos los kits han sido procesados"),i()())}function R(o,n){if(o&1&&(t(0,"div",39)(1,"strong"),r(2,"Observaciones:"),i(),r(3),i()),o&2){let e=x().$implicit;l(3),c(" ",e.observaciones," ")}}function O(o,n){o&1&&(t(0,"span",56),r(1," OK "),i())}function q(o,n){o&1&&(t(0,"span",57),r(1," Sin Stock "),i())}function J(o,n){if(o&1&&(t(0,"tr")(1,"td",54),r(2),i(),t(3,"td",54),r(4),i(),t(5,"td",54),r(6),i(),t(7,"td",55),h(8,O,2,0,"span",56)(9,q,2,0,"span",57),i()()),o&2){let e=n.$implicit,a=x(3);l(2),c(" ",(e.producto==null?null:e.producto.nombre)||"N/A"," "),l(2),c(" ",e.cantidad_solicitada," "),l(2),c(" ",a.calcularStockTotal(e)," "),l(2),g(a.tieneStockSuficiente(e)?8:9)}}function Q(o,n){o&1&&(m(),t(0,"svg",53),s(1,"circle",58)(2,"path",59),i())}function U(o,n){if(o&1){let e=T();t(0,"div",24)(1,"div",25)(2,"div",26)(3,"div",27)(4,"div",28)(5,"h3",29),r(6),i(),t(7,"span",30),r(8," PENDIENTE "),i()(),t(9,"div",31)(10,"div",32),m(),t(11,"svg",33),s(12,"path",34),i(),p(),t(13,"span",35)(14,"strong"),r(15,"Cirug\xEDa:"),i(),r(16),i()(),t(17,"div",32),m(),t(18,"svg",33),s(19,"path",36),i(),p(),t(20,"span",35)(21,"strong"),r(22,"Cliente:"),i(),r(23),i()(),t(24,"div",32),m(),t(25,"svg",33),s(26,"path",37),i(),p(),t(27,"span",35)(28,"strong"),r(29,"Fecha:"),i(),r(30),V(31,"date"),i()(),t(32,"div",32),m(),t(33,"svg",33),s(34,"path",38),i(),p(),t(35,"span",35)(36,"strong"),r(37,"Hospital:"),i(),r(38),i()()(),h(39,R,4,1,"div",39),i()(),t(40,"div",40)(41,"h4",41),m(),t(42,"svg",42),s(43,"path",43),i(),r(44),i(),p(),t(45,"div",44)(46,"div",45)(47,"table",46)(48,"thead",47)(49,"tr")(50,"th",48),r(51,"Producto"),i(),t(52,"th",48),r(53,"Cant."),i(),t(54,"th",48),r(55,"Stock"),i(),t(56,"th",48),r(57,"Estado"),i()()(),t(58,"tbody",49),C(59,J,10,4,"tr",null,G),i()()()()(),t(61,"div",50)(62,"button",51),_("click",function(){let b=y(e).$implicit,d=x(2);return S(d.rechazarKit(b.id))}),r(63," Rechazar "),i(),t(64,"button",52),_("click",function(){let b=y(e).$implicit,d=x(2);return S(d.aprobarKit(b.id))}),h(65,Q,3,0,":svg:svg",53),r(66," Aprobar y Preparar "),i()()()()}if(o&2){let e=n.$implicit,a=x(2);l(6),L(e.numero_kit),l(10),c(" ",(e.cirugia==null?null:e.cirugia.numero_cirugia)||"N/A",""),l(7),c(" ",a.obtenerNombreCliente(e),""),l(7),c(" ",z(31,10,e.cirugia==null?null:e.cirugia.fecha_programada,"dd/MM/yyyy HH:mm"),""),l(8),c(" ",(e.cirugia==null||e.cirugia.hospital==null?null:e.cirugia.hospital.nombre)||"N/A",""),l(),g(e.observaciones?39:-1),l(5),c(" Productos Solicitados (",(e.productos==null?null:e.productos.length)||0,") "),l(15),E(e.productos),l(3),w("disabled",a.procesando()),l(2),w("disabled",a.procesando()),l(),g(a.procesando()?65:-1)}}function W(o,n){if(o&1&&(t(0,"div",17),C(1,U,67,13,"div",24,G),i()),o&2){let e=x();l(),E(e.kitsPendientes())}}var $=class o{router=k(N);kitService=k(A);productosService=k(I);kitsPendientes=v([]);loading=v(!0);procesando=v(!1);ngOnInit(){this.cargarKitsPendientes()}cargarKitsPendientes(){return u(this,null,function*(){try{this.loading.set(!0),console.log("Cargando kits con estado: solicitado"),this.kitService.getKitsPorEstado("solicitado").subscribe({next:n=>u(this,null,function*(){console.log("Kits recibidos:",n.length,n);let e=yield Promise.all(n.map(a=>u(this,null,function*(){let b=yield Promise.all((a.productos||[]).map(d=>u(this,null,function*(){return{id:d.id,producto_id:d.producto_id,nombre:d.producto?.nombre||"N/A",cantidad_solicitada:d.cantidad_solicitada,stock_disponible:d.producto?.stock_total||0,suficiente:(d.producto?.stock_total||0)>=d.cantidad_solicitada}})));return P(K({},a),{productos_con_stock:b})})));console.log("Kits con stock procesados:",e),this.kitsPendientes.set(e),this.loading.set(!1)}),error:n=>{console.error("Error cargando kits pendientes:",n),alert(`Error al cargar kits: ${n.message||"Error desconocido"}`),this.loading.set(!1)}})}catch(n){console.error("Error en cargarKitsPendientes:",n),this.loading.set(!1)}})}aprobarKit(n){return u(this,null,function*(){if(!this.procesando())try{this.procesando.set(!0),console.log("Aprobando kit:",n),yield f(this.kitService.actualizarEstadoKit(n,"preparando",{observaciones:"Kit aprobado por log\xEDstica"})),console.log("Kit aprobado exitosamente"),this.router.navigate(["/internal/logistica/kit-preparacion",n])}catch(e){console.error("Error aprobando kit:",e),alert("Error al aprobar el kit"),this.procesando.set(!1)}})}rechazarKit(n){return u(this,null,function*(){if(this.procesando())return;let e=prompt("\xBFPor qu\xE9 rechazas este kit?");if(e)try{this.procesando.set(!0),console.log("Rechazando kit:",n,"Motivo:",e),yield f(this.kitService.actualizarEstadoKit(n,"cancelado",{observaciones:`Rechazado por log\xEDstica: ${e}`})),console.log("Kit rechazado exitosamente"),yield this.cargarKitsPendientes()}catch(a){console.error("Error rechazando kit:",a),alert("Error al rechazar el kit")}finally{this.procesando.set(!1)}})}obtenerNombreCliente(n){let e=n.cirugia?.cliente;return e?`${e.nombre} ${e.apellido}`:"N/A"}obtenerNombreHospital(n){return n.cirugia?.hospital?.nombre||"N/A"}calcularStockTotal(n){return n?.producto?.inventario?n.producto.inventario.filter(e=>e.estado==="disponible").reduce((e,a)=>e+(a.cantidad||0),0):0}tieneStockSuficiente(n){return this.calcularStockTotal(n)>=n.cantidad_solicitada}volver(){this.router.navigate(["/internal/logistica"])}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=M({type:o,selectors:[["app-kits-pendientes-list"]],decls:22,vars:3,consts:[[1,"bg-gray-50","dark:bg-gray-900","min-h-screen"],[1,"bg-gradient-to-r","from-green-600","to-emerald-700","text-white","shadow-lg"],[1,"px-4","py-4"],[1,"flex","justify-between","items-center","mb-3"],[1,"flex","items-center","space-x-3"],["src","https://www.implameq.com/wp-content/uploads/logotipo-impla-300x78.png.webp","alt","Implameq",1,"h-8","brightness-0","invert"],[1,"text-lg","font-semibold"],[1,"bg-white/20","hover:bg-white/30","text-white","px-3","py-2","rounded-lg","text-sm","font-medium","transition","duration-200","shadow-md","backdrop-blur-sm",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-center"],[1,"text-2xl","font-bold","mb-1"],[1,"text-green-100","text-sm"],[1,"px-4","py-6"],[1,"max-w-7xl","mx-auto"],[1,"bg-white","rounded-xl","shadow-md","dark:bg-gray-800","dark:border","dark:border-gray-700","p-6"],[1,"bg-white","rounded-xl","shadow-md","dark:bg-gray-800","dark:border","dark:border-gray-700","p-12","text-center"],[1,"space-y-4"],[1,"flex","justify-center","items-center","h-64"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-green-600"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-24","h-24","mx-auto","text-gray-300","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white","mb-2"],[1,"text-gray-600","dark:text-gray-400"],[1,"bg-white","rounded-xl","shadow-md","dark:bg-gray-800","dark:border","dark:border-gray-700","hover:shadow-lg","transition-all","duration-200"],[1,"p-4","md:p-6"],[1,"flex","items-start","justify-between","mb-4"],[1,"flex-1"],[1,"flex","items-center","gap-3","mb-2","flex-wrap"],[1,"text-lg","md:text-xl","font-bold","text-gray-900","dark:text-white"],[1,"px-3","py-1","bg-yellow-100","dark:bg-yellow-900/30","text-yellow-800","dark:text-yellow-400","text-xs","font-semibold","rounded-full"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3","text-sm","text-gray-600","dark:text-gray-400"],[1,"flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],[1,"truncate"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"mt-3","p-3","bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg","text-sm","text-gray-700","dark:text-gray-300"],[1,"mt-4"],[1,"font-semibold","text-gray-900","dark:text-white","mb-3","flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"],[1,"overflow-x-auto","-mx-4","md:mx-0","border","border-gray-200","dark:border-gray-700","rounded-lg"],[1,"inline-block","min-w-full","align-middle","px-4","md:px-0"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-700"],[1,"bg-gray-50","dark:bg-gray-800"],[1,"px-3","md:px-4","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],[1,"bg-white","dark:bg-gray-800","divide-y","divide-gray-200","dark:divide-gray-700"],[1,"mt-6","flex","flex-col","sm:flex-row","items-stretch","sm:items-center","justify-end","gap-3"],[1,"px-6","py-2","bg-red-600","text-white","rounded-lg","hover:bg-red-700","disabled:bg-gray-300","dark:disabled:bg-gray-700","disabled:cursor-not-allowed","transition-colors","shadow-md","text-center",3,"click","disabled"],[1,"px-6","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","disabled:bg-gray-300","dark:disabled:bg-gray-700","disabled:cursor-not-allowed","transition-colors","shadow-md","flex","items-center","justify-center","gap-2",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4"],[1,"px-3","md:px-4","py-3","text-sm","text-gray-900","dark:text-gray-300"],[1,"px-3","md:px-4","py-3","text-sm"],[1,"px-2","py-1","bg-green-100","dark:bg-green-900/30","text-green-800","dark:text-green-400","text-xs","font-semibold","rounded"],[1,"px-2","py-1","bg-red-100","dark:bg-red-900/30","text-red-800","dark:text-red-400","text-xs","font-semibold","rounded"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(e,a){e&1&&(t(0,"section",0)(1,"header",1)(2,"div",2)(3,"div",3)(4,"div",4),s(5,"img",5),t(6,"span",6),r(7,"Kits Pendientes"),i()(),t(8,"button",7),_("click",function(){return a.volver()}),m(),t(9,"svg",8),s(10,"path",9),i(),r(11," Volver "),i()(),p(),t(12,"div",10)(13,"h1",11),r(14,"Kits Pendientes de Aprobaci\xF3n"),i(),t(15,"p",12),r(16,"Revisa y aprueba los kits solicitados por comercial"),i()()()(),t(17,"main",13)(18,"div",14),h(19,B,3,0,"div",15)(20,D,7,0,"div",16)(21,W,3,0,"div",17),i()()()),e&2&&(l(19),g(a.loading()?19:-1),l(),g(!a.loading()&&a.kitsPendientes().length===0?20:-1),l(),g(!a.loading()&&a.kitsPendientes().length>0?21:-1))},dependencies:[F,H,j],encapsulation:2})};export{$ as KitsPendientesListComponent};
