import{a as K}from"./chunk-ZVCWTZSM.js";import"./chunk-C4VFUW4K.js";import{x as H}from"./chunk-V2VKRV3B.js";import{g as V,j as P,n as O,p as F}from"./chunk-3OSVPALZ.js";import{$ as S,Ab as x,Bb as v,Ia as a,Nb as I,Pb as A,S as h,Sa as D,Xa as u,Y as f,Yb as T,Z as _,_ as j,cb as b,fb as w,ib as p,la as m,lb as M,mb as y,nb as t,ob as i,pb as k,qb as E,tb as g,ub as c,zb as n}from"./chunk-MBDN4FSM.js";import"./chunk-X5YLR3NI.js";import{i as C}from"./chunk-ODN5LVDJ.js";var $=(r,o)=>o.id;function L(r,o){if(r&1&&(t(0,"div",7),n(1),i()),r&2){let e=c();a(),v(" ",e.error()," ")}}function Y(r,o){if(r&1&&(t(0,"div",8),n(1),i()),r&2){let e=c();a(),v(" ",e.exito()," ")}}function B(r,o){if(r&1&&(t(0,"div")(1,"p",19),n(2,"Hospital"),i(),t(3,"p",22),n(4),i(),t(5,"p",23),n(6),i()()),r&2){let e=c(3);a(4),x(e.kitInfo().cirugia.hospital.nombre),a(2),x(e.kitInfo().cirugia.hospital.ciudad)}}function R(r,o){if(r&1&&(t(0,"div")(1,"p",19),n(2,"Cirug\xEDa"),i(),t(3,"p",22),n(4),i()(),u(5,B,7,2,"div"),t(6,"div")(7,"p",19),n(8,"Fecha Cirug\xEDa"),i(),t(9,"p",22),n(10),I(11,"date"),i()(),t(12,"div")(13,"p",19),n(14,"M\xE9dico"),i(),t(15,"p",22),n(16),i()()),r&2){let e=c(2);a(4),x(e.kitInfo().cirugia.numero_cirugia),a(),p(e.kitInfo().cirugia.hospital?5:-1),a(5),x(A(11,4,e.kitInfo().cirugia.fecha_programada,"dd/MM/yyyy HH:mm")),a(6),x(e.kitInfo().cirugia.medico_cirujano)}}function z(r,o){if(r&1&&(t(0,"div",11)(1,"h2",13),n(2,"Informaci\xF3n del Kit"),i(),t(3,"div",18)(4,"div")(5,"p",19),n(6,"N\xFAmero de Kit"),i(),t(7,"p",20),n(8),i()(),u(9,R,17,7),t(10,"div")(11,"p",19),n(12,"Estado Actual"),i(),t(13,"span",21),n(14),i()()()()),r&2){let e=c();a(8),x(e.kitInfo().numero_kit),a(),p(e.kitInfo().cirugia?9:-1),a(5),v(" ",e.kitInfo().estado," ")}}function G(r,o){if(r&1&&(t(0,"div",29)(1,"span",30),n(2,"Placa:"),i(),t(3,"span",33),n(4),i()()),r&2){let e=c().$implicit;a(4),x(e.placa)}}function q(r,o){r&1&&(t(0,"div",32)(1,"span",34),n(2,"\u2713 SELECCIONADO"),i()())}function J(r,o){if(r&1){let e=E();t(0,"div",24),g("click",function(){let s=f(e).$implicit,d=c();return _(d.seleccionarMensajero(s))}),t(1,"div",25)(2,"div",26)(3,"h3",27),n(4),i(),t(5,"p",19),n(6),i()()(),t(7,"div",28),u(8,G,5,1,"div",29),t(9,"div",29)(10,"span",30),n(11,"Estado:"),i(),t(12,"span",31),n(13),i()()(),u(14,q,3,0,"div",32),i()}if(r&2){let e,l,s=o.$implicit,d=c();w(((e=d.mensajeroSeleccionado())==null?null:e.id)===s.id?"bg-[#C8D900]/20 border-[#C8D900] border-2":"bg-white/5 border-white/10 border hover:bg-white/10"),a(4),x(s.nombre),a(2),x(s.telefono),a(2),p(s.placa?8:-1),a(4),w(s.estado==="disponible"?"text-green-400":"text-orange-400"),a(),v(" ",s.estado," "),a(),p(((l=d.mensajeroSeleccionado())==null?null:l.id)===s.id?14:-1)}}function Q(r,o){r&1&&(t(0,"div",16)(1,"p",35),n(2,"No hay mensajeros disponibles"),i(),t(3,"p",36),n(4,"Todos los mensajeros est\xE1n ocupados"),i()())}function U(r,o){r&1&&(t(0,"span"),n(1,"Asignando..."),i())}function W(r,o){r&1&&(t(0,"span"),n(1,"Asignar y Despachar"),i())}function X(r,o){if(r&1){let e=E();t(0,"div",17)(1,"h2",37),n(2,"Detalles del Env\xEDo"),i(),t(3,"div",38)(4,"div")(5,"label",39),n(6," Direcci\xF3n Hospital "),t(7,"span",40),n(8,"*"),i()(),t(9,"input",41),g("input",function(s){f(e);let d=c();return _(d.direccionDestino.set(s.target.value))}),i()(),t(10,"div")(11,"label",39),n(12," Paciente / Contacto "),t(13,"span",40),n(14,"*"),i()(),t(15,"input",42),g("input",function(s){f(e);let d=c();return _(d.contactoDestino.set(s.target.value))}),i()(),t(16,"div")(17,"label",39),n(18," Tel\xE9fono de Contacto "),t(19,"span",40),n(20,"*"),i()(),t(21,"input",43),g("input",function(s){f(e);let d=c();return _(d.telefonoDestino.set(s.target.value))}),i()(),t(22,"div")(23,"label",39),n(24," Fecha Programada "),t(25,"span",40),n(26,"*"),i()(),t(27,"input",44),g("input",function(s){f(e);let d=c();return _(d.fechaProgramada.set(s.target.value))}),i()(),t(28,"div",45)(29,"label",39),n(30,"Observaciones"),i(),t(31,"textarea",46),g("input",function(s){f(e);let d=c();return _(d.observaciones.set(s.target.value))}),i()()(),t(32,"div",47)(33,"button",48),g("click",function(){f(e);let s=c();return _(s.cancelar())}),n(34," Cancelar "),i(),t(35,"button",49),g("click",function(){f(e);let s=c();return _(s.asignarYDespachar())}),u(36,U,2,0,"span")(37,W,2,0,"span"),i()()()}if(r&2){let e=c();a(9),b("value",e.direccionDestino()),a(6),b("value",e.contactoDestino()),a(6),b("value",e.telefonoDestino()),a(6),b("value",e.fechaProgramada()),a(4),b("value",e.observaciones()),a(2),b("disabled",e.cargando()),a(2),b("disabled",e.cargando()||!e.mensajeroSeleccionado()||!e.direccionDestino()||!e.fechaProgramada()||!e.contactoDestino()||!e.telefonoDestino()),a(),p(e.cargando()?36:37)}}var N=class r{envioService=h(K);router=h(F);route=h(O);kitId=m("");kitInfo=m(null);mensajeros=m([]);mensajeroSeleccionado=m(null);direccionDestino=m("");contactoDestino=m("");telefonoDestino=m("");fechaProgramada=m("");observaciones=m("");cargando=m(!1);error=m("");exito=m("");mensajerosFiltrados=T(()=>this.mensajeros().sort((o,e)=>o.nombre.localeCompare(e.nombre)));ngOnInit(){let o=this.route.snapshot.paramMap.get("id");o&&(this.kitId.set(o),this.cargarDatos());let e=new Date;e.setDate(e.getDate()+1),this.fechaProgramada.set(e.toISOString().split("T")[0])}cargarDatos(){return C(this,null,function*(){try{this.cargando.set(!0),this.envioService.getMensajerosDisponibles().subscribe({next:o=>{this.mensajeros.set(o),this.cargando.set(!1)},error:o=>{console.error("Error cargando mensajeros:",o),this.error.set("Error al cargar mensajeros"),this.cargando.set(!1)}}),this.envioService.getKitsListosParaEnvio().subscribe({next:o=>{console.log("Kits recibidos:",o);let e=o.find(l=>l.id===this.kitId());if(console.log("Kit seleccionado:",e),e){this.kitInfo.set(e);let l=e.cirugia?.hospitales||e.cirugia?.hospital;l&&(console.log("Hospital:",l),this.direccionDestino.set(l.direccion||""));let s=e.cirugia?.clientes||e.cirugia?.cliente;if(s){console.log("Cliente:",s);let d=`${s.nombre} ${s.apellido}`;this.contactoDestino.set(d),this.telefonoDestino.set(s.telefono||"")}console.log("Valores pre-llenados:"),console.log("- Direcci\xF3n:",this.direccionDestino()),console.log("- Contacto:",this.contactoDestino()),console.log("- Tel\xE9fono:",this.telefonoDestino())}else console.error("Kit no encontrado con ID:",this.kitId())},error:o=>{console.error("Error cargando kit:",o)}})}catch(o){console.error("Error:",o),this.error.set("Error al cargar datos"),this.cargando.set(!1)}})}seleccionarMensajero(o){this.mensajeroSeleccionado.set(o)}asignarYDespachar(){return C(this,null,function*(){if(!this.mensajeroSeleccionado()){this.error.set("Debe seleccionar un mensajero");return}if(!this.direccionDestino()||!this.fechaProgramada()||!this.contactoDestino()||!this.telefonoDestino()){this.error.set("Complete todos los campos obligatorios (direcci\xF3n, contacto, tel\xE9fono y fecha)");return}try{this.cargando.set(!0),this.error.set("");let o={kit_id:this.kitId(),mensajero_id:this.mensajeroSeleccionado().id,direccion_destino:this.direccionDestino(),contacto_destino:this.contactoDestino(),telefono_destino:this.telefonoDestino(),fecha_programada:this.fechaProgramada(),observaciones:this.observaciones()},e=yield this.envioService.asignarMensajero(o);e.exito?(this.exito.set(e.mensaje||"Mensajero asignado exitosamente"),setTimeout(()=>{this.router.navigate(["/internal/logistica/kits-listos"])},2e3)):this.error.set(e.mensaje||"Error al asignar mensajero")}catch(o){console.error("Error:",o),this.error.set("Error al procesar la asignaci\xF3n")}finally{this.cargando.set(!1)}})}cancelar(){this.router.navigate(["/internal/logistica/kits-listos"])}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["app-asignar-mensajero"]],decls:24,vars:5,consts:[[1,"min-h-screen","bg-gradient-to-br","from-[#10284C]","via-[#0d1f3a]","to-[#0a1829]","p-4","sm:p-8"],[1,"max-w-6xl","mx-auto"],[1,"mb-8","flex","flex-col","items-center","gap-4"],[1,"text-4xl","font-bold","text-white","text-center"],[1,"px-4","py-2","bg-[#C8D900]","text-[#10284C]","rounded-lg","hover:bg-[#d4e820]","transition-colors","font-medium","flex","items-center","gap-2","active:scale-95",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"mb-6","bg-red-500/20","border","border-red-500","text-red-100","p-4","rounded-lg"],[1,"mb-6","bg-green-500/20","border","border-green-500","text-green-100","p-4","rounded-lg"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-1"],[1,"bg-white/10","backdrop-blur-md","border","border-white/20","rounded-2xl","p-6","shadow-xl"],[1,"lg:col-span-2"],[1,"text-xl","font-bold","text-[#C8D900]","mb-4"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4","max-h-[500px]","overflow-y-auto","pr-2"],[1,"rounded-xl","p-4","cursor-pointer","transition-all","duration-200",3,"class"],[1,"col-span-2","text-center","py-12","text-gray-400"],[1,"mt-6","bg-white/10","backdrop-blur-md","border","border-white/20","rounded-2xl","p-6","shadow-xl"],[1,"space-y-3","text-white"],[1,"text-gray-400","text-sm"],[1,"font-bold","text-lg"],[1,"inline-block","px-3","py-1","bg-green-500/20","text-green-400","rounded-full","text-sm","font-semibold"],[1,"font-semibold"],[1,"text-sm","text-gray-300"],[1,"rounded-xl","p-4","cursor-pointer","transition-all","duration-200",3,"click"],[1,"flex","items-start","justify-between","mb-3"],[1,"flex-1"],[1,"text-white","font-bold","text-lg"],[1,"space-y-2","text-sm"],[1,"flex","justify-between","items-center"],[1,"text-gray-400"],[1,"font-semibold","capitalize"],[1,"mt-3","text-center"],[1,"text-white","font-mono","font-semibold"],[1,"text-[#C8D900]","font-bold","text-sm"],[1,"text-xl","mb-2"],[1,"text-sm"],[1,"text-xl","font-bold","text-[#C8D900]","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-white","text-sm","mb-2"],[1,"text-red-400"],["type","text","placeholder","Direcci\xF3n del hospital (editable)",1,"w-full","px-4","py-2","bg-white/10","border","border-white/20","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-[#C8D900]",3,"input","value"],["type","text","placeholder","Nombre del paciente (editable)",1,"w-full","px-4","py-2","bg-white/10","border","border-white/20","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-[#C8D900]",3,"input","value"],["type","tel","placeholder","Tel\xE9fono de contacto (editable)",1,"w-full","px-4","py-2","bg-white/10","border","border-white/20","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-[#C8D900]",3,"input","value"],["type","date",1,"w-full","px-4","py-2","bg-white/10","border","border-white/20","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-[#C8D900]",3,"input","value"],[1,"md:col-span-2"],["rows","3","placeholder","Observaciones adicionales sobre el env\xEDo...",1,"w-full","px-4","py-2","bg-white/10","border","border-white/20","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-[#C8D900]",3,"input","value"],[1,"flex","justify-end","gap-4","mt-6"],[1,"px-6","py-3","bg-gray-500","hover:bg-gray-600","text-white","rounded-lg","font-semibold","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"px-6","py-3","bg-gradient-to-r","from-[#C8D900]","to-[#a8b500]","hover:from-[#a8b500]","hover:to-[#8a9600]","text-[#10284C]","rounded-lg","font-bold","transition-all","shadow-lg","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(e,l){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),n(4," Asignar Mensajero "),i(),t(5,"button",4),g("click",function(){return l.cancelar()}),j(),t(6,"svg",5),k(7,"path",6),i(),S(),t(8,"span"),n(9,"Volver"),i()()(),u(10,L,2,1,"div",7)(11,Y,2,1,"div",8),t(12,"div",9)(13,"div",10),u(14,z,15,3,"div",11),i(),t(15,"div",12)(16,"div",11)(17,"h2",13),n(18,"Mensajeros Disponibles"),i(),t(19,"div",14),M(20,J,15,9,"div",15,$),u(22,Q,5,0,"div",16),i()()()(),u(23,X,38,8,"div",17),i()()),e&2&&(a(10),p(l.error()?10:-1),a(),p(l.exito()?11:-1),a(3),p(l.kitInfo()?14:-1),a(6),y(l.mensajerosFiltrados()),a(2),p(l.mensajerosFiltrados().length===0?22:-1),a(),p(l.mensajeroSeleccionado()?23:-1))},dependencies:[P,V,H],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ffffff0d;border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c8d9004d;border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#c8d90080}.cursor-pointer[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.cursor-pointer[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 20px #0003}.text-yellow-400[_ngcontent-%COMP%]{letter-spacing:2px}"]})};export{N as AsignarMensajeroComponent};
