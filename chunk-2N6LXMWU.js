import{a as R}from"./chunk-I5AHCXXY.js";import{a as B,c as H,g as K,x as Y}from"./chunk-ZJDURMG7.js";import{$ as T,Aa as O,E as p,G as s,Ga as F,J as k,Ja as W,Ma as L,N as u,Oa as N,Q as S,T as j,U as x,X as A,Y as I,Z as t,_ as n,aa as E,ba as _,ca as d,ha as o,ia as f,ja as v,ma as h,na as C,oa as b,ta as V,u as w,va as P,w as m,x as g,y as D,z as y}from"./chunk-OA5U47VA.js";import"./chunk-LJ5XHLMQ.js";import{h as M}from"./chunk-FK42CRUA.js";var G=(a,r)=>r.id;function q(a,r){if(a&1&&(t(0,"div",7),o(1),n()),a&2){let e=d();s(),v(" ",e.error()," ")}}function J(a,r){if(a&1&&(t(0,"div",8),o(1),n()),a&2){let e=d();s(),v(" ",e.exito()," ")}}function Q(a,r){if(a&1&&(t(0,"div")(1,"p",19),o(2,"Hospital"),n(),t(3,"p",22),o(4),n(),t(5,"p",23),o(6),n()()),a&2){let e=d(3);s(4),f(e.kitInfo().cirugia.hospital.nombre),s(2),f(e.kitInfo().cirugia.hospital.ciudad)}}function U(a,r){if(a&1&&(t(0,"div")(1,"p",19),o(2,"Cirug\xEDa"),n(),t(3,"p",22),o(4),n()(),u(5,Q,7,2,"div"),t(6,"div")(7,"p",19),o(8,"Fecha Cirug\xEDa"),n(),t(9,"p",22),o(10),V(11,"date"),n()(),t(12,"div")(13,"p",19),o(14,"M\xE9dico"),n(),t(15,"p",22),o(16),n()()),a&2){let e=d(2);s(4),f(e.kitInfo().cirugia.numero_cirugia),s(),x(e.kitInfo().cirugia.hospital?5:-1),s(5),f(P(11,4,e.kitInfo().cirugia.fecha_programada,"dd/MM/yyyy HH:mm")),s(6),f(e.kitInfo().cirugia.medico_cirujano)}}function X(a,r){if(a&1&&(t(0,"div",11)(1,"h2",13),o(2,"Informaci\xF3n del Kit"),n(),t(3,"div",18)(4,"div")(5,"p",19),o(6,"N\xFAmero de Kit"),n(),t(7,"p",20),o(8),n()(),u(9,U,17,7),t(10,"div")(11,"p",19),o(12,"Estado Actual"),n(),t(13,"span",21),o(14),n()()()()),a&2){let e=d();s(8),f(e.kitInfo().numero_kit),s(),x(e.kitInfo().cirugia?9:-1),s(5),v(" ",e.kitInfo().estado," ")}}function Z(a,r){if(a&1&&(t(0,"div",29)(1,"span",30),o(2,"Placa:"),n(),t(3,"span",33),o(4),n()()),a&2){let e=d().$implicit;s(4),f(e.placa)}}function $(a,r){a&1&&(t(0,"div",32)(1,"span",34),o(2,"\u2713 SELECCIONADO"),n()())}function ee(a,r){if(a&1){let e=E();t(0,"div",24),_("click",function(){let i=m(e).$implicit,l=d();return g(l.seleccionarMensajero(i))}),t(1,"div",25)(2,"div",26)(3,"h3",27),o(4),n(),t(5,"p",19),o(6),n()()(),t(7,"div",28),u(8,Z,5,1,"div",29),t(9,"div",29)(10,"span",30),o(11,"Estado:"),n(),t(12,"span",31),o(13),n()()(),u(14,$,3,0,"div",32),n()}if(a&2){let e,c,i=r.$implicit,l=d();j(((e=l.mensajeroSeleccionado())==null?null:e.id)===i.id?"bg-[#C8D900]/20 border-[#C8D900] border-2":"bg-white/5 border-white/10 border hover:bg-white/10"),s(4),f(i.nombre),s(2),f(i.telefono),s(2),x(i.placa?8:-1),s(4),j(i.estado==="disponible"?"text-green-400":"text-orange-400"),s(),v(" ",i.estado," "),s(),x(((c=l.mensajeroSeleccionado())==null?null:c.id)===i.id?14:-1)}}function te(a,r){a&1&&(t(0,"div",16)(1,"p",35),o(2,"No hay mensajeros disponibles"),n(),t(3,"p",36),o(4,"Todos los mensajeros est\xE1n ocupados"),n()())}function ne(a,r){a&1&&(t(0,"span"),o(1,"Asignando..."),n())}function ie(a,r){a&1&&(t(0,"span"),o(1,"Asignar y Despachar"),n())}function oe(a,r){if(a&1){let e=E();t(0,"div",17)(1,"h2",37),o(2,"Detalles del Env\xEDo"),n(),t(3,"div",38)(4,"div")(5,"label",39),o(6," Direcci\xF3n Hospital "),t(7,"span",40),o(8,"*"),n()(),t(9,"input",41),b("ngModelChange",function(i){m(e);let l=d();return C(l.direccionDestino,i)||(l.direccionDestino=i),g(i)}),_("ngModelChange",function(i){m(e);let l=d();return g(l.direccionDestino.set(i))}),n()(),t(10,"div")(11,"label",39),o(12," Paciente / Contacto "),t(13,"span",40),o(14,"*"),n()(),t(15,"input",42),b("ngModelChange",function(i){m(e);let l=d();return C(l.contactoDestino,i)||(l.contactoDestino=i),g(i)}),_("ngModelChange",function(i){m(e);let l=d();return g(l.contactoDestino.set(i))}),n()(),t(16,"div")(17,"label",39),o(18," Tel\xE9fono de Contacto "),t(19,"span",40),o(20,"*"),n()(),t(21,"input",43),b("ngModelChange",function(i){m(e);let l=d();return C(l.telefonoDestino,i)||(l.telefonoDestino=i),g(i)}),_("ngModelChange",function(i){m(e);let l=d();return g(l.telefonoDestino.set(i))}),n()(),t(22,"div")(23,"label",39),o(24," Fecha Programada "),t(25,"span",40),o(26,"*"),n()(),t(27,"input",44),b("ngModelChange",function(i){m(e);let l=d();return C(l.fechaProgramada,i)||(l.fechaProgramada=i),g(i)}),_("ngModelChange",function(i){m(e);let l=d();return g(l.fechaProgramada.set(i))}),n()(),t(28,"div",45)(29,"label",39),o(30,"Observaciones"),n(),t(31,"textarea",46),b("ngModelChange",function(i){m(e);let l=d();return C(l.observaciones,i)||(l.observaciones=i),g(i)}),_("ngModelChange",function(i){m(e);let l=d();return g(l.observaciones.set(i))}),n()()(),t(32,"div",47)(33,"button",48),_("click",function(){m(e);let i=d();return g(i.cancelar())}),o(34," Cancelar "),n(),t(35,"button",49),_("click",function(){m(e);let i=d();return g(i.asignarYDespachar())}),u(36,ne,2,0,"span")(37,ie,2,0,"span"),n()()()}if(a&2){let e=d();s(9),h("ngModel",e.direccionDestino),s(6),h("ngModel",e.contactoDestino),s(6),h("ngModel",e.telefonoDestino),s(6),h("ngModel",e.fechaProgramada),s(4),h("ngModel",e.observaciones),s(2),S("disabled",e.cargando()),s(2),S("disabled",e.cargando()||!e.mensajeroSeleccionado()||!e.direccionDestino()||!e.fechaProgramada()||!e.contactoDestino()||!e.telefonoDestino()),s(),x(e.cargando()?36:37)}}var z=class a{envioService=w(R);router=w(N);route=w(L);kitId=p("");kitInfo=p(null);mensajeros=p([]);mensajeroSeleccionado=p(null);direccionDestino=p("");contactoDestino=p("");telefonoDestino=p("");fechaProgramada=p("");observaciones=p("");cargando=p(!1);error=p("");exito=p("");mensajerosFiltrados=O(()=>this.mensajeros().sort((r,e)=>r.nombre.localeCompare(e.nombre)));ngOnInit(){let r=this.route.snapshot.paramMap.get("id");r&&(this.kitId.set(r),this.cargarDatos());let e=new Date;e.setDate(e.getDate()+1),this.fechaProgramada.set(e.toISOString().split("T")[0])}cargarDatos(){return M(this,null,function*(){try{this.cargando.set(!0),this.envioService.getMensajerosDisponibles().subscribe({next:r=>{this.mensajeros.set(r),this.cargando.set(!1)},error:r=>{console.error("Error cargando mensajeros:",r),this.error.set("Error al cargar mensajeros"),this.cargando.set(!1)}}),this.envioService.getKitsListosParaEnvio().subscribe({next:r=>{console.log("Kits recibidos:",r);let e=r.find(c=>c.id===this.kitId());if(console.log("Kit seleccionado:",e),e){if(this.kitInfo.set(e),e.cirugia?.hospital&&(console.log("Hospital:",e.cirugia.hospital),this.direccionDestino.set(e.cirugia.hospital.direccion||"")),e.cirugia?.cliente){console.log("Cliente:",e.cirugia.cliente);let c=`${e.cirugia.cliente.nombre} ${e.cirugia.cliente.apellido}`;this.contactoDestino.set(c),this.telefonoDestino.set(e.cirugia.cliente.telefono||"")}console.log("Valores pre-llenados:"),console.log("- Direcci\xF3n:",this.direccionDestino()),console.log("- Contacto:",this.contactoDestino()),console.log("- Tel\xE9fono:",this.telefonoDestino())}else console.error("Kit no encontrado con ID:",this.kitId())},error:r=>{console.error("Error cargando kit:",r)}})}catch(r){console.error("Error:",r),this.error.set("Error al cargar datos"),this.cargando.set(!1)}})}seleccionarMensajero(r){this.mensajeroSeleccionado.set(r)}asignarYDespachar(){return M(this,null,function*(){if(!this.mensajeroSeleccionado()){this.error.set("Debe seleccionar un mensajero");return}if(!this.direccionDestino()||!this.fechaProgramada()||!this.contactoDestino()||!this.telefonoDestino()){this.error.set("Complete todos los campos obligatorios (direcci\xF3n, contacto, tel\xE9fono y fecha)");return}try{this.cargando.set(!0),this.error.set("");let r={kit_id:this.kitId(),mensajero_id:this.mensajeroSeleccionado().id,direccion_destino:this.direccionDestino(),contacto_destino:this.contactoDestino(),telefono_destino:this.telefonoDestino(),fecha_programada:this.fechaProgramada(),observaciones:this.observaciones()},e=yield this.envioService.asignarMensajero(r);e.exito?(this.exito.set(e.mensaje||"Mensajero asignado exitosamente"),setTimeout(()=>{this.router.navigate(["/internal/logistica/kits-listos"])},2e3)):this.error.set(e.mensaje||"Error al asignar mensajero")}catch(r){console.error("Error:",r),this.error.set("Error al procesar la asignaci\xF3n")}finally{this.cargando.set(!1)}})}cancelar(){this.router.navigate(["/internal/logistica/kits-listos"])}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-asignar-mensajero"]],decls:24,vars:5,consts:[[1,"min-h-screen","bg-gradient-to-br","from-[#10284C]","via-[#0d1f3a]","to-[#0a1829]","p-4","sm:p-8"],[1,"max-w-6xl","mx-auto"],[1,"mb-8","flex","flex-col","items-center","gap-4"],[1,"text-4xl","font-bold","text-white","text-center"],[1,"px-4","py-2","bg-[#C8D900]","text-[#10284C]","rounded-lg","hover:bg-[#d4e820]","transition-colors","font-medium","flex","items-center","gap-2","active:scale-95",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"mb-6","bg-red-500/20","border","border-red-500","text-red-100","p-4","rounded-lg"],[1,"mb-6","bg-green-500/20","border","border-green-500","text-green-100","p-4","rounded-lg"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-1"],[1,"bg-white/10","backdrop-blur-md","border","border-white/20","rounded-2xl","p-6","shadow-xl"],[1,"lg:col-span-2"],[1,"text-xl","font-bold","text-[#C8D900]","mb-4"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4","max-h-[500px]","overflow-y-auto","pr-2"],[1,"rounded-xl","p-4","cursor-pointer","transition-all","duration-200",3,"class"],[1,"col-span-2","text-center","py-12","text-gray-400"],[1,"mt-6","bg-white/10","backdrop-blur-md","border","border-white/20","rounded-2xl","p-6","shadow-xl"],[1,"space-y-3","text-white"],[1,"text-gray-400","text-sm"],[1,"font-bold","text-lg"],[1,"inline-block","px-3","py-1","bg-green-500/20","text-green-400","rounded-full","text-sm","font-semibold"],[1,"font-semibold"],[1,"text-sm","text-gray-300"],[1,"rounded-xl","p-4","cursor-pointer","transition-all","duration-200",3,"click"],[1,"flex","items-start","justify-between","mb-3"],[1,"flex-1"],[1,"text-white","font-bold","text-lg"],[1,"space-y-2","text-sm"],[1,"flex","justify-between","items-center"],[1,"text-gray-400"],[1,"font-semibold","capitalize"],[1,"mt-3","text-center"],[1,"text-white","font-mono","font-semibold"],[1,"text-[#C8D900]","font-bold","text-sm"],[1,"text-xl","mb-2"],[1,"text-sm"],[1,"text-xl","font-bold","text-[#C8D900]","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-white","text-sm","mb-2"],[1,"text-red-400"],["type","text","placeholder","Direcci\xF3n del hospital (editable)",1,"w-full","px-4","py-2","bg-white/10","border","border-white/20","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-[#C8D900]",3,"ngModelChange","ngModel"],["type","text","placeholder","Nombre del paciente (editable)",1,"w-full","px-4","py-2","bg-white/10","border","border-white/20","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-[#C8D900]",3,"ngModelChange","ngModel"],["type","tel","placeholder","Tel\xE9fono de contacto (editable)",1,"w-full","px-4","py-2","bg-white/10","border","border-white/20","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-[#C8D900]",3,"ngModelChange","ngModel"],["type","date",1,"w-full","px-4","py-2","bg-white/10","border","border-white/20","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-[#C8D900]",3,"ngModelChange","ngModel"],[1,"md:col-span-2"],["rows","3","placeholder","Observaciones adicionales sobre el env\xEDo...",1,"w-full","px-4","py-2","bg-white/10","border","border-white/20","rounded-lg","text-white","focus:outline-none","focus:ring-2","focus:ring-[#C8D900]",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-4","mt-6"],[1,"px-6","py-3","bg-gray-500","hover:bg-gray-600","text-white","rounded-lg","font-semibold","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"px-6","py-3","bg-gradient-to-r","from-[#C8D900]","to-[#a8b500]","hover:from-[#a8b500]","hover:to-[#8a9600]","text-[#10284C]","rounded-lg","font-bold","transition-all","shadow-lg","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(e,c){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),o(4," Asignar Mensajero "),n(),t(5,"button",4),_("click",function(){return c.cancelar()}),D(),t(6,"svg",5),T(7,"path",6),n(),y(),t(8,"span"),o(9,"Volver"),n()()(),u(10,q,2,1,"div",7)(11,J,2,1,"div",8),t(12,"div",9)(13,"div",10),u(14,X,15,3,"div",11),n(),t(15,"div",12)(16,"div",11)(17,"h2",13),o(18,"Mensajeros Disponibles"),n(),t(19,"div",14),A(20,ee,15,9,"div",15,G),u(22,te,5,0,"div",16),n()()()(),u(23,oe,38,8,"div",17),n()()),e&2&&(s(10),x(c.error()?10:-1),s(),x(c.exito()?11:-1),s(3),x(c.kitInfo()?14:-1),s(6),I(c.mensajerosFiltrados()),s(2),x(c.mensajerosFiltrados().length===0?22:-1),s(),x(c.mensajeroSeleccionado()?23:-1))},dependencies:[W,F,Y,B,H,K],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ffffff0d;border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c8d9004d;border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#c8d90080}.cursor-pointer[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.cursor-pointer[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 20px #0003}.text-yellow-400[_ngcontent-%COMP%]{letter-spacing:2px}"]})};export{z as AsignarMensajeroComponent};
