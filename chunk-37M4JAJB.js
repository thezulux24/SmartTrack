import{a as G,b as w,c as M,d as L,g as q,i as U,j as z,k as B,l as R,m as $,q as Q,s as J}from"./chunk-HD67DJS7.js";import{a as D}from"./chunk-7SKATKTI.js";import{b as H,c as N,d as W,g as O,k as A,o as j}from"./chunk-ZSGB5YWW.js";import{$a as c,Ca as T,Ha as u,Oa as s,P as y,Pa as S,Ua as r,V as _,Va as t,W as b,Wa as f,X as P,Xa as C,Y as I,_a as h,bb as l,cb as p,db as E,kb as V,sa as a}from"./chunk-YUCVBBHU.js";import"./chunk-LJ5XHLMQ.js";import{h as k}from"./chunk-FK42CRUA.js";var K=(i,n,e,o)=>({"bg-blue-100 text-blue-800":i,"bg-green-100 text-green-800":n,"bg-yellow-100 text-yellow-800":e,"bg-purple-100 text-purple-800":o});function X(i,n){i&1&&(r(0,"div",6)(1,"div",7)(2,"div",8),f(3,"div",9)(4,"div",10),t(),r(5,"p",11),l(6,"Cargando informaci\xF3n del usuario..."),t()()())}function Y(i,n){if(i&1){let e=C();r(0,"div",6)(1,"div",7)(2,"div",12),P(),r(3,"svg",13),f(4,"path",14),t(),I(),r(5,"p",15),l(6),t()(),r(7,"button",16),h("click",function(){_(e);let d=c();return b(d.logout())}),l(8," Volver al login "),t()()()}if(i&2){let e=c();a(6),p(e.error)}}function Z(i,n){i&1&&(r(0,"div",34),l(1," El nombre es requerido (m\xEDnimo 2 caracteres) "),t())}function ee(i,n){if(i&1&&(r(0,"option",35),l(1),t()),i&2){let e=n.$implicit;s("value",e.value),a(),E(" ",e.label," ")}}function te(i,n){i&1&&(r(0,"div",34),l(1," Debes seleccionar un \xE1rea de trabajo "),t())}function re(i,n){i&1&&(r(0,"div",34),l(1," Formato de tel\xE9fono inv\xE1lido "),t())}function ie(i,n){i&1&&(r(0,"span"),l(1,"Crear Perfil"),t())}function oe(i,n){i&1&&(r(0,"span",36),P(),r(1,"svg",37),f(2,"circle",38)(3,"path",39),t(),l(4," Creando perfil... "),t())}function ne(i,n){if(i&1){let e=C();r(0,"div",6)(1,"div",17)(2,"h2",18),l(3," Completa tu perfil para continuar "),t(),r(4,"form",19),h("ngSubmit",function(){_(e);let d=c();return b(d.onSubmitProfile())}),r(5,"div")(6,"label",20),l(7," Nombre completo * "),t(),f(8,"input",21),u(9,Z,2,0,"div",22),t(),r(10,"div")(11,"label",23),l(12," \xC1rea de trabajo * "),t(),r(13,"select",24)(14,"option",25),l(15,"Selecciona tu \xE1rea"),t(),u(16,ee,2,2,"option",26),t(),u(17,te,2,0,"div",22),t(),r(18,"div")(19,"label",27),l(20," Tel\xE9fono (opcional) "),t(),f(21,"input",28),u(22,re,2,0,"div",22),t(),r(23,"div",29)(24,"button",30),u(25,ie,2,0,"span",31)(26,oe,5,0,"span",32),t(),r(27,"button",33),h("click",function(){_(e);let d=c();return b(d.logout())}),l(28," Cerrar sesi\xF3n "),t()()()()()}if(i&2){let e,o,d,g,x,v,m=c();a(4),s("formGroup",m.profileForm),a(4),S("border-red-500",((e=m.profileForm.get("full_name"))==null?null:e.invalid)&&((e=m.profileForm.get("full_name"))==null?null:e.touched)),a(),s("ngIf",((o=m.profileForm.get("full_name"))==null?null:o.invalid)&&((o=m.profileForm.get("full_name"))==null?null:o.touched)),a(4),S("border-red-500",((d=m.profileForm.get("role"))==null?null:d.invalid)&&((d=m.profileForm.get("role"))==null?null:d.touched)),a(3),s("ngForOf",m.roleOptions),a(),s("ngIf",((g=m.profileForm.get("role"))==null?null:g.invalid)&&((g=m.profileForm.get("role"))==null?null:g.touched)),a(4),S("border-red-500",((x=m.profileForm.get("phone"))==null?null:x.invalid)&&((x=m.profileForm.get("phone"))==null?null:x.touched)),a(),s("ngIf",((v=m.profileForm.get("phone"))==null?null:v.invalid)&&((v=m.profileForm.get("phone"))==null?null:v.touched)),a(2),s("disabled",m.savingProfile),a(),s("ngIf",!m.savingProfile),a(),s("ngIf",m.savingProfile)}}function le(i,n){if(i&1&&(r(0,"div",49)(1,"span",50),l(2,"\xC1rea:"),t(),r(3,"span",55),l(4),t()()),i&2){let e=c(2);a(4),p(e.userProfile.area)}}function ae(i,n){if(i&1&&(r(0,"div",49)(1,"span",50),l(2,"Tel\xE9fono:"),t(),r(3,"span",56),l(4),t()()),i&2){let e=c(2);a(4),p(e.userProfile.phone)}}function me(i,n){if(i&1){let e=C();r(0,"div",6)(1,"div",17)(2,"div",40)(3,"div",41)(4,"span",42),l(5),t()(),r(6,"h2",43),l(7),t(),r(8,"p",4),l(9),t(),r(10,"div",44)(11,"span",45),l(12),t()(),r(13,"p",46),l(14,"Implameq S.A.S."),t()(),r(15,"div",47),u(16,le,5,1,"div",48)(17,ae,5,1,"div",48),r(18,"div",49)(19,"span",50),l(20,"Estado:"),t(),r(21,"span",51),l(22),t()()(),r(23,"div",52)(24,"button",53),h("click",function(){_(e);let d=c();return b(d.acceder())}),l(25," Acceder al Sistema "),t(),r(26,"button",54),h("click",function(){_(e);let d=c();return b(d.logout())}),l(27," Cerrar sesi\xF3n "),t()()()()}if(i&2){let e=c();a(5),p(e.displayName.charAt(0).toUpperCase()),a(2),p(e.displayName),a(2),p(e.userProfile.email),a(2),s("ngClass",V(8,K,e.userProfile.role==="comercial",e.userProfile.role==="soporte_tecnico",e.userProfile.role==="logistica",e.userProfile.role==="admin")),a(),E(" ",e.roleDisplayName," "),a(4),s("ngIf",e.userProfile.area),a(),s("ngIf",e.userProfile.phone),a(5),p(e.userProfile.is_active?"Activo":"Inactivo")}}var F=class i{_authService=y(D);_supabaseService=y(j);_router=y(A);_fb=y(Q);loading=!0;userProfile=null;error=null;showProfileForm=!1;savingProfile=!1;profileForm=this._fb.group({full_name:["",[w.required,w.minLength(2)]],role:["",w.required],area:[""],phone:["",[w.pattern(/^[\+]?[\d\s\-\(\)]+$/)]]});roleOptions=[{value:"comercial",label:"Comercial",area:"comercial"},{value:"soporte_tecnico",label:"Soporte T\xE9cnico",area:"soporte"},{value:"logistica",label:"Log\xEDstica",area:"logistica"},{value:"admin",label:"Administrador",area:"admin"}];ngOnInit(){return k(this,null,function*(){try{let n=yield this._supabaseService.getSession(),e=n?.user?.id;if(!e){this._router.navigate(["/auth"]);return}let o=yield this._supabaseService.getUserProfile(e);o?this.userProfile=o:(this.showProfileForm=!0,this.profileForm.patchValue({full_name:n.user.user_metadata?.full_name||""}))}catch(n){console.error("Error cargando perfil:",n),this.error=n?.message??"Error al cargar informaci\xF3n del usuario"}finally{this.loading=!1}})}onSubmitProfile(){return k(this,null,function*(){if(this.profileForm.invalid){this.markFormGroupTouched();return}this.savingProfile=!0;try{let n=yield this._supabaseService.getSession(),e=n?.user?.id;if(!e)throw new Error("No se encontr\xF3 sesi\xF3n de usuario");let o=this.profileForm.value,d=this.roleOptions.find(v=>v.value===o.role),g={id:e,full_name:o.full_name,email:n.user.email,role:o.role,area:d?.area||o.role,phone:o.phone||null,is_active:!0},x=yield this._supabaseService.createUserProfile(g);this.userProfile=x,this.showProfileForm=!1,this.error=null}catch(n){console.error("Error creando perfil:",n),this.error=n?.message??"Error al crear el perfil"}finally{this.savingProfile=!1}})}markFormGroupTouched(){Object.keys(this.profileForm.controls).forEach(n=>{this.profileForm.get(n)?.markAsTouched()})}get displayName(){return this.userProfile?.full_name||this.userProfile?.email||"Usuario"}get roleDisplayName(){return{client:"Cliente",comercial:"Comercial",soporte_tecnico:"Soporte T\xE9cnico",logistica:"Log\xEDstica",admin:"Administrador"}[this.userProfile?.role||""]||this.userProfile?.role||"Sin rol"}acceder(){this.userProfile?.role&&(this.userProfile.role==="client"?this._router.navigate(["/client"]):this._router.navigate(["/internal"]))}logout(){return k(this,null,function*(){yield this._authService.logOut(),this._router.navigate(["/auth/log-in"])})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=T({type:i,selectors:[["app-welcome-home"]],decls:11,vars:5,consts:[[1,"bg-gray-50","dark:bg-gray-900","min-h-screen","flex","flex-col","items-center","justify-center","px-6","py-8","mx-auto"],[1,"flex","flex-col","items-center","mb-6"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white","mb-4"],["src","https://www.implameq.com/wp-content/uploads/logotipo-impla-300x78.png.webp","alt","Implameq Logo",1,"w-48","mb-2"],[1,"text-sm","text-gray-600","dark:text-gray-300"],["class","w-full bg-white rounded-lg shadow dark:border sm:max-w-md xl:p-0 dark:bg-gray-800 dark:border-gray-700",4,"ngIf"],[1,"w-full","bg-white","rounded-lg","shadow","dark:border","sm:max-w-md","xl:p-0","dark:bg-gray-800","dark:border-gray-700"],[1,"p-6","space-y-4","md:space-y-6","sm:p-8","text-center"],[1,"animate-pulse"],[1,"h-4","bg-gray-200","rounded","w-3/4","mx-auto","mb-2"],[1,"h-4","bg-gray-200","rounded","w-1/2","mx-auto"],[1,"text-sm","text-gray-500"],[1,"text-red-600","dark:text-red-400"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"text-sm"],["type","button",1,"w-full","text-white","bg-red-600","hover:bg-red-700","focus:ring-4","focus:outline-none","focus:ring-red-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-red-600","dark:hover:bg-red-700","dark:focus:ring-red-800",3,"click"],[1,"p-6","space-y-4","md:space-y-6","sm:p-8"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white","text-center"],[1,"space-y-4",3,"ngSubmit","formGroup"],["for","full_name",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","text","id","full_name","formControlName","full_name","placeholder","Ingresa tu nombre completo",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-lime-400","focus:border-lime-400","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-lime-400","dark:focus:border-lime-400"],["class","text-red-500 text-xs mt-1",4,"ngIf"],["for","role",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["id","role","formControlName","role",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-lime-400","focus:border-lime-400","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-lime-400","dark:focus:border-lime-400"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","phone",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","tel","id","phone","formControlName","phone","placeholder","+57 300 123 4567",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-lime-400","focus:border-lime-400","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-lime-400","dark:focus:border-lime-400"],[1,"space-y-3","pt-2"],["type","submit",1,"w-full","text-gray-900","bg-lime-400","hover:bg-lime-500","focus:ring-4","focus:outline-none","focus:ring-lime-300","font-bold","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-lime-400","dark:hover:bg-lime-500","dark:focus:ring-lime-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[4,"ngIf"],["class","flex items-center justify-center",4,"ngIf"],["type","button",1,"w-full","text-white","bg-gray-600","hover:bg-gray-700","focus:ring-4","focus:outline-none","focus:ring-gray-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-gray-600","dark:hover:bg-gray-700","dark:focus:ring-gray-800",3,"click"],[1,"text-red-500","text-xs","mt-1"],[3,"value"],[1,"flex","items-center","justify-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-4","w-4","text-gray-900"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-center","border-b","pb-4","mb-4"],[1,"w-16","h-16","bg-gradient-to-r","from-lime-400","to-green-500","rounded-full","flex","items-center","justify-center","mx-auto","mb-3"],[1,"text-white","text-xl","font-bold"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white"],[1,"mt-2"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-2"],[1,"space-y-2","text-sm"],["class","flex justify-between",4,"ngIf"],[1,"flex","justify-between"],[1,"text-gray-600","dark:text-gray-300"],[1,"text-green-600","dark:text-green-400"],[1,"space-y-3","pt-4"],["type","button",1,"w-full","text-gray-900","bg-lime-400","hover:bg-lime-500","focus:ring-4","focus:outline-none","focus:ring-lime-300","font-bold","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-lime-400","dark:hover:bg-lime-500","dark:focus:ring-lime-500",3,"click"],["type","button",1,"w-full","text-white","bg-green-600","hover:bg-green-700","focus:ring-4","focus:outline-none","focus:ring-green-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-green-600","dark:hover:bg-green-700","dark:focus:ring-green-800",3,"click"],[1,"text-gray-900","dark:text-white","capitalize"],[1,"text-gray-900","dark:text-white"]],template:function(e,o){e&1&&(r(0,"section",0)(1,"div",1)(2,"h1",2),l(3),t(),f(4,"img",3),r(5,"p",4),l(6,"Implantes m\xE9dico - Quir\xFArgicos"),t()(),u(7,X,7,0,"div",5)(8,Y,9,1,"div",5)(9,ne,29,14,"div",5)(10,me,28,13,"div",5),t()),e&2&&(a(3),E(" ",o.showProfileForm?"Completar Perfil":"Bienvenido a"," "),a(4),s("ngIf",o.loading),a(),s("ngIf",!o.loading&&o.error),a(),s("ngIf",!o.loading&&!o.error&&o.showProfileForm),a(),s("ngIf",!o.loading&&!o.error&&!o.showProfileForm&&o.userProfile))},dependencies:[O,H,N,W,J,q,R,$,G,B,M,L,U,z],encapsulation:2})};export{F as default};
