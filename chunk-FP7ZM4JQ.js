import{a as U,c as Z,g as J,x as Q}from"./chunk-NYPQX25O.js";import{g as $,j as q,p as R,v as W}from"./chunk-SVQ7HZAZ.js";import{$ as b,Ab as M,Db as N,Eb as O,Fb as K,Hb as B,Ia as d,Kb as F,Mb as H,S as V,Sa as G,Vb as y,Xa as E,Y as v,Z as f,_,cb as T,fb as A,hb as g,kb as P,la as z,lb as j,mb as t,nb as i,ob as u,pb as C,sb as w,tb as m,yb as n,zb as p}from"./chunk-YIZ2QXS6.js";import"./chunk-X5YLR3NI.js";import{a as I,i as D}from"./chunk-ODN5LVDJ.js";var ee=()=>[],Y=(a,o)=>o.id;function te(a,o){a&1&&(t(0,"div",9)(1,"div",13),u(2,"div",14),t(3,"p",15),n(4,"Cargando kits en limpieza..."),i()()())}function ie(a,o){if(a&1&&(t(0,"div",10)(1,"div",16),_(),t(2,"svg",17),u(3,"path",18),i(),b(),t(4,"h3",19),n(5,"Error"),i(),t(6,"p",20),n(7),i()()()),a&2){let e=m();d(7),p(e.error())}}function ne(a,o){a&1&&(t(0,"div",34),_(),t(1,"svg",36),u(2,"path",33),i(),b(),t(3,"h3",37),n(4,"No hay kits en limpieza"),i(),t(5,"p",38),n(6,"Cuando se procesen devoluciones, los kits aparecer\xE1n aqu\xED"),i()())}function oe(a,o){if(a&1){let e=C();t(0,"div",40),w("click",function(){let l=v(e).$implicit,s=m(3);return f(s.seleccionarKit(l))}),t(1,"div",41)(2,"div")(3,"h3",42),n(4),i(),t(5,"p",43),n(6),F(7,"date"),i()(),t(8,"div",44)(9,"span",45),n(10,"EN LIMPIEZA"),i()()(),t(11,"div",46)(12,"div",47),_(),t(13,"svg",48),u(14,"path",49),i(),b(),t(15,"p",50),n(16),i()(),t(17,"div",47),_(),t(18,"svg",48),u(19,"path",51),i(),b(),t(20,"p",50),n(21),i()()(),t(22,"div",52)(23,"span",43),n(24),i(),t(25,"button",53),n(26," Ver detalles \u2192 "),i()()()}if(a&2){let e=o.$implicit;d(4),p(e.numero_kit),d(2),p(H(7,5,e.fecha_inicio_limpieza,"dd/MM/yyyy HH:mm")),d(10),p((e.hospital==null?null:e.hospital.nombre)||"N/A"),d(5),p(e.medico_cirujano||"N/A"),d(3),M("",e.productos_count," productos reutilizables")}}function re(a,o){if(a&1&&(t(0,"div",35),P(1,oe,27,8,"div",39,Y),i()),a&2){let e=m(2);d(),j(e.kitsEnLimpieza())}}function ae(a,o){if(a&1&&(t(0,"div",11)(1,"div",21)(2,"div",22)(3,"div",23)(4,"h3",24),n(5,"Total Kits"),i(),_(),t(6,"svg",25),u(7,"path",26),i()(),b(),t(8,"div",27),n(9),i()(),t(10,"div",28)(11,"div",23)(12,"h3",24),n(13,"Pendientes"),i(),_(),t(14,"svg",25),u(15,"path",29),i()(),b(),t(16,"div",27),n(17),i()(),t(18,"div",30)(19,"div",23)(20,"h3",24),n(21,"En Proceso"),i(),_(),t(22,"svg",25),u(23,"path",31),i()(),b(),t(24,"div",27),n(25),i()(),t(26,"div",32)(27,"div",23)(28,"h3",24),n(29,"Esterilizados"),i(),_(),t(30,"svg",25),u(31,"path",33),i()(),b(),t(32,"div",27),n(33),i()()(),E(34,ne,7,0,"div",34)(35,re,3,0,"div",35),i()),a&2){let e=m();d(9),p(e.totalKits()),d(8),p(e.totalProductosPendientes()),d(8),p(e.totalProductosEnProceso()),d(8),p(e.totalProductosEsterilizados()),d(),g(e.kitsEnLimpieza().length===0?34:-1),d(),g(e.kitsEnLimpieza().length>0?35:-1)}}function de(a,o){if(a&1&&(t(0,"div",76)(1,"p",85)(2,"strong"),n(3,"Notas:"),i(),n(4),i()()),a&2){let e=m().$implicit;d(4),M(" ",e.notas,"")}}function le(a,o){if(a&1){let e=C();t(0,"button",86),w("click",function(){v(e);let l=m().$implicit,s=m(2);return f(s.cambiarEstadoProducto(l,"en_proceso"))}),_(),t(1,"svg",3),u(2,"path",87)(3,"path",88),i(),n(4," Iniciar Proceso "),i()}if(a&2){let e=m(3);T("disabled",e.procesando())}}function se(a,o){if(a&1){let e=C();t(0,"button",89),w("click",function(){v(e);let l=m().$implicit,s=m(2);return f(s.cambiarEstadoProducto(l,"esterilizado"))}),_(),t(1,"svg",3),u(2,"path",33),i(),n(3," Marcar como Esterilizado "),i()}if(a&2){let e=m(3);T("disabled",e.procesando())}}function ce(a,o){a&1&&(t(0,"div",84),n(1," \u2705 Listo para Aprobaci\xF3n "),i())}function me(a,o){if(a&1){let e=C();t(0,"div",69)(1,"div",70)(2,"div",71)(3,"h4",72),n(4),i(),t(5,"p",43),n(6),i()(),t(7,"div",73)(8,"div",13)(9,"div",74),n(10,"A Recuperar"),i(),t(11,"div",75),n(12),i()(),t(13,"div"),n(14),i()()(),E(15,de,5,1,"div",76),t(16,"div",77)(17,"label",78),n(18,"Observaciones de Limpieza:"),i(),t(19,"div",79)(20,"input",80),K("ngModelChange",function(l){let s=v(e).$implicit;return O(s.observaciones_limpieza,l)||(s.observaciones_limpieza=l),f(l)}),i(),t(21,"button",81),w("click",function(){let l=v(e).$implicit,s=m(2);return f(s.guardarObservaciones(l))}),n(22," Guardar "),i()()(),t(23,"div",79),E(24,le,5,1,"button",82)(25,se,4,1,"button",83)(26,ce,2,0,"div",84),i()()}if(a&2){let e=o.$implicit,r=m(2);d(4),p(e.producto_nombre),d(2),p(e.producto_codigo),d(6),p(e.cantidad_a_recuperar),d(),A("px-3 py-1 rounded-lg text-sm font-medium "+r.getEstadoColor(e.estado_limpieza)+"/20 border "+r.getEstadoColor(e.estado_limpieza)),d(),M(" ",r.getEstadoTexto(e.estado_limpieza)," "),d(),g(e.notas?15:-1),d(5),N("ngModel",e.observaciones_limpieza),d(4),g(e.estado_limpieza==="pendiente"?24:-1),d(),g(e.estado_limpieza==="en_proceso"?25:-1),d(),g(e.estado_limpieza==="esterilizado"?26:-1)}}function pe(a,o){if(a&1){let e=C();t(0,"div",54),w("click",function(){v(e);let l=m();return f(l.cerrarDetalle())}),t(1,"div",55),w("click",function(l){return v(e),f(l.stopPropagation())}),t(2,"div",56)(3,"div",6)(4,"div")(5,"h2",57),n(6),i(),t(7,"p",58),n(8,"Proceso de Limpieza y Esterilizaci\xF3n"),i()(),t(9,"button",59),w("click",function(){v(e);let l=m();return f(l.cerrarDetalle())}),_(),t(10,"svg",60),u(11,"path",61),i()()()(),b(),t(12,"div",62)(13,"div",63)(14,"div",64)(15,"div")(16,"div",65),n(17,"Hospital"),i(),t(18,"div",66),n(19),i()(),t(20,"div")(21,"div",65),n(22,"M\xE9dico"),i(),t(23,"div",66),n(24),i()(),t(25,"div")(26,"div",65),n(27,"Inicio Limpieza"),i(),t(28,"div",66),n(29),F(30,"date"),i()()()(),t(31,"div",67)(32,"h3",68),n(33,"Productos Reutilizables"),i(),P(34,me,27,11,"div",69,Y),i()()()()}if(a&2){let e,r,l,s,c,x=m();d(6),p((e=x.kitSeleccionado())==null?null:e.numero_kit),d(13),p(((r=x.kitSeleccionado())==null||r.hospital==null?null:r.hospital.nombre)||"N/A"),d(5),p(((l=x.kitSeleccionado())==null?null:l.medico_cirujano)||"N/A"),d(5),p(H(30,4,(s=x.kitSeleccionado())==null?null:s.fecha_inicio_limpieza,"dd/MM/yyyy HH:mm")),d(5),j(((c=x.kitSeleccionado())==null?null:c.productos)||B(7,ee))}}var X=class a{supabaseService=V(W);router=V(R);kitsEnLimpieza=z([]);kitSeleccionado=z(null);cargando=z(!0);procesando=z(!1);error=z("");usuarioId=z("");totalKits=y(()=>this.kitsEnLimpieza().length);totalProductosPendientes=y(()=>this.kitsEnLimpieza().reduce((o,e)=>o+e.productos.filter(r=>r.estado_limpieza==="pendiente").length,0));totalProductosEnProceso=y(()=>this.kitsEnLimpieza().reduce((o,e)=>o+e.productos.filter(r=>r.estado_limpieza==="en_proceso").length,0));totalProductosEsterilizados=y(()=>this.kitsEnLimpieza().reduce((o,e)=>o+e.productos.filter(r=>r.estado_limpieza==="esterilizado").length,0));ngOnInit(){this.cargarDatos()}cargarDatos(){return D(this,null,function*(){try{this.cargando.set(!0),this.error.set("");let o=this.supabaseService.supabaseClient,{data:{user:e}}=yield o.auth.getUser();e&&this.usuarioId.set(e.id);let{data:r,error:l}=yield o.from("kits_cirugia").select(`
          id,
          numero_kit,
          cirugia_id,
          estado,
          fecha_inicio_limpieza,
          cirugias!inner(
            id,
            medico_cirujano,
            hospitales(nombre),
            clientes(nombre, apellido)
          )
        `).eq("estado","en_limpieza").order("fecha_inicio_limpieza",{ascending:!1});if(l)throw l;let s=[];for(let c of r||[]){let x=c.cirugias,{data:k,error:S}=yield o.from("kit_productos_limpieza").select(`
            id,
            kit_producto_id,
            producto_id,
            cantidad_a_recuperar,
            cantidad_aprobada,
            estado_limpieza,
            notas,
            observaciones_limpieza,
            productos!inner(
              nombre,
              codigo
            )
          `).eq("kit_id",c.id).neq("es_desechable",!0);if(S){console.error("Error cargando productos:",S);continue}let L=(k||[]).map(h=>({id:h.id,kit_producto_id:h.kit_producto_id,producto_id:h.producto_id,producto_nombre:h.productos.nombre,producto_codigo:h.productos.codigo,cantidad_a_recuperar:h.cantidad_a_recuperar||0,cantidad_aprobada:h.cantidad_aprobada||0,estado_limpieza:h.estado_limpieza||"pendiente",notas:h.notas||"",observaciones_limpieza:h.observaciones_limpieza||""}));s.push({id:c.id,numero_kit:c.numero_kit,cirugia_id:c.cirugia_id,fecha_inicio_limpieza:c.fecha_inicio_limpieza,estado:c.estado,hospital:x?.hospitales,medico_cirujano:x?.medico_cirujano,cliente:x?.clientes,productos:L,productos_count:L.length})}this.kitsEnLimpieza.set(s)}catch(o){console.error("Error al cargar datos:",o),this.error.set(o.message||"Error al cargar los datos")}finally{this.cargando.set(!1)}})}seleccionarKit(o){this.kitSeleccionado.set(o)}cerrarDetalle(){this.kitSeleccionado.set(null)}cambiarEstadoProducto(o,e){return D(this,null,function*(){if(!this.procesando())try{this.procesando.set(!0);let r=this.supabaseService.supabaseClient,l={estado_limpieza:e,updated_at:new Date().toISOString()};e==="en_proceso"?(l.procesado_por=this.usuarioId(),l.fecha_inicio_proceso=new Date().toISOString()):e==="esterilizado"&&(l.fecha_fin_proceso=new Date().toISOString());let{error:s}=yield r.from("kit_productos_limpieza").update(l).eq("id",o.id);if(s)throw s;let c=this.kitSeleccionado();if(c){let x=c.productos.findIndex(k=>k.id===o.id);if(x!==-1){c.productos[x].estado_limpieza=e,this.kitSeleccionado.set(I({},c));let k=this.kitsEnLimpieza(),S=k.findIndex(L=>L.id===c.id);S!==-1&&(k[S]=I({},c),this.kitsEnLimpieza.set([...k]))}}alert(`\u2705 Producto actualizado a estado: ${e}`)}catch(r){console.error("Error al actualizar estado:",r),alert("Error al actualizar el estado del producto")}finally{this.procesando.set(!1)}})}guardarObservaciones(o){return D(this,null,function*(){try{let e=this.supabaseService.supabaseClient,{error:r}=yield e.from("kit_productos_limpieza").update({observaciones_limpieza:o.observaciones_limpieza,updated_at:new Date().toISOString()}).eq("id",o.id);if(r)throw r;alert("\u2705 Observaciones guardadas")}catch(e){console.error("Error al guardar observaciones:",e),alert("Error al guardar las observaciones")}})}getEstadoColor(o){switch(o){case"pendiente":return"bg-yellow-500";case"en_proceso":return"bg-blue-500";case"esterilizado":return"bg-green-500";case"aprobado":return"bg-purple-500";default:return"bg-gray-500"}}getEstadoTexto(o){switch(o){case"pendiente":return"Pendiente";case"en_proceso":return"En Proceso";case"esterilizado":return"Esterilizado";case"aprobado":return"Aprobado";case"desechado":return"Desechado";default:return o}}regresar(){this.router.navigate(["/internal"])}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=G({type:a,selectors:[["app-limpieza-dashboard"]],decls:17,vars:4,consts:[[1,"min-h-screen","bg-gradient-to-br","from-[#10284C]","via-[#0d1f3a]","to-[#0a1829]","p-6"],[1,"max-w-7xl","mx-auto","mb-8"],[1,"mb-6","flex","items-center","gap-2","text-white","hover:text-[#C8D900]","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"font-medium"],[1,"flex","items-center","justify-between"],[1,"text-4xl","font-bold","text-white","mb-2"],[1,"text-gray-300"],[1,"flex","items-center","justify-center","py-20"],[1,"max-w-7xl","mx-auto"],[1,"max-w-7xl","mx-auto","space-y-6"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","p-6","z-50"],[1,"text-center"],[1,"animate-spin","rounded-full","h-16","w-16","border-t-2","border-b-2","border-[#C8D900]","mx-auto","mb-4"],[1,"text-white","text-lg"],[1,"bg-red-500/10","border","border-red-500","rounded-lg","p-6","text-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","text-red-500","mx-auto","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-xl","font-bold","text-red-500","mb-2"],[1,"text-white"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6"],[1,"bg-gradient-to-br","from-purple-500","to-purple-600","rounded-lg","p-6","shadow-lg"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-white/80","text-sm","font-medium"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-white/60"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"],[1,"text-white","text-4xl","font-bold"],[1,"bg-gradient-to-br","from-yellow-500","to-yellow-600","rounded-lg","p-6","shadow-lg"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"bg-gradient-to-br","from-blue-500","to-blue-600","rounded-lg","p-6","shadow-lg"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"bg-gradient-to-br","from-green-500","to-green-600","rounded-lg","p-6","shadow-lg"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"bg-white/5","backdrop-blur-sm","border","border-white/10","rounded-lg","p-12","text-center"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-24","h-24","text-gray-500","mx-auto","mb-4"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-gray-400"],[1,"bg-white/5","backdrop-blur-sm","border","border-white/10","rounded-lg","p-6","hover:border-[#C8D900]","transition-colors","cursor-pointer"],[1,"bg-white/5","backdrop-blur-sm","border","border-white/10","rounded-lg","p-6","hover:border-[#C8D900]","transition-colors","cursor-pointer",3,"click"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-xl","font-bold","text-white"],[1,"text-gray-400","text-sm"],[1,"bg-purple-500/20","border","border-purple-500","rounded-lg","px-3","py-1"],[1,"text-purple-300","font-medium","text-sm"],[1,"space-y-2","mb-4"],[1,"flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"text-gray-300","text-sm"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"flex","items-center","justify-between","pt-4","border-t","border-white/10"],[1,"text-[#C8D900]","hover:text-[#a0b300]","font-medium","text-sm","transition-colors"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","p-6","z-50",3,"click"],[1,"bg-[#10284C]","border","border-white/20","rounded-xl","max-w-5xl","w-full","max-h-[90vh]","overflow-hidden",3,"click"],[1,"bg-gradient-to-r","from-purple-600","to-blue-600","p-6","border-b","border-white/20"],[1,"text-2xl","font-bold","text-white","mb-1"],[1,"text-gray-200"],[1,"text-white","hover:text-gray-300","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","overflow-y-auto","max-h-[calc(90vh-140px)]"],[1,"bg-white/5","rounded-lg","p-4","mb-6"],[1,"grid","grid-cols-3","gap-4"],[1,"text-gray-400","text-sm","mb-1"],[1,"text-white","font-medium"],[1,"space-y-4"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"bg-white/5","border","border-white/10","rounded-lg","p-4"],[1,"flex","items-center","justify-between","mb-3"],[1,"flex-1"],[1,"text-white","font-bold"],[1,"flex","items-center","gap-3"],[1,"text-gray-400","text-xs"],[1,"text-[#C8D900]","font-bold","text-lg"],[1,"bg-yellow-500/10","border","border-yellow-500/30","rounded","p-2","mb-3"],[1,"mb-3"],[1,"text-gray-300","text-sm","mb-1","block"],[1,"flex","gap-2"],["type","text","placeholder","Registrar observaciones del proceso...",1,"flex-1","px-3","py-2","bg-white/5","border","border-white/10","rounded-lg","text-white","placeholder-gray-500","focus:outline-none","focus:border-[#C8D900]",3,"ngModelChange","ngModel"],[1,"px-4","py-2","bg-blue-500","hover:bg-blue-600","text-white","rounded-lg","font-medium","transition-colors",3,"click"],[1,"flex-1","px-4","py-2","bg-blue-500","hover:bg-blue-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","rounded-lg","font-medium","transition-colors","flex","items-center","justify-center","gap-2",3,"disabled"],[1,"flex-1","px-4","py-2","bg-green-500","hover:bg-green-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","rounded-lg","font-medium","transition-colors","flex","items-center","justify-center","gap-2",3,"disabled"],[1,"flex-1","px-4","py-2","bg-purple-500/20","border","border-purple-500","text-purple-300","rounded-lg","font-medium","text-center"],[1,"text-yellow-200","text-sm"],[1,"flex-1","px-4","py-2","bg-blue-500","hover:bg-blue-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","rounded-lg","font-medium","transition-colors","flex","items-center","justify-center","gap-2",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"flex-1","px-4","py-2","bg-green-500","hover:bg-green-600","disabled:opacity-50","disabled:cursor-not-allowed","text-white","rounded-lg","font-medium","transition-colors","flex","items-center","justify-center","gap-2",3,"click","disabled"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"button",2),w("click",function(){return r.regresar()}),_(),t(3,"svg",3),u(4,"path",4),i(),b(),t(5,"span",5),n(6,"Volver al Dashboard"),i()(),t(7,"div",6)(8,"div")(9,"h1",7),n(10,"Limpieza y Esterilizaci\xF3n"),i(),t(11,"p",8),n(12,"Gesti\xF3n del proceso de limpieza de kits quir\xFArgicos"),i()()()(),E(13,te,5,0,"div",9)(14,ie,8,1,"div",10)(15,ae,36,6,"div",11)(16,pe,36,8,"div",12),i()),e&2&&(d(13),g(r.cargando()?13:-1),d(),g(r.error()&&!r.cargando()?14:-1),d(),g(!r.cargando()&&!r.error()?15:-1),d(),g(r.kitSeleccionado()?16:-1))},dependencies:[q,$,Q,U,Z,J],encapsulation:2})};export{X as LimpiezaDashboardComponent};
