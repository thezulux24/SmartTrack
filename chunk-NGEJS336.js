import{a as J,c as K,d as Q,e as X,f as Y,g as Z,h as ee,k as te,l as ie,m as ne,n as re,o as ae,p as oe,r as de}from"./chunk-6A73GPLE.js";import{c as R,d as q,e as A,f as z,g as G,l as H,n as U,o as $}from"./chunk-STGT2A7O.js";import{$a as g,Ca as B,Ha as b,Oa as c,P,Qa as T,Ua as t,V as p,Va as i,W as x,Wa as I,X as N,Xa as y,Y as j,_a as f,ab as O,bb as d,cb as _,db as v,eb as S,fb as E,gb as M,ha as u,ib as L,lb as h,mb as k,nb as W,sa as a}from"./chunk-L6U4RGVI.js";import"./chunk-LJ5XHLMQ.js";import{a as F,b as D,h as C}from"./chunk-FK42CRUA.js";var le=()=>["/internal"],se=()=>["movimientos"];function ce(l,r){l&1&&(t(0,"div",16)(1,"div",17)(2,"div",18),I(3,"div",19)(4,"div",20),i(),t(5,"p",21),d(6,"Cargando inventario..."),i()()())}function me(l,r){if(l&1){let e=y();t(0,"div",16)(1,"div",17)(2,"div",22),N(),t(3,"svg",23),I(4,"path",24),i(),j(),t(5,"p",25),d(6),i()(),t(7,"button",26),f("click",function(){p(e);let n=g();return x(n.loadData())}),d(8," Reintentar "),i()()()}if(l&2){let e=g();a(6),_(e.error())}}function ge(l,r){if(l&1&&(t(0,"option",38),d(1),h(2,"titlecase"),i()),l&2){let e=r.$implicit;c("value",e),a(),v(" ",k(2,2,e)," ")}}function ue(l,r){if(l&1){let e=y();t(0,"div",27)(1,"div",28)(2,"h3",29),d(3," Filtros de B\xFAsqueda "),i(),t(4,"div",30)(5,"div")(6,"label",31),d(7,"Buscar"),i(),t(8,"input",32),f("input",function(n){p(e);let s=g();return x(s.onSearchChange(n))}),i()(),t(9,"div")(10,"label",31),d(11,"Categor\xEDa"),i(),t(12,"select",33),f("change",function(n){p(e);let s=g();return x(s.onCategoryChange(n))}),t(13,"option",34),d(14,"Todas las categor\xEDas"),i(),b(15,ge,3,4,"option",35),i()()(),t(16,"div",36)(17,"div",37),d(18),i()()()()}if(l&2){let e=g();a(8),c("value",e.searchTerm()),a(4),c("value",e.selectedCategory()),a(3),c("ngForOf",e.categorias),a(3),v(" \u{1F4E6} ",e.filteredProductos().length," productos encontrados ")}}function pe(l,r){if(l&1&&(t(0,"div",64)(1,"span",65),d(2),h(3,"titlecase"),i(),t(4,"span"),d(5),i()()),l&2){let e=r.$implicit;a(2),_(k(3,4,e.ubicacion)),a(2),T(e.cantidad>0?"text-green-600 dark:text-green-400":"text-red-500 dark:text-red-400"),a(),v(" ",e.cantidad," ")}}function xe(l,r){if(l&1&&(t(0,"div",60)(1,"div",61),d(2,"Stock por ubicaci\xF3n:"),i(),t(3,"div",62),b(4,pe,6,6,"div",63),i()()),l&2){let e=g().$implicit;a(4),c("ngForOf",e.inventario)}}function ve(l,r){if(l&1){let e=y();t(0,"div",41)(1,"div",42)(2,"div",43)(3,"div",44)(4,"h3",45),d(5),i(),t(6,"p",46),d(7),i()(),t(8,"span",47),d(9),h(10,"titlecase"),i()()(),t(11,"div",48)(12,"div",49)(13,"div",50)(14,"span",51),d(15),i(),t(16,"div")(17,"div",52),d(18),i(),t(19,"div",53),d(20),i()()(),t(21,"div",54)(22,"div",55),d(23),h(24,"number"),i()()(),b(25,xe,5,1,"div",56),t(26,"div",57)(27,"button",58),f("click",function(){let n=p(e).$implicit,s=g(2);return x(s.openModal("entrada",n))}),d(28," \u2795 Entrada "),i(),t(29,"button",59),f("click",function(){let n=p(e).$implicit,s=g(2);return x(s.openModal("salida",n))}),d(30," \u2796 Salida "),i()()()()}if(l&2){let e=r.$implicit,o=g(2);a(5),_(e.nombre),a(2),_(e.codigo),a(2),v(" ",k(10,11,e.categoria)," "),a(6),_(o.getStockIcon(e)),a(2),T(o.getStockColor(e)),a(),v(" ",e.stock_total," unidades "),a(2),v(" M\xEDnimo: ",e.stock_minimo," "),a(3),v(" $",W(24,13,e.precio,"1.0-0")," "),a(2),c("ngIf",(e.inventario==null?null:e.inventario.length)>0),a(4),c("disabled",e.stock_total===0)}}function be(l,r){if(l&1&&(t(0,"div",39),b(1,ve,31,16,"div",40),i()),l&2){let e=g();a(),c("ngForOf",e.filteredProductos())}}function fe(l,r){if(l&1){let e=y();t(0,"div",66)(1,"div",17)(2,"div",67)(3,"div",68),d(4,"\u{1F4E6}"),i(),t(5,"h3",69),d(6,"No se encontraron productos"),i(),t(7,"p",70),d(8,"Intenta ajustar los filtros de b\xFAsqueda"),i()(),t(9,"button",71),f("click",function(){p(e);let n=g();return x(n.loadData())}),d(10," Recargar inventario "),i()()()}}function _e(l,r){if(l&1&&(t(0,"div",86),d(1),i()),l&2){let e,o=g(2);a(),v(" Disponible: ",(e=o.selectedInventario())==null?null:e.cantidad," ")}}function ye(l,r){if(l&1&&(t(0,"option",38),d(1),h(2,"titlecase"),i()),l&2){let e=r.$implicit;c("value",e),a(),v(" ",k(2,2,e)," ")}}function he(l,r){if(l&1){let e=y();t(0,"div")(1,"label",31),d(2,"Ubicaci\xF3n *"),i(),t(3,"select",87),M("ngModelChange",function(n){p(e);let s=g(2);return E(s.ubicacion,n)||(s.ubicacion=n),x(n)}),b(4,ye,3,4,"option",35),i()()}if(l&2){let e=g(2);a(3),S("ngModel",e.ubicacion),a(),c("ngForOf",e.ubicaciones)}}function ke(l,r){if(l&1){let e=y();t(0,"div",72)(1,"div",73)(2,"div",74)(3,"h3",75),d(4),i(),t(5,"div",76)(6,"div",77),d(7),i(),t(8,"div",53),d(9),i()(),t(10,"form",78,0),f("ngSubmit",function(){p(e);let n=g();return x(n.submitMovimiento())}),t(12,"div")(13,"label",31),d(14,"Cantidad *"),i(),t(15,"input",79),M("ngModelChange",function(n){p(e);let s=g();return E(s.cantidad,n)||(s.cantidad=n),x(n)}),i(),b(16,_e,2,1,"div",80),i(),b(17,he,5,2,"div",81),t(18,"div")(19,"label",31),d(20,"Motivo (opcional)"),i(),t(21,"input",82),M("ngModelChange",function(n){p(e);let s=g();return E(s.motivo,n)||(s.motivo=n),x(n)}),i()(),t(22,"div",83)(23,"button",84),d(24),i(),t(25,"button",85),f("click",function(){p(e);let n=g();return x(n.closeModal())}),d(26," Cancelar "),i()()()()()()}if(l&2){let e,o,n,s=O(11),m=g();a(4),v(" ",m.modalType()==="entrada"?"\u2795 Entrada":"\u2796 Salida"," de Inventario "),a(3),_((e=m.selectedProducto())==null?null:e.nombre),a(2),_((o=m.selectedProducto())==null?null:o.codigo),a(6),S("ngModel",m.cantidad),c("max",m.modalType()==="salida"?(n=(n=m.selectedInventario())==null?null:n.cantidad)!==null&&n!==void 0?n:null:999),a(),c("ngIf",m.modalType()==="salida"&&m.selectedInventario()),a(),c("ngIf",m.modalType()==="entrada"),a(4),S("ngModel",m.motivo),a(2),c("disabled",!s.valid||m.loading()),a(),v(" ",m.modalType()==="entrada"?"Registrar Entrada":"Registrar Salida"," ")}}var V=class l{_supabaseService=P($);loading=u(!1);productos=u([]);inventarios=u([]);filteredProductos=u([]);error=u(null);showModal=u(!1);modalType=u("entrada");selectedProducto=u(null);selectedInventario=u(null);searchTerm=u("");selectedCategory=u("");selectedUbicacion=u("");cantidad=0;motivo="";ubicacion="sede_principal";categorias=["osteosintesis","columna","trauma","fijacion_externa"];ubicaciones=["sede_principal","sede_norte","almacen_central"];ngOnInit(){return C(this,null,function*(){yield this.loadData()})}loadData(){return C(this,null,function*(){this.loading.set(!0),this.error.set(null);try{let[r,e]=yield Promise.all([this._supabaseService.getProductosConStock(),this._supabaseService.getInventarios()]),o=r.map(n=>{let s=n.inventario?.filter(m=>m.estado==="disponible")?.reduce((m,w)=>m+w.cantidad,0)||0;return D(F({},n),{stock_total:s,stock_bajo:s<=n.stock_minimo})});this.productos.set(o),this.inventarios.set(e),this.applyFilters()}catch(r){console.error("Error cargando inventario:",r),this.error.set(r?.message||"Error al cargar inventario")}finally{this.loading.set(!1)}})}applyFilters(){let r=this.productos();if(this.searchTerm()){let e=this.searchTerm().toLowerCase();r=r.filter(o=>o.nombre.toLowerCase().includes(e)||o.codigo.toLowerCase().includes(e))}this.selectedCategory()&&(r=r.filter(e=>e.categoria===this.selectedCategory())),this.filteredProductos.set(r)}onSearchChange(r){let e=r.target.value;this.searchTerm.set(e),this.applyFilters()}onCategoryChange(r){let e=r.target.value;this.selectedCategory.set(e),this.applyFilters()}openModal(r,e){if(this.modalType.set(r),this.selectedProducto.set(e),r==="salida"){let o=this.inventarios().find(n=>n.producto_id===e.id&&n.estado==="disponible"&&n.cantidad>0);this.selectedInventario.set(o||null)}this.showModal.set(!0),this.resetForm()}closeModal(){this.showModal.set(!1),this.resetForm()}resetForm(){this.cantidad=0,this.motivo="",this.ubicacion="sede_principal"}submitMovimiento(){return C(this,null,function*(){if(!(!this.selectedProducto()||this.cantidad<=0)){this.loading.set(!0);try{let e=(yield this._supabaseService.getSession())?.user?.id;if(!e)throw new Error("Usuario no autenticado");let o=this.selectedProducto(),n;if(this.modalType()==="entrada"){let s=this.inventarios().find(m=>m.producto_id===o.id&&m.ubicacion===this.ubicacion&&m.estado==="disponible");if(s)n=s.id,yield this._supabaseService.updateInventario(n,s.cantidad+this.cantidad);else{let{data:m,error:w}=yield this._supabaseService.client.from("inventario").insert({producto_id:o.id,cantidad:this.cantidad,ubicacion:this.ubicacion,estado:"disponible"}).select().single();if(w)throw w;n=m.id}}else{let s=this.selectedInventario();if(!s||s.cantidad<this.cantidad)throw new Error("Stock insuficiente");n=s.id,yield this._supabaseService.updateInventario(n,s.cantidad-this.cantidad)}yield this._supabaseService.createMovimiento({inventario_id:n,producto_id:o.id,tipo:this.modalType(),cantidad:this.modalType()==="entrada"?this.cantidad:-this.cantidad,motivo:this.motivo||`${this.modalType()} de inventario`,usuario_id:e}),yield this.loadData(),this.closeModal()}catch(r){console.error("Error en movimiento:",r),this.error.set(r?.message||"Error al procesar movimiento")}finally{this.loading.set(!1)}}})}getStockColor(r){return r.stock_total===0?"text-red-600":r.stock_bajo?"text-yellow-600":"text-green-600"}getStockIcon(r){return r.stock_total===0?"\u274C":r.stock_bajo?"\u26A0\uFE0F":"\u2705"}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=B({type:l,selectors:[["app-inventario-list"]],decls:21,vars:10,consts:[["form","ngForm"],[1,"bg-gray-50","dark:bg-gray-900","min-h-screen"],[1,"px-6","py-8","mx-auto","max-w-7xl"],[1,"flex","flex-col","items-center","mb-6"],[1,"flex","items-center","gap-4","mb-4"],["src","https://www.implameq.com/wp-content/uploads/logotipo-impla-300x78.png.webp","alt","Implameq Logo",1,"h-12"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],[1,"text-sm","text-gray-600","dark:text-gray-300"],[1,"flex","gap-2","w-full","max-w-md"],[1,"flex-1","text-white","bg-gray-600","hover:bg-gray-700","focus:ring-4","focus:outline-none","focus:ring-gray-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-gray-600","dark:hover:bg-gray-700","dark:focus:ring-gray-800",3,"routerLink"],[1,"flex-1","text-gray-900","bg-lime-400","hover:bg-lime-500","focus:ring-4","focus:outline-none","focus:ring-lime-300","font-bold","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-lime-400","dark:hover:bg-lime-500","dark:focus:ring-lime-500",3,"routerLink"],["class","w-full bg-white rounded-lg shadow dark:border sm:max-w-md xl:p-0 dark:bg-gray-800 dark:border-gray-700 mx-auto",4,"ngIf"],["class","w-full bg-white rounded-lg shadow dark:border dark:bg-gray-800 dark:border-gray-700 mx-auto mb-6",4,"ngIf"],["class","space-y-4",4,"ngIf"],["class","w-full bg-white rounded-lg shadow dark:border dark:bg-gray-800 dark:border-gray-700 mx-auto",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",4,"ngIf"],[1,"w-full","bg-white","rounded-lg","shadow","dark:border","sm:max-w-md","xl:p-0","dark:bg-gray-800","dark:border-gray-700","mx-auto"],[1,"p-6","space-y-4","md:space-y-6","sm:p-8","text-center"],[1,"animate-pulse"],[1,"h-4","bg-gray-200","rounded","w-3/4","mx-auto","mb-2"],[1,"h-4","bg-gray-200","rounded","w-1/2","mx-auto"],[1,"text-sm","text-gray-500"],[1,"text-red-600","dark:text-red-400"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"text-sm"],["type","button",1,"w-full","text-white","bg-red-600","hover:bg-red-700","focus:ring-4","focus:outline-none","focus:ring-red-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-red-600","dark:hover:bg-red-700","dark:focus:ring-red-800",3,"click"],[1,"w-full","bg-white","rounded-lg","shadow","dark:border","dark:bg-gray-800","dark:border-gray-700","mx-auto","mb-6"],[1,"p-6","space-y-4"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white","text-center","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","text","placeholder","Buscar por nombre o c\xF3digo...",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-lime-400","focus:border-lime-400","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-lime-400","dark:focus:border-lime-400",3,"input","value"],[1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-lime-400","focus:border-lime-400","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-lime-400","dark:focus:border-lime-400",3,"change","value"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"text-center","pt-2","border-t"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","font-medium","bg-blue-100","text-blue-800","dark:bg-blue-900","dark:text-blue-300"],[3,"value"],[1,"space-y-4"],["class","w-full bg-white rounded-lg shadow dark:border dark:bg-gray-800 dark:border-gray-700",4,"ngFor","ngForOf"],[1,"w-full","bg-white","rounded-lg","shadow","dark:border","dark:bg-gray-800","dark:border-gray-700"],[1,"p-4","border-b","border-gray-200","dark:border-gray-700"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"font-semibold","text-gray-900","dark:text-white"],[1,"text-sm","text-gray-600","dark:text-gray-300","mt-1"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-blue-100","text-blue-800","dark:bg-blue-900","dark:text-blue-300"],[1,"p-4","space-y-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-2xl"],[1,"text-xl","font-bold"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"text-right"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white"],["class","border-t pt-3",4,"ngIf"],[1,"flex","gap-3","pt-2"],[1,"flex-1","text-white","bg-green-600","hover:bg-green-700","focus:ring-4","focus:outline-none","focus:ring-green-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-green-600","dark:hover:bg-green-700","dark:focus:ring-green-800",3,"click"],[1,"flex-1","text-white","bg-red-600","hover:bg-red-700","focus:ring-4","focus:outline-none","focus:ring-red-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-red-600","dark:hover:bg-red-700","dark:focus:ring-red-800","disabled:bg-gray-400","disabled:cursor-not-allowed","dark:disabled:bg-gray-600",3,"click","disabled"],[1,"border-t","pt-3"],[1,"text-sm","text-gray-600","dark:text-gray-300","mb-2"],[1,"grid","grid-cols-2","gap-2"],["class","flex justify-between text-sm",4,"ngFor","ngForOf"],[1,"flex","justify-between","text-sm"],[1,"text-gray-600","dark:text-gray-400"],[1,"w-full","bg-white","rounded-lg","shadow","dark:border","dark:bg-gray-800","dark:border-gray-700","mx-auto"],[1,"text-gray-400","dark:text-gray-500"],[1,"text-4xl","mb-4"],[1,"text-lg","font-medium","text-gray-900","dark:text-white","mb-2"],[1,"text-gray-500","dark:text-gray-400"],["type","button",1,"w-full","text-gray-900","bg-lime-400","hover:bg-lime-500","focus:ring-4","focus:outline-none","focus:ring-lime-300","font-bold","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-lime-400","dark:hover:bg-lime-500","dark:focus:ring-lime-500",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","p-4","z-50"],[1,"w-full","bg-white","rounded-lg","shadow","dark:border","sm:max-w-md","xl:p-0","dark:bg-gray-800","dark:border-gray-700"],[1,"p-6","space-y-4","md:space-y-6","sm:p-8"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white","text-center"],[1,"text-center","border-b","pb-4","mb-4"],[1,"font-medium","text-gray-900","dark:text-white"],[1,"space-y-4",3,"ngSubmit"],["type","number","name","cantidad","min","1","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-lime-400","focus:border-lime-400","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-lime-400","dark:focus:border-lime-400",3,"ngModelChange","ngModel","max"],["class","text-xs text-gray-500 dark:text-gray-400 mt-1",4,"ngIf"],[4,"ngIf"],["type","text","name","motivo","placeholder","Descripci\xF3n del movimiento...",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-lime-400","focus:border-lime-400","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-lime-400","dark:focus:border-lime-400",3,"ngModelChange","ngModel"],[1,"space-y-3","pt-4"],["type","submit",1,"w-full","text-gray-900","bg-lime-400","hover:bg-lime-500","focus:ring-4","focus:outline-none","focus:ring-lime-300","font-bold","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-lime-400","dark:hover:bg-lime-500","dark:focus:ring-lime-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],["type","button",1,"w-full","text-white","bg-gray-600","hover:bg-gray-700","focus:ring-4","focus:outline-none","focus:ring-gray-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-gray-600","dark:hover:bg-gray-700","dark:focus:ring-gray-800",3,"click"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1"],["name","ubicacion",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-lime-400","focus:border-lime-400","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-lime-400","dark:focus:border-lime-400",3,"ngModelChange","ngModel"]],template:function(e,o){e&1&&(t(0,"section",1)(1,"div",2)(2,"div",3)(3,"div",4),I(4,"img",5),t(5,"div")(6,"h1",6),d(7,"Inventario"),i(),t(8,"p",7),d(9,"Gesti\xF3n de productos y stock"),i()()(),t(10,"div",8)(11,"a",9),d(12," \u2190 Volver "),i(),t(13,"a",10),d(14," \u{1F4CB} Movimientos "),i()()(),b(15,ce,7,0,"div",11)(16,me,9,1,"div",11)(17,ue,19,4,"div",12)(18,be,2,1,"div",13)(19,fe,11,0,"div",14),i(),b(20,ke,27,10,"div",15),i()),e&2&&(a(11),c("routerLink",L(8,le)),a(2),c("routerLink",L(9,se)),a(2),c("ngIf",o.loading()),a(),c("ngIf",!o.loading()&&o.error()),a(),c("ngIf",!o.loading()&&!o.error()),a(),c("ngIf",!o.loading()&&!o.error()&&o.filteredProductos().length>0),a(),c("ngIf",!o.loading()&&!o.error()&&o.filteredProductos().length===0),a(),c("ngIf",o.showModal()))},dependencies:[G,R,q,z,A,de,Z,ie,ne,J,ee,te,K,Q,oe,ae,re,Y,X,U,H],encapsulation:2})};export{V as default};
