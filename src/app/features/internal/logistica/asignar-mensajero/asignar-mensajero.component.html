<div class="min-h-screen bg-gradient-to-br from-[#10284C] via-[#0d1f3a] to-[#0a1829] p-4 sm:p-8">
  <div class="max-w-6xl mx-auto">
    
    <!-- Header -->
    <div class="mb-8 flex flex-col items-center gap-4">
      <h1 class="text-4xl font-bold text-white text-center">
        Asignar Mensajero
      </h1>
      
      <button
        (click)="cancelar()"
        class="px-4 py-2 bg-[#C8D900] text-[#10284C] rounded-lg hover:bg-[#d4e820] transition-colors font-medium flex items-center gap-2 active:scale-95">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        <span>Volver</span>
      </button>
    </div>

    <!-- Mensajes -->
    @if (error()) {
      <div class="mb-6 bg-red-500/20 border border-red-500 text-red-100 p-4 rounded-lg">
        {{ error() }}
      </div>
    }

    @if (exito()) {
      <div class="mb-6 bg-green-500/20 border border-green-500 text-green-100 p-4 rounded-lg">
        {{ exito() }}
      </div>
    }

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <!-- Información del Kit -->
      <div class="lg:col-span-1">
        @if (kitInfo()) {
          <div class="bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-6 shadow-xl">
            <h2 class="text-xl font-bold text-[#C8D900] mb-4">Información del Kit</h2>
            
            <div class="space-y-3 text-white">
              <div>
                <p class="text-gray-400 text-sm">Número de Kit</p>
                <p class="font-bold text-lg">{{ kitInfo().numero_kit }}</p>
              </div>

              @if (kitInfo().cirugia) {
                <div>
                  <p class="text-gray-400 text-sm">Cirugía</p>
                  <p class="font-semibold">{{ kitInfo().cirugia.numero_cirugia }}</p>
                </div>

                @if (kitInfo().cirugia.hospital) {
                  <div>
                    <p class="text-gray-400 text-sm">Hospital</p>
                    <p class="font-semibold">{{ kitInfo().cirugia.hospital.nombre }}</p>
                    <p class="text-sm text-gray-300">{{ kitInfo().cirugia.hospital.ciudad }}</p>
                  </div>
                }

                <div>
                  <p class="text-gray-400 text-sm">Fecha Cirugía</p>
                  <p class="font-semibold">{{ kitInfo().cirugia.fecha_programada | date:'dd/MM/yyyy HH:mm' }}</p>
                </div>

                <div>
                  <p class="text-gray-400 text-sm">Médico</p>
                  <p class="font-semibold">{{ kitInfo().cirugia.medico_cirujano }}</p>
                </div>
              }

              <div>
                <p class="text-gray-400 text-sm">Estado Actual</p>
                <span class="inline-block px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm font-semibold">
                  {{ kitInfo().estado }}
                </span>
              </div>
            </div>
          </div>
        }
      </div>

      <!-- Lista de Mensajeros -->
      <div class="lg:col-span-2">
        <div class="bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-6 shadow-xl">
          <h2 class="text-xl font-bold text-[#C8D900] mb-4">Mensajeros Disponibles</h2>

          <!-- Grid de Mensajeros -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[500px] overflow-y-auto pr-2">
            @for (mensajero of mensajerosFiltrados(); track mensajero.id) {
              <div 
                (click)="seleccionarMensajero(mensajero)"
                [class]="mensajeroSeleccionado()?.id === mensajero.id 
                  ? 'bg-[#C8D900]/20 border-[#C8D900] border-2' 
                  : 'bg-white/5 border-white/10 border hover:bg-white/10'"
                class="rounded-xl p-4 cursor-pointer transition-all duration-200"
              >
                <div class="flex items-start justify-between mb-3">
                  <div class="flex-1">
                    <h3 class="text-white font-bold text-lg">{{ mensajero.nombre }}</h3>
                    <p class="text-gray-400 text-sm">{{ mensajero.telefono }}</p>
                  </div>
                </div>

                <div class="space-y-2 text-sm">
                  @if (mensajero.placa) {
                    <div class="flex justify-between items-center">
                      <span class="text-gray-400">Placa:</span>
                      <span class="text-white font-mono font-semibold">{{ mensajero.placa }}</span>
                    </div>
                  }

                  <div class="flex justify-between items-center">
                    <span class="text-gray-400">Estado:</span>
                    <span 
                      [class]="mensajero.estado === 'disponible' ? 'text-green-400' : 'text-orange-400'"
                      class="font-semibold capitalize"
                    >
                      {{ mensajero.estado }}
                    </span>
                  </div>
                </div>

                @if (mensajeroSeleccionado()?.id === mensajero.id) {
                  <div class="mt-3 text-center">
                    <span class="text-[#C8D900] font-bold text-sm">✓ SELECCIONADO</span>
                  </div>
                }
              </div>
            }

            @if (mensajerosFiltrados().length === 0) {
              <div class="col-span-2 text-center py-12 text-gray-400">
                <p class="text-xl mb-2">No hay mensajeros disponibles</p>
                <p class="text-sm">Todos los mensajeros están ocupados</p>
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Formulario de Envío -->
    @if (mensajeroSeleccionado()) {
      <div class="mt-6 bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-6 shadow-xl">
        <h2 class="text-xl font-bold text-[#C8D900] mb-6">Detalles del Envío</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-white text-sm mb-2">
              Dirección Hospital <span class="text-red-400">*</span>
            </label>
            <input 
              type="text"
              [value]="direccionDestino()"
              (input)="direccionDestino.set(($any($event.target)).value)"
              class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-[#C8D900]"
              placeholder="Dirección del hospital (editable)"
            />
          </div>

          <div>
            <label class="block text-white text-sm mb-2">
              Cliente / Contacto <span class="text-red-400">*</span>
            </label>
            <input 
              type="text"
              [value]="contactoDestino()"
              (input)="contactoDestino.set(($any($event.target)).value)"
              class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-[#C8D900]"
              placeholder="Nombre del Cliente (editable)"
            />
          </div>

          <div>
            <label class="block text-white text-sm mb-2">
              Teléfono de Contacto <span class="text-red-400">*</span>
            </label>
            <input 
              type="tel"
              [value]="telefonoDestino()"
              (input)="telefonoDestino.set(($any($event.target)).value)"
              class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-[#C8D900]"
              placeholder="Teléfono de contacto (editable)"
            />
          </div>

          <div>
            <label class="block text-white text-sm mb-2">
              Fecha Programada <span class="text-red-400">*</span>
            </label>
            <input 
              type="date"
              [value]="fechaProgramada()"
              (input)="fechaProgramada.set(($any($event.target)).value)"
              class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-[#C8D900]"
            />
          </div>

          <div class="md:col-span-2">
            <label class="block text-white text-sm mb-2">Observaciones</label>
            <textarea 
              [value]="observaciones()"
              (input)="observaciones.set(($any($event.target)).value)"
              rows="3"
              class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-[#C8D900]"
              placeholder="Observaciones adicionales sobre el envío..."
            ></textarea>
          </div>
        </div>

        <!-- Botones de Acción -->
        <div class="flex justify-end gap-4 mt-6">
          <button
            (click)="cancelar()"
            [disabled]="cargando()"
            class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors disabled:opacity-50"
          >
            Cancelar
          </button>

          <button
            (click)="asignarYDespachar()"
            [disabled]="cargando() || !mensajeroSeleccionado() || !direccionDestino() || !fechaProgramada() || !contactoDestino() || !telefonoDestino()"
            class="px-6 py-3 bg-gradient-to-r from-[#C8D900] to-[#a8b500] hover:from-[#a8b500] hover:to-[#8a9600] text-[#10284C] rounded-lg font-bold transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
          >
            @if (cargando()) {
              <span>Asignando...</span>
            } @else {
              <span>Asignar y Despachar</span>
            }
          </button>
        </div>
      </div>
    }

  </div>
</div>
