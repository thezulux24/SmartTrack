<section class="bg-gray-50 dark:bg-gray-900 min-h-screen">
  <!-- Header con estilo similar al welcome -->
  <div class="px-6 py-8 mx-auto max-w-7xl">
    <!-- Logo y t√≠tulo -->
    <div class="flex flex-col items-center mb-6">
      <div class="flex items-center gap-4 mb-4">
        <img src="https://www.implameq.com/wp-content/uploads/2020/08/logo-implameq.svg" 
             alt="Implameq Logo" 
             class="h-12 w-auto">
        <div>
          <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Inventario</h1>
          <p class="text-sm text-gray-600 dark:text-gray-300">Gesti√≥n de productos y stock</p>
        </div>
      </div>
      
      <!-- Bot√≥n volver y movimientos -->
      <div class="flex gap-2 w-full max-w-md">
        <a [routerLink]="['/internal']" 
           class="flex-1 text-white bg-gray-600 hover:bg-gray-700 focus:ring-4 focus:outline-none 
                  focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center 
                  dark:bg-gray-600 dark:hover:bg-gray-700 dark:focus:ring-gray-800">
          ‚Üê Volver
        </a>
        <!-- ‚úÖ Nuevo bot√≥n para crear producto -->
        <a [routerLink]="['nuevo-producto']" 
           class="flex-1 text-gray-900 bg-lime-400 hover:bg-lime-500 focus:ring-4 focus:outline-none 
                  focus:ring-lime-300 font-bold rounded-lg text-sm px-5 py-2.5 text-center 
                  dark:bg-lime-400 dark:hover:bg-lime-500 dark:focus:ring-lime-500">
          ‚ûï Nuevo
        </a>
        <a [routerLink]="['movimientos']" 
           class="flex-1 text-gray-900 bg-lime-400 hover:bg-lime-500 focus:ring-4 focus:outline-none 
                  focus:ring-lime-300 font-bold rounded-lg text-sm px-5 py-2.5 text-center 
                  dark:bg-lime-400 dark:hover:bg-lime-500 dark:focus:ring-lime-500">
          üìã Movimientos
        </a>
      </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="loading()" class="w-full bg-white rounded-lg shadow dark:border sm:max-w-md xl:p-0 dark:bg-gray-800 dark:border-gray-700 mx-auto">
      <div class="p-6 space-y-4 md:space-y-6 sm:p-8 text-center">
        <div class="animate-pulse">
          <div class="h-4 bg-gray-200 rounded w-3/4 mx-auto mb-2"></div>
          <div class="h-4 bg-gray-200 rounded w-1/2 mx-auto"></div>
        </div>
        <p class="text-sm text-gray-500">Cargando inventario...</p>
      </div>
    </div>

    <!-- Error state -->
    <div *ngIf="!loading() && error()" class="w-full bg-white rounded-lg shadow dark:border sm:max-w-md xl:p-0 dark:bg-gray-800 dark:border-gray-700 mx-auto">
      <div class="p-6 space-y-4 md:space-y-6 sm:p-8 text-center">
        <div class="text-red-600 dark:text-red-400">
          <svg class="w-12 h-12 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
          <p class="text-sm">{{ error() }}</p>
        </div>
        <button type="button" (click)="loadData()"
                class="w-full text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:outline-none 
                       focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center 
                       dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800">
          Reintentar
        </button>
      </div>
    </div>

    <!-- Filtros -->
    <div *ngIf="!loading() && !error()" class="w-full bg-white rounded-lg shadow dark:border dark:bg-gray-800 dark:border-gray-700 mx-auto mb-6">
      <div class="p-6 space-y-4">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white text-center mb-4">
          Filtros de B√∫squeda
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- B√∫squeda -->
          <div>
            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Buscar</label>
            <input type="text" 
                   [value]="searchTerm()"
                   (input)="onSearchChange($event)"
                   placeholder="Buscar por nombre o c√≥digo..."
                   class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg 
                          focus:ring-lime-400 focus:border-lime-400 block w-full p-2.5 
                          dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white 
                          dark:focus:ring-lime-400 dark:focus:border-lime-400">
          </div>

          <!-- Categor√≠a -->
          <div>
            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Categor√≠a</label>
            <select [value]="selectedCategory()"
                    (change)="onCategoryChange($event)"
                    class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg 
                           focus:ring-lime-400 focus:border-lime-400 block w-full p-2.5 
                           dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white 
                           dark:focus:ring-lime-400 dark:focus:border-lime-400">
              <option value="">Todas las categor√≠as</option>
              <option *ngFor="let cat of categorias" [value]="cat">
                {{ cat | titlecase }}
              </option>
            </select>
          </div>
        </div>

        <!-- Resumen -->
        <div class="text-center pt-2 border-t">
          <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
            üì¶ {{ filteredProductos().length }} productos encontrados
          </div>
        </div>
      </div>
    </div>

    <!-- Lista de Productos -->
    <div *ngIf="!loading() && !error() && filteredProductos().length > 0" class="space-y-4">
      <div *ngFor="let producto of filteredProductos()" 
           class="w-full bg-white rounded-lg shadow dark:border dark:bg-gray-800 dark:border-gray-700">
        
        <!-- Header del producto -->
        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <h3 class="font-semibold text-gray-900 dark:text-white">{{ producto.nombre }}</h3>
              <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">{{ producto.codigo }}</p>
            </div>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
              {{ producto.categoria | titlecase }}
            </span>
          </div>
        </div>

        <!-- Contenido del producto -->
        <div class="p-4 space-y-4">
          <!-- Stock info -->
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="text-2xl">{{ getStockIcon(producto) }}</span>
              <div>
                <div class="text-xl font-bold" [class]="getStockColor(producto)">
                  {{ producto.stock_total }} unidades
                </div>
                <div class="text-sm text-gray-500 dark:text-gray-400">
                  M√≠nimo: {{ producto.stock_minimo }}
                </div>
              </div>
            </div>
            
            <div class="text-right">
              <div class="text-lg font-semibold text-gray-900 dark:text-white">
                ${{ producto.precio | number:'1.0-0' }}
              </div>
            </div>
          </div>

          <!-- Stock por ubicaci√≥n -->
          <div *ngIf="producto.inventario?.length > 0" class="border-t pt-3">
            <div class="text-sm text-gray-600 dark:text-gray-300 mb-2">Stock por ubicaci√≥n:</div>
            <div class="grid grid-cols-1 gap-2">
              <div *ngFor="let inv of producto.inventario" class="flex justify-between text-sm">
                <!-- ‚úÖ Usar funci√≥n de formateo -->
                <span class="text-gray-600 dark:text-gray-400">{{ formatUbicacion(inv.ubicacion) }}</span>
                <span [class]="inv.cantidad > 0 ? 'text-green-600 dark:text-green-400' : 'text-red-500 dark:text-red-400'">
                  {{ inv.cantidad }}
                </span>
              </div>
            </div>
          </div>

          <!-- Acciones -->
          <div class="flex gap-3 pt-2">
            <button (click)="openModal('entrada', producto)"
                    class="flex-1 text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:outline-none 
                           focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center 
                           dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">
              ‚ûï Entrada
            </button>
            <button (click)="openModal('salida', producto)"
                    [disabled]="producto.stock_total === 0"
                    class="flex-1 text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:outline-none 
                           focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center 
                           dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800
                           disabled:bg-gray-400 disabled:cursor-not-allowed dark:disabled:bg-gray-600">
              ‚ûñ Salida
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Sin resultados -->
    <div *ngIf="!loading() && !error() && filteredProductos().length === 0" 
         class="w-full bg-white rounded-lg shadow dark:border dark:bg-gray-800 dark:border-gray-700 mx-auto">
      <div class="p-6 space-y-4 md:space-y-6 sm:p-8 text-center">
        <div class="text-gray-400 dark:text-gray-500">
          <div class="text-4xl mb-4">üì¶</div>
          <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No se encontraron productos</h3>
          <p class="text-gray-500 dark:text-gray-400">Intenta ajustar los filtros de b√∫squeda</p>
        </div>
        <button type="button" (click)="loadData()"
                class="w-full text-gray-900 bg-lime-400 hover:bg-lime-500 focus:ring-4 focus:outline-none 
                       focus:ring-lime-300 font-bold rounded-lg text-sm px-5 py-2.5 text-center 
                       dark:bg-lime-400 dark:hover:bg-lime-500 dark:focus:ring-lime-500">
          Recargar inventario
        </button>
      </div>
    </div>
  </div>

  <!-- Modal con estilo Implameq -->
  <div *ngIf="showModal()" 
       class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50"
       (click)="closeModal()">
    <div class="w-full max-w-md" (click)="$event.stopPropagation()">
      <!-- Background with gradient and surgical image -->
      <div class="relative min-h-[600px] bg-gradient-to-b from-[#10284C] via-[#10284C] to-[#0098A8] rounded-lg overflow-hidden">
        <!-- Surgical background image with overlay -->
        <div class="absolute inset-0 bg-cover bg-center opacity-10"
             style="background-image: url('/02.jpg')"></div>

        <!-- Content -->
        <div class="relative z-10 p-6">
          <!-- Header -->
          <div class="flex items-center mb-8">
            <div class="flex items-center gap-2">
              <img 
                src="https://www.implameq.com/wp-content/uploads/logotipo-impla-300x78.png.webp" 
                alt="Implameq" 
                class="h-8 brightness-0 invert" />
            </div>
          </div>

          <!-- Title and product info -->
          <div class="text-center mb-6">
            <h2 class="text-2xl font-bold text-[#CBDD00] mb-2">
              {{ modalType() === 'entrada' ? 'Entrada de Inventario' : 'Salida de Inventario' }}
            </h2>
            <p class="text-white text-sm mb-1">{{ selectedProducto()?.nombre }}</p>
            <p class="text-white/70 text-xs">{{ selectedProducto()?.codigo }}</p>
          </div>

          <!-- Form card -->
          <div class="bg-[#10284C]/80 backdrop-blur-sm rounded-lg p-6 space-y-4">
            <form (ngSubmit)="submitMovimiento()" #form="ngForm" class="space-y-4">
              <!-- Cantidad -->
              <div>
                <label class="block text-white text-sm font-medium mb-2">Cantidad*</label>
                <input type="number" 
                       [(ngModel)]="cantidad"
                       name="cantidad"
                       min="1"
                       [max]="modalType() === 'salida' ? (selectedInventario()?.cantidad ?? 999) : 999"
                       required
                       class="w-full px-4 py-3 bg-[#0098A8]/40 border-0 rounded text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-[#CBDD00]">
                <div *ngIf="modalType() === 'salida' && selectedInventario()" 
                     class="text-white/60 text-xs mt-1">
                  Disponible: {{ selectedInventario()?.cantidad }}
                </div>
              </div>

              <!-- Ubicaci√≥n (para entradas y salidas) -->
              <div>
                <label class="block text-white text-sm font-medium mb-2">
                  {{ modalType() === 'entrada' ? 'Ubicaci√≥n de destino*' : 'Ubicaci√≥n de origen*' }}
                </label>
                <select [(ngModel)]="ubicacion" 
                        name="ubicacion"
                        required
                        class="w-full px-4 py-3 bg-[#0098A8]/40 border-0 rounded text-white focus:outline-none focus:ring-2 focus:ring-[#CBDD00]">
                  <option value="" class="bg-[#10284C]">Selecciona una ubicaci√≥n</option>
                  
                  <optgroup label="üè¢ Sedes Principales" class="bg-[#10284C]">
                    <option value="sede_principal_norte" class="bg-[#10284C]">Sede Principal Norte</option>
                    <option value="sede_principal_sur" class="bg-[#10284C]">Sede Principal Sur</option>
                  </optgroup>

                  <optgroup label="üè¨ Sedes Secundarias" class="bg-[#10284C]">
                    <option value="sede_secundaria_este" class="bg-[#10284C]">Sede Secundaria Este</option>
                    <option value="sede_secundaria_oeste" class="bg-[#10284C]">Sede Secundaria Oeste</option>
                  </optgroup>

                  <optgroup label="üì¶ Bodegas" class="bg-[#10284C]">
                    <option value="bodega_central" class="bg-[#10284C]">Bodega Central</option>
                    <option value="bodega_norte" class="bg-[#10284C]">Bodega Norte</option>
                    <option value="bodega_sur" class="bg-[#10284C]">Bodega Sur</option>
                  </optgroup>

                  <optgroup label="üè• Quir√≥fanos" class="bg-[#10284C]">
                    <option value="quirofano_sede_norte_1" class="bg-[#10284C]">Quir√≥fano Norte 1</option>
                    <option value="quirofano_sede_norte_2" class="bg-[#10284C]">Quir√≥fano Norte 2</option>
                    <option value="quirofano_sede_sur_1" class="bg-[#10284C]">Quir√≥fano Sur 1</option>
                    <option value="quirofano_sede_sur_2" class="bg-[#10284C]">Quir√≥fano Sur 2</option>
                  </optgroup>

                  <optgroup label="üö® Emergencias" class="bg-[#10284C]">
                    <option value="emergencia_norte" class="bg-[#10284C]">Emergencia Norte</option>
                    <option value="emergencia_sur" class="bg-[#10284C]">Emergencia Sur</option>
                  </optgroup>

                  <optgroup label="‚ö° √Åreas Especiales" class="bg-[#10284C]">
                    <option value="esterilizacion_central" class="bg-[#10284C]">Esterilizaci√≥n Central</option>
                  </optgroup>
                </select>
              </div>

              <!-- Motivo -->
              <div>
                <label class="block text-white text-sm font-medium mb-2">Motivo (opcional)</label>
                <textarea 
                   [(ngModel)]="motivo"
                   name="motivo"
                   rows="3"
                   placeholder="Descripci√≥n del movimiento..."
                   class="w-full px-4 py-3 bg-[#0098A8]/40 border-0 rounded text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-[#CBDD00] resize-none"></textarea>
              </div>

              <!-- Action buttons -->
              <div class="space-y-3 pt-2">
                <button type="submit" 
                        [disabled]="!form.valid || loading()"
                        class="w-full bg-[#CBDD00] hover:bg-[#b5c700] text-[#10284C] font-bold py-3 text-base rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                  {{ modalType() === 'entrada' ? 'Registrar Entrada' : 'Registrar Salida' }}
                </button>
                
                <button type="button" 
                        (click)="closeModal()"
                        class="w-full bg-[#CBDD00] hover:bg-[#b5c700] text-[#10284C] font-bold py-3 text-base rounded-lg transition-colors">
                  Cancelar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>