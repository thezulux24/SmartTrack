import{a as ee}from"./chunk-CEARFURE.js";import{a as W}from"./chunk-SJD6D2CV.js";import{c as j,d as M,f as S,g as R,h as P}from"./chunk-W4BNGQYG.js";import{a as H}from"./chunk-C4VFUW4K.js";import{a as G}from"./chunk-X5R2JH3I.js";import{c as O,j as I,p as z,q as J,t as Q,v as B}from"./chunk-3OSVPALZ.js";import{$ as f,Ab as N,Bb as u,Ia as a,S as v,Sa as E,Xa as C,Y as x,Z as _,_ as d,bb as Z,cb as y,eb as V,ib as w,la as b,lb as A,mb as D,nb as t,ob as n,pb as c,qb as k,tb as p,ub as m,zb as l}from"./chunk-MBDN4FSM.js";import"./chunk-X5YLR3NI.js";import{i as g}from"./chunk-ODN5LVDJ.js";var ne=(r,i)=>i.id;function oe(r,i){if(r&1&&(t(0,"span",4),c(1,"span",5),t(2,"span",6),l(3),n()()),r&2){let e=m();a(3),u(" ",e.notificationService.unreadCount()>9?"9+":e.notificationService.unreadCount()," ")}}function re(r,i){if(r&1&&(t(0,"span",13),l(1),n()),r&2){let e=m(2);a(),u(" (",e.notificationService.unreadCount()," nuevas) ")}}function ae(r,i){if(r&1){let e=k();t(0,"button",24),p("click",function(){x(e);let s=m(2);return _(s.markAllAsRead())}),t(1,"span",25),l(2,"Marcar todas"),n(),t(3,"span",26),l(4,"Marcar"),n()()}}function le(r,i){r&1&&(t(0,"div",22),d(),t(1,"svg",27),c(2,"path",3),n(),f(),t(3,"p",28),l(4,"No hay notificaciones"),n()())}function se(r,i){r&1&&c(0,"span",36)}function ce(r,i){if(r&1){let e=k();t(0,"div",30),p("click",function(){let s=x(e).$implicit,h=m(3);return _(h.handleNotificationClick(s))}),t(1,"div",31)(2,"div",32),l(3),n(),t(4,"div",33)(5,"div",34)(6,"h4",35),l(7),n(),C(8,se,1,0,"span",36),n(),t(9,"p",37),l(10),n(),t(11,"p",38),l(12),n()(),t(13,"div",39)(14,"button",40),p("click",function(s){let h=x(e).$implicit,T=m(3);return _(T.deleteNotification(s,h.id))}),d(),t(15,"svg",41),c(16,"path",42),n()()()()()}if(r&2){let e=i.$implicit,o=m(3);V("bg-blue-50",!e.read),a(2),y("ngClass",e.icon_color),a(),u(" ",e.icon," "),a(3),V("text-gray-900",!e.read)("text-gray-600",e.read),a(),u(" ",e.title," "),a(),w(e.read?-1:8),a(2),u(" ",e.message," "),a(2),u(" ",o.formatDate(e.created_at)," ")}}function de(r,i){if(r&1&&A(0,ce,17,12,"div",29,ne),r&2){let e=m(2);D(e.displayedNotifications())}}function me(r,i){if(r&1){let e=k();t(0,"div",23)(1,"button",43),p("click",function(){x(e);let s=m(2);return _(s.clearAll())}),l(2," Limpiar todas "),n()()}}function pe(r,i){if(r&1){let e=k();t(0,"div",7),p("click",function(){x(e);let s=m();return _(s.togglePanel())}),n(),t(1,"div",8)(2,"div",9),c(3,"div",10),t(4,"div",11)(5,"h3",12),l(6," Notificaciones "),C(7,re,2,1,"span",13),n(),t(8,"div",14),C(9,ae,5,0,"button",15),t(10,"button",16),p("click",function(){x(e);let s=m();return _(s.togglePanel())}),d(),t(11,"svg",17),c(12,"path",18),n()()()(),f(),t(13,"div",19)(14,"button",20),p("click",function(){x(e);let s=m();return _(s.activeTab.set("all"))}),l(15),n(),t(16,"button",20),p("click",function(){x(e);let s=m();return _(s.activeTab.set("unread"))}),l(17),n()()(),t(18,"div",21),C(19,le,5,0,"div",22)(20,de,2,0),n(),C(21,me,3,0,"div",23),n()}if(r&2){let e=m();a(7),w(e.notificationService.unreadCount()>0?7:-1),a(2),w(e.notificationService.unreadCount()>0?9:-1),a(5),V("border-blue-500",e.activeTab()==="all")("text-blue-600",e.activeTab()==="all")("border-transparent",e.activeTab()!=="all")("text-gray-500",e.activeTab()!=="all"),a(),u(" Todas (",e.notificationService.allNotifications().length,") "),a(),V("border-blue-500",e.activeTab()==="unread")("text-blue-600",e.activeTab()==="unread")("border-transparent",e.activeTab()!=="unread")("text-gray-500",e.activeTab()!=="unread"),a(),u(" No le\xEDdas (",e.notificationService.unreadCount(),") "),a(2),w(e.displayedNotifications().length===0?19:20),a(2),w(e.notificationService.allNotifications().length>0?21:-1)}}var U=class r{notificationService=v(H);isPanelOpen=b(!1);activeTab=b("all");displayedNotifications=()=>this.activeTab()==="all"?this.notificationService.allNotifications():this.notificationService.unreadNotifications();togglePanel(){this.isPanelOpen.update(i=>!i)}closePanel(){this.isPanelOpen.set(!1)}handleNotificationClick(i){return g(this,null,function*(){yield this.notificationService.navigateToNotification(i),this.closePanel()})}markAllAsRead(){return g(this,null,function*(){yield this.notificationService.markAllAsRead()})}deleteNotification(i,e){return g(this,null,function*(){i.stopPropagation(),yield this.notificationService.deleteNotification(e)})}clearAll(){return g(this,null,function*(){confirm("\xBFEst\xE1s seguro de que quieres eliminar todas las notificaciones?")&&(yield this.notificationService.clearAll(),this.closePanel())})}formatDate(i){let e=new Date(i),s=new Date().getTime()-e.getTime(),h=Math.floor(s/6e4),T=Math.floor(s/36e5),L=Math.floor(s/864e5);return h<1?"Ahora":h<60?`Hace ${h} min`:T<24?`Hace ${T} h`:L<7?`Hace ${L} d\xEDas`:e.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=E({type:r,selectors:[["app-notification-panel"]],decls:6,vars:4,consts:[[1,"relative"],[1,"relative","p-2","text-gray-600","hover:text-gray-900","hover:bg-gray-100","rounded-lg","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"],[1,"absolute","top-1","right-1","flex","h-4","w-4"],[1,"animate-ping","absolute","inline-flex","h-full","w-full","rounded-full","bg-red-400","opacity-75"],[1,"relative","inline-flex","rounded-full","h-4","w-4","bg-red-500","text-white","text-[10px]","items-center","justify-center","font-bold"],[1,"fixed","inset-0","bg-black/50","z-40","md:hidden",3,"click"],[1,"fixed","md:absolute","inset-x-0","bottom-0","md:inset-x-auto","md:bottom-auto","md:right-0","md:mt-2","w-full","md:w-96","bg-white","rounded-t-2xl","md:rounded-lg","shadow-2xl","border-t","md:border","border-gray-200","z-50","max-h-[80vh]","md:max-h-[600px]","flex","flex-col"],[1,"p-4","border-b","border-gray-200","sticky","top-0","bg-white","z-10"],[1,"md:hidden","w-12","h-1","bg-gray-300","rounded-full","mx-auto","mb-3"],[1,"flex","items-center","justify-between"],[1,"font-semibold","text-gray-900","text-base","md:text-lg"],[1,"ml-2","text-xs","md:text-sm","text-gray-500"],[1,"flex","gap-2","items-center"],[1,"text-xs","md:text-sm","text-blue-600","hover:text-blue-800","font-medium","whitespace-nowrap"],[1,"text-gray-400","hover:text-gray-600","p-1",3,"click"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5"],["fill-rule","evenodd","d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule","evenodd"],[1,"flex","gap-3","md:gap-4","mt-3"],[1,"text-xs","md:text-sm","font-medium","pb-2","border-b-2","transition-colors",3,"click"],[1,"flex-1","overflow-y-auto"],[1,"p-8","text-center","text-gray-500"],[1,"p-3","border-t","border-gray-200","bg-gray-50","sticky","bottom-0"],[1,"text-xs","md:text-sm","text-blue-600","hover:text-blue-800","font-medium","whitespace-nowrap",3,"click"],[1,"hidden","md:inline"],[1,"md:hidden"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto","mb-4","text-gray-300"],[1,"text-sm"],[1,"p-3","md:p-4","border-b","border-gray-100","hover:bg-gray-50","active:bg-gray-100","cursor-pointer","transition-colors",3,"bg-blue-50"],[1,"p-3","md:p-4","border-b","border-gray-100","hover:bg-gray-50","active:bg-gray-100","cursor-pointer","transition-colors",3,"click"],[1,"flex","items-start","gap-2","md:gap-3"],[1,"text-xl","md:text-2xl","flex-shrink-0",3,"ngClass"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between","gap-2"],[1,"font-medium","text-xs","md:text-sm","leading-tight"],[1,"flex-shrink-0","w-2","h-2","bg-blue-500","rounded-full","mt-1"],[1,"text-[11px]","md:text-xs","text-gray-600","mt-1","line-clamp-2","leading-snug"],[1,"text-[10px]","md:text-xs","text-gray-400","mt-1.5","md:mt-2"],[1,"flex-shrink-0"],["title","Eliminar",1,"text-gray-400","hover:text-red-600","active:text-red-700","transition-colors","p-1","md:p-1.5",3,"click"],["fill","currentColor","viewBox","0 0 20 20",1,"w-3.5","h-3.5","md:w-4","md:h-4"],["fill-rule","evenodd","d","M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule","evenodd"],[1,"w-full","text-xs","md:text-sm","text-red-600","hover:text-red-800","active:text-red-900","font-medium","py-2","md:py-2.5","rounded-lg","hover:bg-red-50","active:bg-red-100","transition-colors",3,"click"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"button",1),p("click",function(){return o.togglePanel()}),d(),t(2,"svg",2),c(3,"path",3),n(),C(4,oe,4,1,"span",4),n(),C(5,pe,22,22),n()),e&2&&(a(),V("bg-gray-100",o.isPanelOpen()),a(3),w(o.notificationService.unreadCount()>0?4:-1),a(),w(o.isPanelOpen()?5:-1))},dependencies:[I,O],styles:[".line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}"]})};var ue=(r,i)=>i.id;function fe(r,i){if(r&1){let e=k();t(0,"div",2),p("click",function(){let s=x(e).$implicit,h=m();return _(h.handleToastClick(s))}),t(1,"div",3)(2,"div",4),l(3),n(),t(4,"div",5)(5,"h4",6),l(6),n(),t(7,"p",7),l(8),n()(),t(9,"button",8),p("click",function(s){let h=x(e).$implicit,T=m();return _(T.closeToast(s,h.id))}),d(),t(10,"svg",9),c(11,"path",10),n()()(),f(),t(12,"div",11),c(13,"div",12),n()()}if(r&2){let e=i.$implicit,o=m();y("ngClass",o.getBorderColor(e.priority))("@slideIn",void 0),a(2),y("ngClass",e.icon_color),a(),u(" ",e.icon," "),a(3),u(" ",e.title," "),a(2),u(" ",e.message," "),a(5),y("ngClass",o.getProgressColor(e.priority))}}var F=class r{notificationService=v(H);router=v(z);getBorderColor(i){return{low:"border-gray-400",medium:"border-blue-500",high:"border-orange-500",urgent:"border-red-500"}[i]||"border-gray-400"}getProgressColor(i){return{low:"bg-gray-400",medium:"bg-blue-500",high:"bg-orange-500",urgent:"bg-red-500"}[i]||"bg-gray-400"}handleToastClick(i){return g(this,null,function*(){yield this.notificationService.navigateToNotification(i),this.notificationService.removeToast(i.id)})}closeToast(i,e){i.stopPropagation(),this.notificationService.removeToast(e)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=E({type:r,selectors:[["app-notification-toast"]],decls:3,vars:0,consts:[[1,"fixed","top-4","right-4","left-4","md:left-auto","z-50","space-y-2","max-w-md","md:max-w-md","mx-auto","md:mx-0"],[1,"bg-white","rounded-lg","shadow-2xl","border-l-4","overflow-hidden","transform","transition-all","duration-300","hover:scale-[1.02]","active:scale-100","cursor-pointer",3,"ngClass"],[1,"bg-white","rounded-lg","shadow-2xl","border-l-4","overflow-hidden","transform","transition-all","duration-300","hover:scale-[1.02]","active:scale-100","cursor-pointer",3,"click","ngClass"],[1,"p-3","md:p-4","flex","items-start","gap-2","md:gap-3"],[1,"text-xl","md:text-2xl","flex-shrink-0",3,"ngClass"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-gray-900","text-xs","md:text-sm","mb-1","truncate"],[1,"text-gray-600","text-[11px]","md:text-xs","line-clamp-2","leading-snug"],[1,"flex-shrink-0","text-gray-400","hover:text-gray-600","active:text-gray-700","transition-colors","p-1",3,"click"],["fill","currentColor","viewBox","0 0 20 20",1,"w-3.5","h-3.5","md:w-4","md:h-4"],["fill-rule","evenodd","d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule","evenodd"],[1,"h-1","bg-gray-100"],[1,"h-full","transition-all","duration-[5000ms]","ease-linear",2,"width","0%","animation","progressBar 5s linear",3,"ngClass"]],template:function(e,o){e&1&&(t(0,"div",0),A(1,fe,14,7,"div",1,ue),n()),e&2&&(a(),D(o.notificationService.activeToasts()))},dependencies:[I,O],styles:["@keyframes _ngcontent-%COMP%_progressBar{0%{width:100%}to{width:0%}}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}"],data:{animation:[j("slideIn",[P(":enter",[S({transform:"translateX(400px)",opacity:0}),M("300ms ease-out",S({transform:"translateX(0)",opacity:1}))]),P(":leave",[M("200ms ease-in",S({transform:"translateX(400px)",opacity:0}))])])]}})};function ge(r,i){r&1&&c(0,"div",2)}function he(r,i){if(r&1){let e=k();t(0,"div",53),p("click",function(){x(e);let s=m();return _(s.closeMenu())}),n()}r&2&&y("@fadeIn",void 0)}var $=class r{supabaseService=v(B);authService=v(G);router=v(z);isMenuOpen=b(!1);userProfile=b(null);ngOnInit(){return g(this,null,function*(){yield this.loadUserProfile()})}loadUserProfile(){return g(this,null,function*(){try{let i=yield this.supabaseService.getSession();if(i?.user?.id){let e=yield this.supabaseService.getUserProfile(i.user.id);e&&this.userProfile.set({full_name:e.full_name||"Usuario",email:i.user.email||"Sin email",role:e.role||"Sin rol"})}}catch(i){console.error("Error loading user profile:",i)}})}toggleMenu(){this.isMenuOpen.set(!this.isMenuOpen())}closeMenu(){this.isMenuOpen.set(!1)}getInitial(){return(this.userProfile()?.full_name||"U").charAt(0).toUpperCase()}getRoleDisplay(){let i=this.userProfile()?.role||"";return{admin:"Administrador",comercial:"Comercial",logistica:"Log\xEDstica",soporte_tecnico:"Soporte T\xE9cnico",client:"Cliente"}[i]||i}navigateTo(i){this.closeMenu(),this.router.navigate([i])}logout(){return g(this,null,function*(){this.closeMenu(),yield this.authService.logOut(),this.router.navigate(["/auth/log-in"])})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=E({type:r,selectors:[["app-profile-menu"]],decls:79,vars:8,consts:[[1,"relative","flex","items-center","justify-center","w-10","h-10","rounded-full","bg-gradient-to-br","from-[#C8D900]","to-[#0098A8]","hover:scale-105","transition-transform","duration-200","shadow-lg","ring-2","ring-white/30",3,"click"],[1,"text-[#10284C]","font-bold","text-lg"],[1,"absolute","-bottom-1","-right-1","w-3","h-3","bg-[#C8D900]","rounded-full","border-2","border-[#10284C]"],[1,"fixed","inset-0","bg-black/50","backdrop-blur-sm","z-40"],[1,"fixed","top-0","right-0","h-full","w-80","bg-white","shadow-2xl","z-50","flex","flex-col"],[1,"relative","bg-gradient-to-br","from-[#10284C]","via-[#0098A8]","to-[#0098A8]","p-6","pb-20"],[1,"absolute","top-4","right-4","text-white/80","hover:text-white","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","flex-col","items-center","mt-4"],[1,"w-20","h-20","rounded-full","bg-gradient-to-br","from-[#C8D900]","to-[#C8D900]/80","flex","items-center","justify-center","shadow-xl","ring-4","ring-white/30"],[1,"text-[#10284C]","font-bold","text-3xl"],[1,"bg-gradient-to-br","from-white","to-[#0098A8]/3","-mt-12","mx-4","rounded-2xl","shadow-lg","p-6","relative","z-10"],[1,"text-center"],[1,"text-xl","font-bold","text-[#10284C]","mb-1"],[1,"text-sm","text-gray-600","mb-3"],[1,"inline-flex","items-center","gap-2","px-4","py-2","bg-gradient-to-r","from-[#0098A8]","to-[#0098A8]/80","rounded-full","shadow-md"],[1,"w-2","h-2","bg-[#C8D900]","rounded-full","animate-pulse"],[1,"text-sm","font-bold","text-white"],[1,"flex-1","overflow-y-auto","p-4"],[1,"space-y-2"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","hover:bg-gradient-to-r","hover:from-[#0098A8]/5","hover:to-[#C8D900]/5","transition-all","duration-200","group","border","border-transparent","hover:border-[#0098A8]/20",3,"click"],[1,"w-10","h-10","rounded-lg","bg-gradient-to-br","from-[#0098A8]","to-[#0098A8]/80","flex","items-center","justify-center","shadow-md","group-hover:shadow-lg","transition-shadow"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"flex-1","text-left"],[1,"text-sm","font-bold","text-gray-900","group-hover:text-[#0098A8]","transition-colors"],[1,"text-xs","text-gray-500"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-400","group-hover:text-[#0098A8]","group-hover:translate-x-1","transition-all"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","hover:bg-gradient-to-r","hover:from-[#C8D900]/5","hover:to-[#0098A8]/5","transition-all","duration-200","group","border","border-transparent","hover:border-[#C8D900]/20",3,"click"],[1,"w-10","h-10","rounded-lg","bg-gradient-to-br","from-[#C8D900]","to-[#C8D900]/80","flex","items-center","justify-center","shadow-md","group-hover:shadow-lg","transition-shadow"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-[#10284C]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],[1,"text-sm","font-bold","text-gray-900","group-hover:text-[#C8D900]","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-400","group-hover:text-[#C8D900]","group-hover:translate-x-1","transition-all"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","hover:bg-gradient-to-r","hover:from-[#10284C]/5","hover:to-[#0098A8]/5","transition-all","duration-200","group","border","border-transparent","hover:border-[#10284C]/20",3,"click"],[1,"w-10","h-10","rounded-lg","bg-gradient-to-br","from-[#10284C]","to-[#10284C]/80","flex","items-center","justify-center","shadow-md","group-hover:shadow-lg","transition-shadow"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"],[1,"text-sm","font-bold","text-gray-900","group-hover:text-[#10284C]","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-400","group-hover:text-[#10284C]","group-hover:translate-x-1","transition-all"],[1,"py-2"],[1,"border-t-2","border-[#C8D900]/20"],[1,"w-full","flex","items-center","gap-3","p-3","rounded-xl","hover:bg-gradient-to-r","hover:from-gray-50","hover:to-[#0098A8]/5","transition-all","duration-200","group","border","border-transparent","hover:border-gray-200",3,"click"],[1,"w-10","h-10","rounded-lg","bg-gradient-to-br","from-gray-100","to-gray-200","flex","items-center","justify-center","shadow-md","group-hover:shadow-lg","transition-shadow"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-600","group-hover:text-[#0098A8]","transition-colors"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"p-4","border-t-2","border-[#10284C]/20","bg-gradient-to-b","from-gray-50","to-white"],[1,"w-full","flex","items-center","justify-center","gap-3","p-4","rounded-xl","bg-gradient-to-r","from-red-500","to-red-600","hover:from-red-600","hover:to-red-700","text-white","transition-all","duration-200","shadow-lg","hover:shadow-2xl","transform","hover:scale-[1.02]","border-2","border-red-700/20",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"],[1,"font-semibold"],[1,"fixed","inset-0","bg-black/50","backdrop-blur-sm","z-40",3,"click"]],template:function(e,o){if(e&1&&(t(0,"button",0),p("click",function(){return o.toggleMenu()}),t(1,"span",1),l(2),n(),C(3,ge,1,0,"div",2),n(),C(4,he,1,1,"div",3),t(5,"div",4)(6,"div",5)(7,"button",6),p("click",function(){return o.closeMenu()}),d(),t(8,"svg",7),c(9,"path",8),n()(),f(),t(10,"div",9)(11,"div",10)(12,"span",11),l(13),n()()()(),t(14,"div",12)(15,"div",13)(16,"h3",14),l(17),n(),t(18,"p",15),l(19),n(),t(20,"div",16),c(21,"div",17),t(22,"span",18),l(23),n()()()(),t(24,"div",19)(25,"div",20)(26,"button",21),p("click",function(){return o.navigateTo("/internal/perfil")}),t(27,"div",22),d(),t(28,"svg",23),c(29,"path",24),n()(),f(),t(30,"div",25)(31,"p",26),l(32,"Mi Perfil"),n(),t(33,"p",27),l(34,"Editar informaci\xF3n"),n()(),d(),t(35,"svg",28),c(36,"path",29),n()(),f(),t(37,"button",30),p("click",function(){return o.navigateTo("/internal/configuracion")}),t(38,"div",31),d(),t(39,"svg",32),c(40,"path",33)(41,"path",34),n()(),f(),t(42,"div",25)(43,"p",35),l(44,"Configuraci\xF3n"),n(),t(45,"p",27),l(46,"Preferencias"),n()(),d(),t(47,"svg",36),c(48,"path",29),n()(),f(),t(49,"button",37),p("click",function(){return o.navigateTo("/internal/notificaciones")}),t(50,"div",38),d(),t(51,"svg",23),c(52,"path",39),n()(),f(),t(53,"div",25)(54,"p",40),l(55,"Notificaciones"),n(),t(56,"p",27),l(57,"Preferencias de alertas"),n()(),d(),t(58,"svg",41),c(59,"path",29),n()(),f(),t(60,"div",42),c(61,"div",43),n(),t(62,"button",44),p("click",function(){return o.navigateTo("/internal/ayuda")}),t(63,"div",45),d(),t(64,"svg",46),c(65,"path",47),n()(),f(),t(66,"div",25)(67,"p",26),l(68,"Ayuda y Soporte"),n(),t(69,"p",27),l(70,"Centro de ayuda"),n()(),d(),t(71,"svg",28),c(72,"path",29),n()()()(),f(),t(73,"div",48)(74,"button",49),p("click",function(){return o.logout()}),d(),t(75,"svg",50),c(76,"path",51),n(),f(),t(77,"span",52),l(78,"Cerrar Sesi\xF3n"),n()()()()),e&2){let s,h;a(2),u(" ",o.getInitial()," "),a(),w(o.isMenuOpen()?3:-1),a(),w(o.isMenuOpen()?4:-1),a(),y("@slideIn",o.isMenuOpen()?"open":"closed"),a(8),u(" ",o.getInitial()," "),a(4),u(" ",((s=o.userProfile())==null?null:s.full_name)||"Usuario"," "),a(2),u(" ",((h=o.userProfile())==null?null:h.email)||"Sin email"," "),a(4),u(" ",o.getRoleDisplay()," ")}},dependencies:[I],encapsulation:2,data:{animation:[j("slideIn",[R("closed",S({transform:"translateX(100%)",opacity:0})),R("open",S({transform:"translateX(0)",opacity:1})),P("closed => open",[M("300ms cubic-bezier(0.4, 0, 0.2, 1)")]),P("open => closed",[M("250ms cubic-bezier(0.4, 0, 0.2, 1)")])]),j("fadeIn",[P(":enter",[S({opacity:0}),M("200ms",S({opacity:1}))]),P(":leave",[M("150ms",S({opacity:0}))])])]}})};var ve=(r,i)=>i.route;function xe(r,i){if(r&1&&(t(0,"span",26),l(1),n()),r&2){let e=m(2);a(),u(" ",e.totalUnreadMessages()>99?"99+":e.totalUnreadMessages()," ")}}function _e(r,i){if(r&1&&(t(0,"a",19)(1,"div",21)(2,"div",22)(3,"div",23),d(),t(4,"svg",24),c(5,"path",25),n(),C(6,xe,2,1,"span",26),n(),f(),t(7,"div")(8,"h2",27),l(9),n(),t(10,"p",28),l(11),n()()(),d(),t(12,"svg",29),c(13,"path",30),n()()()),r&2){let e=i.$implicit,o=m();y("routerLink",e.route),a(5),Z("d",o.getIconPath(e.icon)),a(),w(e.route==="/internal/chat"&&o.totalUnreadMessages()>0?6:-1),a(3),N(e.title),a(2),N(e.description)}}function be(r,i){r&1&&(t(0,"div",20)(1,"div",31),d(),t(2,"svg",32),c(3,"path",33),n()(),f(),t(4,"h3",34),l(5,"Sin m\xF3dulos disponibles"),n(),t(6,"p",35),l(7,"No tienes permisos asignados. Contacta al administrador."),n()())}var X=class r{_authService=v(G);_router=v(z);_chatService=v(ee);_supabaseService=v(B);notificationService=v(H);totalUnreadMessages=b(0);userRole=b("");menuItems=b([]);cirugiasHoy=b(0);stockCritico=b(0);kitsEnProceso=b(0);cotizacionesPendientes=b(0);allMenuItems=[{route:"/internal/chat",title:"Mensajes",description:"Chat por cirug\xEDa",icon:"chat",roles:["admin","comercial","logistica","soporte_tecnico"]},{route:"/internal/agenda",title:"Agenda",description:"Gesti\xF3n de cirug\xEDas",icon:"calendar",roles:["admin","comercial","logistica"]},{route:"/internal/agenda/mi-agenda",title:"Mi Agenda",description:"Mis cirug\xEDas asignadas",icon:"calendar",roles:["soporte_tecnico"]},{route:"/internal/clientes",title:"Clientes",description:"Gesti\xF3n de clientes",icon:"users",roles:["admin","comercial","logistica"]},{route:"/internal/comercial",title:"Dashboard Comercial",description:"M\xE9tricas y an\xE1lisis",icon:"chart",roles:["admin","comercial"]},{route:"/internal/cotizaciones",title:"Cotizaciones",description:"Propuestas comerciales",icon:"currency",roles:["admin","comercial"]},{route:"/internal/logistica",title:"Log\xEDstica",description:"Gesti\xF3n de kits",icon:"clipboard",roles:["admin","logistica"]},{route:"/internal/inventario",title:"Inventario",description:"Control de stock",icon:"cube",roles:["admin","logistica","soporte_tecnico"]},{route:"/internal/tecnico",title:"Validaci\xF3n T\xE9cnica",description:"Recepci\xF3n de kits",icon:"check-circle",roles:["admin","soporte_tecnico"]},{route:"/internal/limpieza",title:"Lavado y Esterilizaci\xF3n",description:"Gesti\xF3n de limpieza de material",icon:"check",roles:["admin","logistica"]},{route:"/internal/hojas-gasto",title:"Hojas de Gasto",description:"Registro de gastos",icon:"document",roles:["admin","comercial","logistica","soporte_tecnico"]},{route:"/internal/trazabilidad",title:"Trazabilidad",description:"Seguimiento completo",icon:"clock",roles:["admin","comercial","logistica","soporte_tecnico"]}];ngOnInit(){return g(this,null,function*(){yield this.loadUserRole(),yield this.loadUnreadMessagesCount(),yield this.initializeNotifications(),yield this.loadKPIs(),setInterval(()=>{this.loadUnreadMessagesCount(),this.loadKPIs()},3e4)})}loadUserRole(){return g(this,null,function*(){try{let i=yield this._supabaseService.getSession();if(i?.user?.id){let e=yield this._supabaseService.getUserProfile(i.user.id);e&&(this.userRole.set(e.role),this.filterMenuByRole(e.role))}}catch(i){console.error("Error loading user role:",i)}})}filterMenuByRole(i){let e=this.allMenuItems.filter(o=>o.roles.includes(i)?W(i,o.route):!1);this.menuItems.set(e),console.log(`\u{1F4CB} Men\xFA filtrado para rol ${i}:`,e.length,"items")}initializeNotifications(){return g(this,null,function*(){try{let{data:i}=yield this._authService.session();i?.session?.user&&(yield this.notificationService.initialize(i.session.user.id))}catch(i){console.error("Error initializing notifications:",i)}})}loadUnreadMessagesCount(){return g(this,null,function*(){try{yield this._chatService.actualizarUnreadCounts(),this._chatService.unreadCounts$.subscribe(i=>{let e=Array.from(i.values()).reduce((o,s)=>o+s,0);this.totalUnreadMessages.set(e)})}catch(i){console.error("Error loading unread messages:",i)}})}loadKPIs(){return g(this,null,function*(){try{let i=new Date;i.setHours(0,0,0,0);let e=new Date(i);e.setDate(e.getDate()+1);let{count:o}=yield this._supabaseService.client.from("cirugias").select("*",{count:"exact",head:!0}).gte("fecha_programada",i.toISOString()).lt("fecha_programada",e.toISOString()).in("estado",["programada","confirmada","en_curso"]);this.cirugiasHoy.set(o||0);let{data:s}=yield this._supabaseService.client.from("inventario").select("producto_id, cantidad, productos!inner(stock_minimo)").eq("estado","disponible"),h=s?.filter(Y=>{let te=Y.productos?.stock_minimo||5;return Y.cantidad<=te}).length||0;this.stockCritico.set(h);let{count:T}=yield this._supabaseService.client.from("kits_cirugia").select("*",{count:"exact",head:!0}).in("estado",["preparando","listo_envio","en_transito"]);this.kitsEnProceso.set(T||0);let{count:L}=yield this._supabaseService.client.from("cotizaciones").select("*",{count:"exact",head:!0}).in("estado",["borrador","enviada"]);this.cotizacionesPendientes.set(L||0)}catch(i){console.error("Error loading KPIs:",i)}})}getIconPath(i){let e={chat:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z",calendar:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z",users:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z",currency:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z",chart:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z",clipboard:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4",cube:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4","check-circle":"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",check:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",document:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",clock:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"};return e[i]||e.check}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=E({type:r,selectors:[["app-internal-home"]],decls:45,vars:5,consts:[[1,"min-h-screen","relative","bg-white"],[1,"relative","overflow-hidden","bg-gradient-to-b","from-[#10284C]","via-[#0098A8]","to-[#0098A8]"],["src","05.jpg","alt","Medical background",1,"absolute","inset-0","w-full","h-full","object-cover","object-top","opacity-40","z-0"],[1,"relative","z-10"],[1,"px-4","py-6"],[1,"max-w-lg","mx-auto"],[1,"flex","justify-between","items-center","mb-8"],["src","https://www.implameq.com/wp-content/uploads/logotipo-impla-300x78.png.webp","alt","Implameq",1,"h-10","brightness-0","invert"],[1,"flex","items-center","gap-3"],[1,"text-center","mb-8"],[1,"text-3xl","font-bold","text-[#C8D900]","mb-2"],[1,"text-white/90","text-sm"],[1,"grid","grid-cols-2","gap-5","pb-16"],[1,"bg-[#0098A8]/20","backdrop-blur-sm","rounded-2xl","border-2","border-[#C8D900]","p-5"],[1,"text-4xl","font-bold","text-white","mb-1"],["viewBox","0 0 1440 160","preserveAspectRatio","none","aria-hidden","true",1,"pointer-events-none","absolute","bottom-0","left-0","w-full","h-20","sm:h-24","md:h-28","lg:h-32","z-0"],["d","M0,96 C240,136 480,144 720,112 C960,80 1200,64 1440,104 L1440,160 L0,160 Z","fill","#ffffff"],[1,"bg-white","px-4","pt-6","pb-8"],[1,"max-w-lg","mx-auto","space-y-5"],[1,"block","bg-[#10284C]","rounded-2xl","p-5","hover:bg-[#10284C]/90","transition-all","duration-200","relative",3,"routerLink"],[1,"text-center","py-12"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-4"],[1,"w-14","h-14","bg-[#C8D900]","rounded-xl","flex","items-center","justify-center","flex-shrink-0","relative"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-[#10284C]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"absolute","-top-1","-right-1","min-w-[20px]","h-5","px-1","bg-red-500","text-white","text-xs","font-bold","rounded-full","flex","items-center","justify-center","animate-pulse"],[1,"text-lg","font-bold","text-white"],[1,"text-sm","text-white/70"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-[#0098A8]","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"inline-flex","items-center","justify-center","w-16","h-16","bg-[#C8D900]","rounded-full","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-[#10284C]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"],[1,"text-lg","font-semibold","text-[#10284C]","mb-2"],[1,"text-gray-600"]],template:function(e,o){e&1&&(t(0,"div",0),c(1,"app-notification-toast"),t(2,"div",1),c(3,"img",2),t(4,"div",3)(5,"header",4)(6,"div",5)(7,"div",6),c(8,"img",7),t(9,"div",8),c(10,"app-notification-panel")(11,"app-profile-menu"),n()(),t(12,"div",9)(13,"h1",10),l(14,"Dashboard Operativo"),n(),t(15,"p",11),l(16,"Panel de control para gesti\xF3n interna"),n()(),t(17,"div",12)(18,"div",13)(19,"div",14),l(20),n(),t(21,"div",11),l(22,"Cirug\xEDas Hoy"),n()(),t(23,"div",13)(24,"div",14),l(25),n(),t(26,"div",11),l(27,"Stock Cr\xEDtico"),n()(),t(28,"div",13)(29,"div",14),l(30),n(),t(31,"div",11),l(32,"Kits en Proceso"),n()(),t(33,"div",13)(34,"div",14),l(35),n(),t(36,"div",11),l(37,"Cotizaciones Pendientes"),n()()()()()(),d(),t(38,"svg",15),c(39,"path",16),n()(),f(),t(40,"div",17)(41,"div",18),A(42,_e,14,5,"a",19,ve),C(44,be,8,0,"div",20),n()()()),e&2&&(a(20),N(o.cirugiasHoy()),a(5),N(o.stockCritico()),a(5),N(o.kitsEnProceso()),a(5),N(o.cotizacionesPendientes()),a(7),D(o.menuItems()),a(2),w(o.menuItems().length===0?44:-1))},dependencies:[I,Q,J,U,F,$],encapsulation:2})};export{X as default};
