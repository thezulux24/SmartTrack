import{a as ne}from"./chunk-IJHCNZQ7.js";import{a as U,b as _,c as Y,d as K,g as Q,h as W,i as X,j as Z,k as ee,l as re,m as ie,o as te,q as oe,s as ae}from"./chunk-QJKTNK7X.js";import{$ as v,A as F,B as l,Ba as R,Ca as J,E as z,Fa as O,I as b,L as E,N as T,O as h,Q as H,R as j,S as i,T as t,U as g,V as D,W as k,X as p,Z as n,_ as f,b as d,c,d as u,fa as $,g as m,n as I,q as V,r as S,t as w,u as y,v as x,w as C,xa as B,za as P}from"./chunk-QDKNTWK2.js";import"./chunk-LJ5XHLMQ.js";import"./chunk-FK42CRUA.js";var q=class o{constructor(r){this.supabase=r}getHospitales(){return d(this.supabase.client.from("hospitales").select("*").eq("es_activo",!0).order("nombre",{ascending:!0})).pipe(u(r=>{if(r.error)throw console.error("Error fetching hospitales:",r.error),new Error(r.error.message||"Error al cargar hospitales");return r.data||[]}),m(r=>(console.error("Service error loading hospitales:",r),c(()=>r))))}getHospitalById(r){return d(this.supabase.client.from("hospitales").select("*").eq("id",r).single()).pipe(u(e=>{if(e.error)throw new Error(e.error.message||"Error al cargar hospital");return e.data}),m(e=>(console.error("Service error loading hospital:",e),c(()=>e))))}createHospital(r){return d(this.supabase.client.from("hospitales").insert([r]).select().single()).pipe(u(e=>{if(e.error)throw console.error("Error creating hospital:",e.error),new Error(e.error.message||"Error al crear hospital");return e.data}),m(e=>(console.error("Service error creating hospital:",e),c(()=>e))))}updateHospital(r,e){return d(this.supabase.client.from("hospitales").update(e).eq("id",r).select().single()).pipe(u(a=>{if(a.error)throw console.error("Error updating hospital:",a.error),new Error(a.error.message||"Error al actualizar hospital");return a.data}),m(a=>(console.error("Service error updating hospital:",a),c(()=>a))))}deleteHospital(r){return d(this.supabase.client.from("hospitales").update({es_activo:!1}).eq("id",r)).pipe(u(e=>{if(e.error)throw console.error("Error deleting hospital:",e.error),new Error(e.error.message||"Error al eliminar hospital")}),m(e=>(console.error("Service error deleting hospital:",e),c(()=>e))))}getHospitalesByCiudad(r){return d(this.supabase.client.from("hospitales").select("*").eq("ciudad",r).eq("es_activo",!0).order("nombre",{ascending:!0})).pipe(u(e=>{if(e.error)throw console.error("Error fetching hospitales by ciudad:",e.error),new Error(e.error.message||"Error al cargar hospitales por ciudad");return e.data||[]}),m(e=>(console.error("Service error loading hospitales by ciudad:",e),c(()=>e))))}getCiudades(){return d(this.supabase.client.from("hospitales").select("ciudad").eq("es_activo",!0)).pipe(u(r=>{if(r.error)throw console.error("Error fetching ciudades:",r.error),new Error(r.error.message||"Error al cargar ciudades");return[...new Set(r.data?.map(a=>a.ciudad).filter(a=>a)||[])].sort()}),m(r=>(console.error("Service error loading ciudades:",r),c(()=>r))))}searchHospitales(r){return d(this.supabase.client.from("hospitales").select("*").eq("es_activo",!0).or(`nombre.ilike.%${r}%,ciudad.ilike.%${r}%,direccion.ilike.%${r}%`).order("nombre",{ascending:!0})).pipe(u(e=>{if(e.error)throw console.error("Error searching hospitales:",e.error),new Error(e.error.message||"Error al buscar hospitales");return e.data||[]}),m(e=>(console.error("Service error searching hospitales:",e),c(()=>e))))}getHospitalStats(){return d(this.supabase.client.from("hospitales").select("ciudad, es_activo")).pipe(u(r=>{if(r.error)throw new Error(r.error.message||"Error al cargar estad\xEDsticas");let e=r.data||[],a=e.filter(s=>s.es_activo);return{total:e.length,activos:a.length,inactivos:e.length-a.length,ciudades:[...new Set(a.map(s=>s.ciudad).filter(s=>s))].length}}),m(r=>(console.error("Service error loading hospital stats:",r),c(()=>r))))}static \u0275fac=function(e){return new(e||o)(V(O))};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})};var M=class o{constructor(r){this.supabase=r}getTiposCirugia(){return d(this.supabase.client.from("tipos_cirugia").select("*").eq("es_activo",!0).order("nombre",{ascending:!0})).pipe(u(r=>{if(r.error)throw console.error("Error fetching tipos cirugia:",r.error),new Error(r.error.message||"Error al cargar tipos de cirug\xEDa");return r.data||[]}),m(r=>(console.error("Service error loading tipos cirugia:",r),c(()=>r))))}getTipoCirugiaById(r){return d(this.supabase.client.from("tipos_cirugia").select("*").eq("id",r).single()).pipe(u(e=>{if(e.error)throw new Error(e.error.message||"Error al cargar tipo de cirug\xEDa");return e.data}),m(e=>(console.error("Service error loading tipo cirugia:",e),c(()=>e))))}createTipoCirugia(r){return d(this.supabase.client.from("tipos_cirugia").insert([r]).select().single()).pipe(u(e=>{if(e.error)throw console.error("Error creating tipo cirugia:",e.error),new Error(e.error.message||"Error al crear tipo de cirug\xEDa");return e.data}),m(e=>(console.error("Service error creating tipo cirugia:",e),c(()=>e))))}updateTipoCirugia(r,e){return d(this.supabase.client.from("tipos_cirugia").update(e).eq("id",r).select().single()).pipe(u(a=>{if(a.error)throw console.error("Error updating tipo cirugia:",a.error),new Error(a.error.message||"Error al actualizar tipo de cirug\xEDa");return a.data}),m(a=>(console.error("Service error updating tipo cirugia:",a),c(()=>a))))}deleteTipoCirugia(r){return d(this.supabase.client.from("tipos_cirugia").update({es_activo:!1}).eq("id",r)).pipe(u(e=>{if(e.error)throw console.error("Error deleting tipo cirugia:",e.error),new Error(e.error.message||"Error al eliminar tipo de cirug\xEDa")}),m(e=>(console.error("Service error deleting tipo cirugia:",e),c(()=>e))))}getTiposByEspecialidad(r){return d(this.supabase.client.from("tipos_cirugia").select("*").eq("especialidad",r).eq("es_activo",!0).order("nombre",{ascending:!0})).pipe(u(e=>{if(e.error)throw console.error("Error fetching tipos by especialidad:",e.error),new Error(e.error.message||"Error al cargar tipos por especialidad");return e.data||[]}),m(e=>(console.error("Service error loading tipos by especialidad:",e),c(()=>e))))}getEspecialidades(){return d(this.supabase.client.from("tipos_cirugia").select("especialidad").eq("es_activo",!0)).pipe(u(r=>{if(r.error)throw console.error("Error fetching especialidades:",r.error),new Error(r.error.message||"Error al cargar especialidades");return[...new Set(r.data?.map(a=>a.especialidad).filter(a=>a)||[])].sort()}),m(r=>(console.error("Service error loading especialidades:",r),c(()=>r))))}static \u0275fac=function(e){return new(e||o)(V(O))};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})};var N=class o{constructor(r){this.supabase=r}getTecnicos(){return d(this.supabase.client.from("profiles").select("id, full_name, email, area, phone").eq("role","soporte_tecnico").eq("is_active",!0).order("full_name",{ascending:!0})).pipe(u(r=>{if(r.error)throw console.error("Error fetching tecnicos:",r.error),new Error(r.error.message||"Error al cargar t\xE9cnicos");return r.data||[]}),m(r=>(console.error("Service error loading tecnicos:",r),c(()=>r))))}getTecnicoById(r){return d(this.supabase.client.from("profiles").select("id, full_name, email, area, phone").eq("id",r).eq("role","soporte_tecnico").single()).pipe(u(e=>{if(e.error)throw new Error(e.error.message||"Error al cargar t\xE9cnico");return e.data}),m(e=>(console.error("Service error loading tecnico:",e),c(()=>e))))}getTecnicosDisponibles(r){return d(this.supabase.client.from("profiles").select(`
          id, 
          full_name, 
          email, 
          area,
          agenda_tecnicos!inner(*)
        `).eq("role","soporte_tecnico").eq("is_active",!0).eq("agenda_tecnicos.fecha",r).eq("agenda_tecnicos.disponible",!0).order("full_name",{ascending:!0})).pipe(u(e=>{if(e.error)throw console.error("Error fetching tecnicos disponibles:",e.error),new Error(e.error.message||"Error al cargar t\xE9cnicos disponibles");return e.data||[]}),m(e=>(console.error("Service error loading tecnicos disponibles:",e),c(()=>e))))}static \u0275fac=function(e){return new(e||o)(V(O))};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})};var ce=()=>["/internal/agenda"],G=(o,r)=>r.id,se=(o,r)=>r.value;function ue(o,r){o&1&&(i(0,"div",14)(1,"div",15)(2,"div",16)(3,"div",17),g(4,"div",18)(5,"div",19)(6,"div",20),t(),i(7,"p",21),n(8,"Cargando datos..."),t()()()())}function me(o,r){if(o&1){let e=D();i(0,"div",2)(1,"div",15)(2,"div",64)(3,"div",4),x(),i(4,"svg",65),g(5,"path",66),t(),C(),i(6,"div",67)(7,"p",68),n(8),t()()(),i(9,"button",69),k("click",function(){w(e);let s=p(2);return y(s.loadInitialData())}),n(10," Reintentar "),t()()()()}if(o&2){let e=p(2);l(8),f(e.error())}}function ge(o,r){if(o&1&&(i(0,"div",2)(1,"div",15)(2,"div",70)(3,"div",4),x(),i(4,"svg",71),g(5,"path",72),t(),C(),i(6,"p",68),n(7),t()()()()()),o&2){let e=p(2);l(7),f(e.success())}}function pe(o,r){if(o&1&&(i(0,"p",31),n(1),t()),o&2){let e=p(2);l(),f(e.getFieldError("paciente_nombre"))}}function fe(o,r){if(o&1&&n(0),o&2){let e=p().$implicit;v(" - ",e.ciudad," ")}}function he(o,r){if(o&1&&(i(0,"option",40),n(1),b(2,fe,1,1),t()),o&2){let e=r.$implicit;E("value",e.id),l(),f(e.nombre),l(),h(e.ciudad?2:-1)}}function be(o,r){if(o&1&&(i(0,"p",31),n(1),t()),o&2){let e=p(2);l(),f(e.getFieldError("hospital_id"))}}function ve(o,r){if(o&1&&(i(0,"option",40),n(1),t()),o&2){let e=r.$implicit;E("value",e.id),l(),f(e.nombre)}}function _e(o,r){if(o&1&&(i(0,"p",31),n(1),t()),o&2){let e=p(2);l(),f(e.getFieldError("tipo_cirugia_id"))}}function xe(o,r){if(o&1&&(i(0,"p",31),n(1),t()),o&2){let e=p(2);l(),f(e.getFieldError("medico_cirujano"))}}function Ce(o,r){if(o&1&&(i(0,"p",31),n(1),t()),o&2){let e=p(2);l(),f(e.getFieldError("fecha_programada"))}}function Ee(o,r){if(o&1&&(i(0,"p",31),n(1),t()),o&2){let e=p(2);l(),f(e.getFieldError("duracion_estimada"))}}function Se(o,r){if(o&1&&(i(0,"option",40),n(1),t()),o&2){let e=r.$implicit;E("value",e.value),l(),f(e.label)}}function we(o,r){if(o&1&&(i(0,"option",40),n(1),t()),o&2){let e=r.$implicit;E("value",e.value),l(),f(e.label)}}function ye(o,r){if(o&1&&(i(0,"option",40),n(1),t()),o&2){let e=r.$implicit;E("value",e.id),l(),f(e.full_name)}}function ke(o,r){o&1&&g(0,"div",58)}function Fe(o,r){o&1&&(x(),i(0,"svg",59),g(1,"path",72),t())}function Te(o,r){if(o&1){let e=D();i(0,"div",62)(1,"div",73)(2,"p",74),n(3,"Debug Info:"),t(),i(4,"div",75)(5,"p"),n(6),i(7,"button",76),k("click",function(){w(e);let s=p(2);return y(s.debugHospitales())}),n(8,"Ver en consola"),t()(),i(9,"p"),n(10),i(11,"button",76),k("click",function(){w(e);let s=p(2);return y(s.debugTipos())}),n(12,"Ver en consola"),t()(),i(13,"p"),n(14),i(15,"button",76),k("click",function(){w(e);let s=p(2);return y(s.debugTecnicos())}),n(16,"Ver en consola"),t()()()()()}if(o&2){let e=p(2);l(6),v("Hospitales: ",e.hospitales().length," "),l(4),v("Tipos: ",e.tiposCirugia().length," "),l(4),v("T\xE9cnicos: ",e.tecnicos().length," ")}}function Ie(o,r){if(o&1){let e=D();b(0,me,11,1,"div",2)(1,ge,8,1,"div",2),i(2,"main",14)(3,"form",22),k("ngSubmit",function(){w(e);let s=p();return y(s.onSubmit())}),i(4,"div",23)(5,"h2",24)(6,"div",25),x(),i(7,"svg",26),g(8,"path",27),t()(),C(),i(9,"span"),n(10,"Informaci\xF3n del Paciente"),t()(),i(11,"div",28)(12,"div")(13,"label",29),n(14," Nombre Completo * "),t(),g(15,"input",30),b(16,pe,2,1,"p",31),t(),i(17,"div",32)(18,"div")(19,"label",29),n(20," Documento "),t(),g(21,"input",33),t(),i(22,"div")(23,"label",29),n(24," Tel\xE9fono "),t(),g(25,"input",34),t()()()(),i(26,"div",23)(27,"h2",24)(28,"div",35),x(),i(29,"svg",26),g(30,"path",36),t()(),C(),i(31,"span"),n(32,"Informaci\xF3n de la Cirug\xEDa"),t()(),i(33,"div",28)(34,"div")(35,"label",29),n(36," Hospital/Cl\xEDnica * "),i(37,"span",37),n(38),t()(),i(39,"select",38)(40,"option",39),n(41,"Seleccionar hospital..."),t(),H(42,he,3,3,"option",40,G),t(),b(44,be,2,1,"p",31),t(),i(45,"div")(46,"label",29),n(47," Tipo de Cirug\xEDa * "),i(48,"span",37),n(49),t()(),i(50,"select",41),k("change",function(s){w(e);let L=p();return y(L.onTipoCirugiaChange(s))}),i(51,"option",39),n(52,"Seleccionar tipo..."),t(),H(53,ve,2,2,"option",40,G),t(),b(55,_e,2,1,"p",31),t(),i(56,"div")(57,"label",29),n(58," M\xE9dico Cirujano * "),t(),g(59,"input",42),b(60,xe,2,1,"p",31),t()()(),i(61,"div",23)(62,"h2",24)(63,"div",43),x(),i(64,"svg",26),g(65,"path",44),t()(),C(),i(66,"span"),n(67,"Programaci\xF3n"),t()(),i(68,"div",28)(69,"div")(70,"label",29),n(71," Fecha Programada * "),t(),g(72,"input",45),b(73,Ce,2,1,"p",31),t(),i(74,"div",32)(75,"div")(76,"label",29),n(77," Hora de Inicio "),t(),g(78,"input",46),t(),i(79,"div")(80,"label",29),n(81," Duraci\xF3n (min) "),t(),g(82,"input",47),b(83,Ee,2,1,"p",31),t()()()(),i(84,"div",23)(85,"h2",24)(86,"div",48),x(),i(87,"svg",26),g(88,"path",49),t()(),C(),i(89,"span"),n(90,"Estado y Asignaci\xF3n"),t()(),i(91,"div",28)(92,"div",32)(93,"div")(94,"label",29),n(95," Estado * "),t(),i(96,"select",50),H(97,Se,2,2,"option",40,se),t()(),i(99,"div")(100,"label",29),n(101," Prioridad * "),t(),i(102,"select",51),H(103,we,2,2,"option",40,se),t()()(),i(105,"div")(106,"label",29),n(107," T\xE9cnico Asignado "),i(108,"span",37),n(109),t()(),i(110,"select",52)(111,"option",39),n(112,"Sin asignar"),t(),H(113,ye,2,2,"option",40,G),t()()()(),i(115,"div",23)(116,"h2",24)(117,"div",53),x(),i(118,"svg",26),g(119,"path",54),t()(),C(),i(120,"span"),n(121,"Observaciones"),t()(),i(122,"div")(123,"label",29),n(124," Notas Adicionales "),t(),g(125,"textarea",55),t()(),i(126,"div",56)(127,"button",57),b(128,ke,1,0,"div",58)(129,Fe,2,0,":svg:svg",59),i(130,"span",60),n(131),t()(),i(132,"button",61),k("click",function(){w(e);let s=p();return y(s.onCancel())}),n(133," Cancelar "),t()()(),b(134,Te,17,3,"div",62),g(135,"div",63),t()}if(o&2){let e=p();h(e.error()?0:-1),l(),h(e.success()?1:-1),l(2),E("formGroup",e.cirugiaForm),l(12),T("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(e.isFieldInvalid("paciente_nombre")?"border-red-300":"border-gray-300")),l(),h(e.isFieldInvalid("paciente_nombre")?16:-1),l(22),v("(",e.hospitales().length," disponibles)"),l(),T("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(e.isFieldInvalid("hospital_id")?"border-red-300":"border-gray-300")),l(3),j(e.hospitales()),l(2),h(e.isFieldInvalid("hospital_id")?44:-1),l(5),v("(",e.tiposCirugia().length," disponibles)"),l(),T("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(e.isFieldInvalid("tipo_cirugia_id")?"border-red-300":"border-gray-300")),l(3),j(e.tiposCirugia()),l(2),h(e.isFieldInvalid("tipo_cirugia_id")?55:-1),l(4),T("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(e.isFieldInvalid("medico_cirujano")?"border-red-300":"border-gray-300")),l(),h(e.isFieldInvalid("medico_cirujano")?60:-1),l(12),T("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(e.isFieldInvalid("fecha_programada")?"border-red-300":"border-gray-300")),l(),h(e.isFieldInvalid("fecha_programada")?73:-1),l(9),T("w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white "+(e.isFieldInvalid("duracion_estimada")?"border-red-300":"border-gray-300")),l(),h(e.isFieldInvalid("duracion_estimada")?83:-1),l(14),j(e.estadosOptions),l(6),j(e.prioridadOptions),l(6),v("(",e.tecnicos().length," disponibles)"),l(4),j(e.tecnicos()),l(14),E("disabled",e.loading()||e.cirugiaForm.invalid),l(),h(e.loading()?128:129),l(3),v("",e.isEditing?"Actualizar":"Crear"," Cirug\xEDa"),l(3),h(!e.loading()&&!e.error()?134:-1)}}var de=class o{fb=S(oe);router=S(R);route=S(P);cirugiasService=S(ne);hospitalesService=S(q);tiposCirugiaService=S(M);tecnicosService=S(N);loading=F(!1);error=F(null);success=F(null);hospitales=F([]);tiposCirugia=F([]);tecnicos=F([]);cirugiaForm;isEditing=!1;cirugiaId=null;estadosOptions=[{value:"programada",label:"Programada"},{value:"en_curso",label:"En Curso"},{value:"completada",label:"Completada"},{value:"cancelada",label:"Cancelada"},{value:"urgencia",label:"Urgencia"}];prioridadOptions=[{value:"baja",label:"Baja"},{value:"normal",label:"Normal"},{value:"alta",label:"Alta"},{value:"urgencia",label:"Urgencia"}];constructor(){this.cirugiaForm=this.fb.group({paciente_nombre:["",[_.required,_.minLength(2)]],paciente_documento:[""],paciente_telefono:[""],hospital_id:["",_.required],tipo_cirugia_id:["",_.required],medico_cirujano:["",[_.required,_.minLength(2)]],fecha_programada:["",_.required],hora_inicio:[""],duracion_estimada:[null,[_.min(15)]],estado:["programada",_.required],prioridad:["normal",_.required],tecnico_asignado_id:[""],notas:[""]})}ngOnInit(){console.log("\u{1F680} CirugiaFormComponent iniciando..."),this.loadInitialData(),this.checkEditMode()}loadInitialData(){console.log("\u{1F4CA} Cargando datos iniciales..."),this.loading.set(!0),this.error.set(null),console.log("\u{1F3E5} Iniciando carga de hospitales..."),this.hospitalesService.getHospitales().subscribe({next:r=>{console.log("\u2705 Hospitales cargados:",r),this.hospitales.set(r),console.log("\u2695\uFE0F Iniciando carga de tipos de cirug\xEDa..."),this.tiposCirugiaService.getTiposCirugia().subscribe({next:e=>{console.log("\u2705 Tipos de cirug\xEDa cargados:",e),this.tiposCirugia.set(e),console.log("\u{1F468}\u200D\u2695\uFE0F Iniciando carga de t\xE9cnicos..."),this.tecnicosService.getTecnicos().subscribe({next:a=>{console.log("\u2705 T\xE9cnicos cargados:",a),this.tecnicos.set(a),this.loading.set(!1)},error:a=>{console.error("\u274C Error loading tecnicos:",a),console.error("\u274C Error details:",{message:a?.message,code:a?.code,details:a?.details,hint:a?.hint}),this.error.set("Error al cargar t\xE9cnicos: "+(a?.message||JSON.stringify(a))),this.loading.set(!1)}})},error:e=>{console.error("\u274C Error loading tipos cirugia:",e),console.error("\u274C Error details:",{message:e?.message,code:e?.code,details:e?.details,hint:e?.hint}),this.error.set("Error al cargar tipos de cirug\xEDa: "+(e?.message||JSON.stringify(e))),this.loading.set(!1)}})},error:r=>{console.error("\u274C Error loading hospitales:",r),console.error("\u274C Error details:",{message:r?.message,code:r?.code,details:r?.details,hint:r?.hint}),this.error.set("Error al cargar hospitales: "+(r?.message||JSON.stringify(r))),this.loading.set(!1)}})}checkEditMode(){this.cirugiaId=this.route.snapshot.paramMap.get("id"),this.cirugiaId&&(this.isEditing=!0,this.loadCirugia())}loadCirugia(){this.cirugiaId&&(console.log("\u{1F4CB} Cargando cirug\xEDa para edici\xF3n:",this.cirugiaId),this.loading.set(!0),this.cirugiasService.getCirugiaById(this.cirugiaId).subscribe({next:r=>{console.log("\u2705 Cirug\xEDa cargada:",r),this.populateForm(r),this.loading.set(!1)},error:r=>{console.error("\u274C Error loading cirugia:",r),this.error.set("Error al cargar la cirug\xEDa: "+(r?.message||r)),this.loading.set(!1)}}))}populateForm(r){let e=new Date(r.fecha_programada).toISOString().split("T")[0];this.cirugiaForm.patchValue({paciente_nombre:r.paciente_nombre,paciente_documento:r.paciente_documento,paciente_telefono:r.paciente_telefono,hospital_id:r.hospital_id,tipo_cirugia_id:r.tipo_cirugia_id,medico_cirujano:r.medico_cirujano,fecha_programada:e,hora_inicio:r.hora_inicio,duracion_estimada:r.duracion_estimada,estado:r.estado,prioridad:r.prioridad,tecnico_asignado_id:r.tecnico_asignado_id,notas:r.notas})}onTipoCirugiaChange(r){let a=r.target.value;console.log("\u{1F504} Tipo de cirug\xEDa seleccionado:",a);let s=this.tiposCirugia().find(L=>L.id===a);console.log("\u{1F4CB} Tipo encontrado:",s),s?.duracion_promedio&&(console.log("\u23F1\uFE0F Actualizando duraci\xF3n estimada:",s.duracion_promedio),this.cirugiaForm.patchValue({duracion_estimada:s.duracion_promedio}))}onSubmit(){if(console.log("\u{1F4DD} Enviando formulario..."),console.log("\u{1F50D} Form v\xE1lido:",this.cirugiaForm.valid),console.log("\u{1F4CA} Form values:",this.cirugiaForm.value),console.log("\u274C Form errors:",this.cirugiaForm.errors),this.cirugiaForm.invalid){console.log("\u26A0\uFE0F Formulario inv\xE1lido, marcando campos..."),this.markFormGroupTouched(),Object.keys(this.cirugiaForm.controls).forEach(e=>{let a=this.cirugiaForm.get(e);a?.errors&&console.log(`\u274C Campo ${e} tiene errores:`,a.errors)});return}this.loading.set(!0),this.error.set(null);let r=this.cirugiaForm.value;this.isEditing||(r.numero_cirugia=this.generateNumeroCirugia()),r.fecha_programada=new Date(r.fecha_programada).toISOString(),console.log("\u{1F4BE} Datos a enviar:",r),this.isEditing&&this.cirugiaId?this.updateCirugia(r):this.createCirugia(r)}createCirugia(r){console.log("\u2795 Creando nueva cirug\xEDa..."),this.cirugiasService.createCirugia(r).subscribe({next:e=>{console.log("\u2705 Cirug\xEDa creada exitosamente:",e),this.success.set("Cirug\xEDa creada exitosamente"),setTimeout(()=>{this.router.navigate(["/internal/agenda"])},1500)},error:e=>{console.error("\u274C Error creating cirugia:",e),this.error.set("Error al crear la cirug\xEDa: "+(e?.message||e)),this.loading.set(!1)}})}updateCirugia(r){this.cirugiaId&&(console.log("\u{1F4DD} Actualizando cirug\xEDa..."),this.cirugiasService.updateCirugia(this.cirugiaId,r).subscribe({next:e=>{console.log("\u2705 Cirug\xEDa actualizada exitosamente:",e),this.success.set("Cirug\xEDa actualizada exitosamente"),setTimeout(()=>{this.router.navigate(["/internal/agenda"])},1500)},error:e=>{console.error("\u274C Error updating cirugia:",e),this.error.set("Error al actualizar la cirug\xEDa: "+(e?.message||e)),this.loading.set(!1)}}))}generateNumeroCirugia(){let r=new Date().getFullYear(),e=Date.now().toString().slice(-6);return`CIR-${r}-${e}`}markFormGroupTouched(){Object.keys(this.cirugiaForm.controls).forEach(r=>{this.cirugiaForm.get(r)?.markAsTouched()})}isFieldInvalid(r){let e=this.cirugiaForm.get(r);return!!(e&&e.invalid&&(e.dirty||e.touched))}getFieldError(r){let e=this.cirugiaForm.get(r);if(e?.errors){if(e.errors.required)return"Este campo es requerido";if(e.errors.minlength)return`Debe tener al menos ${e.errors.minlength.requiredLength} caracteres`;if(e.errors.min)return`Debe ser mayor a ${e.errors.min.min}`}return""}onCancel(){this.router.navigate(["/internal/agenda"])}debugHospitales(){console.log("\u{1F3E5} Debug Hospitales:",this.hospitales())}debugTipos(){console.log("\u2695\uFE0F Debug Tipos:",this.tiposCirugia())}debugTecnicos(){console.log("\u{1F468}\u200D\u2695\uFE0F Debug T\xE9cnicos:",this.tecnicos())}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=z({type:o,selectors:[["app-cirugia-form"]],decls:20,vars:6,consts:[[1,"bg-gray-50","dark:bg-gray-900","min-h-screen"],[1,"bg-gradient-to-r","from-green-600","to-emerald-700","text-white","shadow-lg"],[1,"px-4","py-4"],[1,"flex","justify-between","items-center","mb-3"],[1,"flex","items-center","space-x-3"],["src","https://www.implameq.com/wp-content/uploads/logotipo-impla-300x78.png.webp","alt","Implameq",1,"h-8","brightness-0","invert"],[1,"text-lg","font-semibold"],[1,"flex","items-center","space-x-2"],[1,"bg-white/20","hover:bg-white/30","text-white","px-3","py-2","rounded-lg","text-sm","font-medium","transition","duration-200","shadow-md","backdrop-blur-sm",3,"routerLink"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-center"],[1,"text-2xl","font-bold","mb-1"],[1,"text-green-100","text-sm"],[1,"px-4","py-6"],[1,"max-w-lg","mx-auto"],[1,"bg-white","rounded-xl","shadow-md","dark:bg-gray-800","p-6","text-center"],[1,"animate-pulse","space-y-4"],[1,"h-4","bg-gray-200","rounded","w-3/4","mx-auto"],[1,"h-4","bg-gray-200","rounded","w-1/2","mx-auto"],[1,"h-4","bg-gray-200","rounded","w-2/3","mx-auto"],[1,"text-sm","text-gray-500","mt-4"],[1,"max-w-lg","mx-auto","space-y-6",3,"ngSubmit","formGroup"],[1,"bg-white","rounded-xl","shadow-md","dark:bg-gray-800","dark:border","dark:border-gray-700","p-6"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white","mb-4","flex","items-center","space-x-2"],[1,"w-8","h-8","bg-gradient-to-br","from-blue-400","to-blue-600","rounded-lg","flex","items-center","justify-center","flex-shrink-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2"],["type","text","formControlName","paciente_nombre","placeholder","Ej: Juan P\xE9rez Garc\xEDa"],[1,"mt-1","text-sm","text-red-600"],[1,"grid","grid-cols-2","gap-4"],["type","text","formControlName","paciente_documento","placeholder","12345678",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-green-500","focus:border-transparent","dark:bg-gray-700","dark:border-gray-600","dark:text-white"],["type","tel","formControlName","paciente_telefono","placeholder","3001234567",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-green-500","focus:border-transparent","dark:bg-gray-700","dark:border-gray-600","dark:text-white"],[1,"w-8","h-8","bg-gradient-to-br","from-green-400","to-green-600","rounded-lg","flex","items-center","justify-center","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-xs","text-gray-500"],["formControlName","hospital_id"],["value",""],[3,"value"],["formControlName","tipo_cirugia_id",3,"change"],["type","text","formControlName","medico_cirujano","placeholder","Ej: Dr. Roberto Silva"],[1,"w-8","h-8","bg-gradient-to-br","from-purple-400","to-purple-600","rounded-lg","flex","items-center","justify-center","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],["type","date","formControlName","fecha_programada"],["type","time","formControlName","hora_inicio",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-green-500","focus:border-transparent","dark:bg-gray-700","dark:border-gray-600","dark:text-white"],["type","number","formControlName","duracion_estimada","placeholder","120","min","15"],[1,"w-8","h-8","bg-gradient-to-br","from-orange-400","to-orange-600","rounded-lg","flex","items-center","justify-center","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],["formControlName","estado",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-green-500","focus:border-transparent","dark:bg-gray-700","dark:border-gray-600","dark:text-white"],["formControlName","prioridad",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-green-500","focus:border-transparent","dark:bg-gray-700","dark:border-gray-600","dark:text-white"],["formControlName","tecnico_asignado_id",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-green-500","focus:border-transparent","dark:bg-gray-700","dark:border-gray-600","dark:text-white"],[1,"w-8","h-8","bg-gradient-to-br","from-gray-400","to-gray-600","rounded-lg","flex","items-center","justify-center","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["formControlName","notas","rows","4","placeholder","Informaci\xF3n adicional sobre la cirug\xEDa...",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-green-500","focus:border-transparent","dark:bg-gray-700","dark:border-gray-600","dark:text-white"],[1,"space-y-3","pt-4"],["type","submit",1,"w-full","bg-gradient-to-r","from-lime-400","to-green-500","hover:from-lime-500","hover:to-green-600","disabled:from-gray-400","disabled:to-gray-500","disabled:cursor-not-allowed","text-white","px-6","py-4","rounded-xl","font-medium","shadow-lg","transition-all","duration-200","flex","items-center","justify-center","space-x-3",3,"disabled"],[1,"animate-spin","rounded-full","h-5","w-5","border-b-2","border-white"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],[1,"text-lg"],["type","button",1,"w-full","bg-white","hover:bg-gray-50","text-gray-700","border","border-gray-300","px-6","py-3","rounded-xl","font-medium","transition-all","duration-200","dark:bg-gray-800","dark:text-gray-300","dark:border-gray-600","dark:hover:bg-gray-700",3,"click"],[1,"max-w-lg","mx-auto","mt-6"],[1,"h-6"],[1,"bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-xl","shadow-md"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-red-500","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"flex-1"],[1,"text-sm"],[1,"mt-3","w-full","bg-red-600","hover:bg-red-700","text-white","px-4","py-2","rounded-lg","text-sm","font-medium","transition","duration-200",3,"click"],[1,"bg-green-50","border","border-green-200","text-green-700","px-4","py-3","rounded-xl","shadow-md"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-green-500","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"bg-gray-100","dark:bg-gray-800","border","border-gray-200","dark:border-gray-700","p-4","rounded-xl","text-sm"],[1,"font-medium","text-gray-900","dark:text-white","mb-2"],[1,"space-y-1","text-gray-600","dark:text-gray-400"],[1,"text-blue-600","underline","ml-2",3,"click"]],template:function(e,a){e&1&&(i(0,"section",0)(1,"header",1)(2,"div",2)(3,"div",3)(4,"div",4),g(5,"img",5),i(6,"span",6),n(7),t()(),i(8,"div",7)(9,"button",8),x(),i(10,"svg",9),g(11,"path",10),t(),n(12," Volver "),t()()(),C(),i(13,"div",11)(14,"h1",12),n(15),t(),i(16,"p",13),n(17),t()()()(),b(18,ue,9,0,"div",14)(19,Ie,136,28),t()),e&2&&(l(7),v(" ",a.isEditing?"Editar Cirug\xEDa":"Nueva Cirug\xEDa"," "),l(2),E("routerLink",$(5,ce)),l(6),v(" ",a.isEditing?"Editar Cirug\xEDa":"Programar Nueva Cirug\xEDa"," "),l(2),v(" ",a.isEditing?"Actualiza la informaci\xF3n de la cirug\xEDa":"Completa los datos para programar la cirug\xEDa"," "),l(),h(a.loading()?18:19))},dependencies:[B,ae,Q,re,ie,U,W,ee,Y,K,te,X,Z,J],encapsulation:2})};export{de as CirugiaFormComponent};
