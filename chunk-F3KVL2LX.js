import{a as ke}from"./chunk-XSDINV7M.js";import{a as ae,b as M,c as le,d as se,g as de,h as ce,i as me,k as pe,l as ue,m as ge,n as xe,o as _e,p as fe,q as he,s as be,w as ve,x as Ce,y as we}from"./chunk-V2VKRV3B.js";import{c as X,d as ee,e as G,f as te,i as ie,j as q,n as oe,p as ne,v as re}from"./chunk-3OSVPALZ.js";import{$ as C,Ab as w,Bb as b,Cb as Q,Eb as I,Fb as V,Gb as K,Ia as s,Ib as B,Nb as j,Ob as W,Pb as Y,S as P,Sa as O,Xa as _,Y as p,Yb as J,Z as u,_ as g,cb as x,db as U,ga as $,hb as Z,ib as v,la as k,lb as L,m as F,mb as N,nb as i,ob as o,pb as c,qb as E,tb as h,ub as m,zb as l}from"./chunk-MBDN4FSM.js";import"./chunk-X5YLR3NI.js";import{a as T,b as A,c as R,i as S}from"./chunk-ODN5LVDJ.js";function De(a,t){if(a&1&&(i(0,"p",17),l(1),o()),a&2){let e=m(2);s(),b(" ",e.kitName," ")}}function Ie(a,t){if(a&1){let e=E();i(0,"div",1),h("click",function(){p(e);let r=m();return u(r.onBackdropClick())}),c(1,"div",2),i(2,"div",3),h("click",function(r){return p(e),u(r.stopPropagation())}),i(3,"div",4),c(4,"div",5),i(5,"div",6)(6,"div",7)(7,"div",8),c(8,"img",9),o()(),i(9,"div",10)(10,"div",11)(11,"div",12)(12,"div",13),g(),i(13,"svg",14),c(14,"path",15),o()()(),C(),i(15,"h2",16),l(16),o(),_(17,De,2,1,"p",17),i(18,"div",18)(19,"button",19),h("click",function(){p(e);let r=m();return u(r.onVolver())}),l(20," Volver a la agenda "),o()()()()()()()()}if(a&2){let e=m();s(4),U("background-image","url(/02.jpg)"),s(12),b(" ",e.title," "),s(),v(e.kitName?17:-1)}}var z=class a{isOpen=!1;title=`Kit creado
exitosamente`;kitName="";close=new $;onBackdropClick(){this.close.emit()}onVolver(){this.close.emit()}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=O({type:a,selectors:[["app-kit-success-dialog"]],inputs:{isOpen:"isOpen",title:"title",kitName:"kitName"},outputs:{close:"close"},decls:1,vars:1,consts:[["class","fixed inset-0 z-50 flex items-center justify-center p-4",3,"click",4,"ngIf"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm"],[1,"relative","z-10","w-full","max-w-md",3,"click"],[1,"relative","min-h-[500px]","bg-gradient-to-b","from-[#10284C]","via-[#1a4d5c]","to-[#0098A8]","rounded-lg","overflow-hidden"],[1,"absolute","inset-0","bg-cover","bg-center","opacity-10"],[1,"relative","z-10","flex","flex-col","h-full","min-h-[500px]"],[1,"flex","items-center","p-6"],[1,"flex","items-center","gap-2"],["src","/logo.webp","alt","Implameq",1,"h-8","brightness-0","invert"],[1,"flex-1","flex","items-center","justify-center","px-6"],[1,"w-full","max-w-sm","bg-[#10284C]/90","backdrop-blur-sm","rounded-lg","p-8","space-y-4"],[1,"flex","justify-center","mb-4"],[1,"w-16","h-16","bg-[#CBDD00]","rounded-full","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-10","h-10","text-[#10284C]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","3","d","M5 13l4 4L19 7"],[1,"text-2xl","font-bold","text-[#CBDD00]","text-center","leading-tight"],[1,"text-white","text-center","text-sm"],[1,"space-y-3","pt-4"],[1,"w-full","bg-[#CBDD00]","hover:bg-[#b5c700]","text-[#10284C]","font-semibold","text-base","h-12","rounded-lg","transition-colors",3,"click"]],template:function(e,n){e&1&&_(0,Ie,21,4,"div",0),e&2&&x("ngIf",n.isOpen)},dependencies:[q,G],styles:["[_nghost-%COMP%]{display:contents}"]})};var H=()=>({standalone:!0}),Se=(a,t)=>t.id;function Ve(a,t){if(a&1&&(i(0,"p",54),l(1),o()),a&2){let e,n=m();s(),Q(" ",(e=n.cirugia())==null?null:e.numero_cirugia," - ",n.getClienteNombre()," ")}}function Ke(a,t){a&1&&(i(0,"div",51)(1,"div",55)(2,"div",56)(3,"div",57),c(4,"div",58),o(),i(5,"p",59),l(6,"Cargando informaci\xF3n de la cirug\xEDa..."),o()()()())}function Be(a,t){if(a&1&&(i(0,"div",52)(1,"div",55)(2,"div",60)(3,"div",45),g(),i(4,"svg",61),c(5,"path",62),o(),C(),i(6,"p",63),l(7),o()()()()()),a&2){let e=m();s(7),w(e.error())}}function Te(a,t){if(a&1){let e=E();i(0,"div",111)(1,"div",112)(2,"p",113),l(3),o(),i(4,"p",114),l(5),o()(),i(6,"button",115),h("click",function(){let r=p(e).$implicit,d=m(3);return u(d.agregarProducto(r))}),l(7," Agregar "),o()()}if(a&2){let e=t.$implicit;s(3),w(e.nombre),s(2),Q("",e.codigo," - Stock: ",e.stock_disponible,"")}}function Ae(a,t){if(a&1&&(i(0,"div",69)(1,"h2",70)(2,"div",107),g(),i(3,"svg",100),c(4,"path",108),o()(),C(),i(5,"span"),l(6,"Productos Sugeridos"),o()(),i(7,"p",109),l(8),o(),i(9,"div",110),L(10,Te,8,3,"div",111,Se),o()()),a&2){let e,n=m(2);s(8),b(" Basado en el tipo de cirug\xEDa: ",(e=n.cirugia())==null||e.tipo_cirugia==null?null:e.tipo_cirugia.nombre," "),s(2),N(n.productosSugeridos())}}function Fe(a,t){if(a&1&&(i(0,"option",116),l(1),j(2,"titlecase"),o()),a&2){let e=t.$implicit;x("value",e),s(),b(" ",W(2,2,e)," ")}}function Oe(a,t){if(a&1&&(i(0,"option",116),l(1),o()),a&2){let e=t.$implicit;x("value",e),s(),b(" ",e," ")}}function Le(a,t){if(a&1&&(i(0,"span",125),l(1),o()),a&2){let e=m().$implicit;s(),b(" ",e.marca," ")}}function Ne(a,t){if(a&1&&(i(0,"div",131),l(1),j(2,"number"),o()),a&2){let e=m().$implicit;s(),b(" $",Y(2,1,e.precio,"1.0-0")," ")}}function je(a,t){if(a&1&&(i(0,"div",132),l(1),o()),a&2){let e=m().$implicit;s(),b(" ",e.descripcion," ")}}function Ge(a,t){a&1&&(g(),i(0,"svg",134),c(1,"path",135),o(),l(2," Ya agregado "))}function qe(a,t){a&1&&(g(),i(0,"svg",134),c(1,"path",136),o(),l(2," Agregar "))}function ze(a,t){if(a&1){let e=E();i(0,"div",121)(1,"div",122)(2,"div",112)(3,"h4",113),l(4),o(),i(5,"p",114),l(6),o(),i(7,"div",123)(8,"span",124),l(9),j(10,"titlecase"),o(),_(11,Le,2,1,"span",125),o()(),i(12,"div",126)(13,"div",127)(14,"span",128),l(15),o(),i(16,"div")(17,"div",129),l(18),o(),i(19,"div",130),l(20,"unidades"),o()()(),_(21,Ne,3,4,"div",131),o()(),_(22,je,2,1,"div",132),i(23,"button",133),h("click",function(){let r=p(e).$implicit,d=m(3);return u(d.agregarProducto(r))}),_(24,Ge,3,0)(25,qe,3,0),o()()}if(a&2){let e=t.$implicit,n=m(3);s(4),w(e.nombre),s(2),w(e.codigo),s(3),b(" ",W(10,11,e.categoria)," "),s(2),v(e.marca?11:-1),s(4),w(n.getStockIcon(e)),s(2),x("ngClass",n.getStockColorClass(e)),s(),b(" ",e.stock_total||e.stock_disponible||0," "),s(3),v(e.precio?21:-1),s(),v(e.descripcion?22:-1),s(),x("disabled",n.isProductoAgregado(e.id)),s(),v(n.isProductoAgregado(e.id)?24:25)}}function He(a,t){if(a&1&&(i(0,"div",69)(1,"h2",117)(2,"div",118),g(),i(3,"svg",100),c(4,"path",119),o()(),C(),i(5,"span"),l(6),o()(),i(7,"div",120),L(8,ze,26,13,"div",121,Se),o()()),a&2){let e=m(2);s(6),b("Productos Disponibles (",e.productosEncontrados().length,")"),s(2),N(e.productosEncontrados())}}function Qe(a,t){a&1&&(i(0,"div",97),g(),i(1,"svg",137),c(2,"path",119),o(),C(),i(3,"p",138),l(4,"No hay productos agregados al kit"),o(),i(5,"p",139),l(6,"Busca y agrega productos para armar el kit"),o()())}function We(a,t){if(a&1){let e=E();i(0,"div",140),c(1,"input",141),i(2,"div",122)(3,"div",112)(4,"p",113),l(5),o(),i(6,"p",114),l(7),o()(),i(8,"button",142),h("click",function(){let r=p(e).$index,d=m(3);return u(d.removerProducto(r))}),g(),i(9,"svg",143),c(10,"path",144),o()()(),C(),i(11,"div",145)(12,"div")(13,"label",146),l(14,"Cantidad *"),o(),c(15,"input",147),o(),i(16,"div")(17,"label",146),l(18,"Observaciones"),o(),c(19,"input",148),o()()()}if(a&2){let e=t.$index,n=m(3);x("formGroupName",e),s(5),w(n.getProductoNombre(e)),s(2),w(n.getProductoCodigo(e))}}function Re(a,t){if(a&1&&(i(0,"div",98),L(1,We,20,3,"div",140,Z().trackByProductoId,!0),o()),a&2){let e=m(2);s(),N(e.productosFormArray().controls)}}function $e(a,t){if(a&1&&(g(),i(0,"svg",149),c(1,"circle",150)(2,"path",151),o(),l(3)),a&2){let e=m(2);s(3),b(" ",e.modoEdicion?"Guardando cambios...":"Creando Kit..."," ")}}function Ue(a,t){a&1&&(g(),i(0,"svg",152),c(1,"path",135),o(),l(2," Guardar Cambios "))}function Ze(a,t){a&1&&(g(),i(0,"svg",152),c(1,"path",136),o(),l(2," Crear Kit "))}function Ye(a,t){if(a&1&&_(0,Ue,3,0)(1,Ze,3,0),a&2){let e=m(2);v(e.modoEdicion?0:1)}}function Je(a,t){if(a&1){let e=E();i(0,"main",51)(1,"div",64)(2,"button",65),h("click",function(){p(e);let r=m();return u(r.volver())}),g(),i(3,"svg",66),c(4,"path",67),o(),C(),i(5,"span"),l(6,"Volver"),o()()(),i(7,"form",68),h("ngSubmit",function(){p(e);let r=m();return u(r.onSubmit())}),i(8,"div",69)(9,"h2",70)(10,"div",71),g(),i(11,"svg",72),c(12,"path",73),o()(),C(),i(13,"span"),l(14,"Informaci\xF3n de la Cirug\xEDa"),o()(),i(15,"div",74)(16,"div",75)(17,"span",76),l(18,"Cliente:"),o(),i(19,"span",77),l(20),o()(),i(21,"div",75)(22,"span",76),l(23,"M\xE9dico:"),o(),i(24,"span",77),l(25),o()(),i(26,"div",75)(27,"span",76),l(28,"Fecha:"),o(),i(29,"span",77),l(30),o()(),i(31,"div",78)(32,"span",76),l(33,"Hospital:"),o(),i(34,"span",77),l(35),o()()()(),_(36,Ae,12,1,"div",69),i(37,"div",69)(38,"h2",70)(39,"div",71),g(),i(40,"svg",72),c(41,"path",79),o()(),C(),i(42,"span"),l(43,"Filtros de B\xFAsqueda"),o()(),i(44,"div",80)(45,"div")(46,"label",81),l(47,"Buscar"),o(),i(48,"input",82),K("ngModelChange",function(r){p(e);let d=m();return V(d.busquedaProducto,r)||(d.busquedaProducto=r),u(r)}),h("input",function(){p(e);let r=m();return u(r.buscarProductos())}),o()(),i(49,"div")(50,"label",83),l(51,"Categor\xEDa"),o(),i(52,"select",84),K("ngModelChange",function(r){p(e);let d=m();return V(d.categoriaSeleccionada,r)||(d.categoriaSeleccionada=r),u(r)}),h("change",function(){p(e);let r=m();return u(r.buscarProductos())}),i(53,"option",85),l(54,"Todas las categor\xEDas"),o(),_(55,Fe,3,4,"option",86),o()(),i(56,"div")(57,"label",87),l(58,"Disponibilidad"),o(),i(59,"select",88),K("ngModelChange",function(r){p(e);let d=m();return V(d.filtroStock,r)||(d.filtroStock=r),u(r)}),h("change",function(){p(e);let r=m();return u(r.buscarProductos())}),i(60,"option",85),l(61,"Todos los productos"),o(),i(62,"option",89),l(63,"Solo con stock"),o(),i(64,"option",90),l(65,"Stock bajo"),o(),i(66,"option",91),l(67,"Agotados"),o()()(),i(68,"div")(69,"label",92),l(70,"Marca"),o(),i(71,"select",93),K("ngModelChange",function(r){p(e);let d=m();return V(d.marcaSeleccionada,r)||(d.marcaSeleccionada=r),u(r)}),h("change",function(){p(e);let r=m();return u(r.buscarProductos())}),i(72,"option",85),l(73,"Todas las marcas"),o(),_(74,Oe,2,2,"option",86),o()()(),i(75,"div",94)(76,"div",95),l(77),o()()(),_(78,He,10,1,"div",69),i(79,"div",69)(80,"h2",70)(81,"div",71),g(),i(82,"svg",72),c(83,"path",96),o()(),C(),i(84,"span"),l(85),o()(),_(86,Qe,7,0,"div",97)(87,Re,3,0,"div",98),o(),i(88,"div",69)(89,"h2",70)(90,"div",99),g(),i(91,"svg",100),c(92,"path",101),o()(),C(),i(93,"span"),l(94,"Observaciones del Kit"),o()(),c(95,"textarea",102),o(),i(96,"div",103)(97,"button",104),h("click",function(){p(e);let r=m();return u(r.volver())}),l(98," Cancelar "),o(),i(99,"button",105),_(100,$e,4,1)(101,Ye,2,1),o()(),c(102,"div",106),o()()}if(a&2){let e,n,r,d=m();s(7),x("formGroup",d.form),s(13),w(d.getClienteNombre()),s(5),w((e=d.cirugia())==null?null:e.medico_cirujano),s(5),w(d.formatearFecha((n=d.cirugia())==null?null:n.fecha_programada)),s(5),w((r=d.cirugia())==null||r.hospital==null?null:r.hospital.nombre),s(),v(d.productosSugeridos().length>0?36:-1),s(12),I("ngModel",d.busquedaProducto),x("ngModelOptions",B(22,H)),s(4),I("ngModel",d.categoriaSeleccionada),x("ngModelOptions",B(23,H)),s(3),x("ngForOf",d.categorias()),s(4),I("ngModel",d.filtroStock),x("ngModelOptions",B(24,H)),s(12),I("ngModel",d.marcaSeleccionada),x("ngModelOptions",B(25,H)),s(3),x("ngForOf",d.marcas()),s(3),b(" ",d.productosEncontrados().length," productos encontrados "),s(),v(d.productosEncontrados().length>0?78:-1),s(7),b("Productos del Kit (",d.productosFormArray().length,")"),s(),v(d.productosFormArray().length===0?86:87),s(13),x("disabled",!d.form.valid||d.creandoKit()||d.productosFormArray().length===0),s(),v(d.creandoKit()?100:101)}}var ye=class a{fb=P(ve);router=P(ne);route=P(oe);kitService=P(ke);supabase=P(re);loading=k(!0);error=k(null);creandoKit=k(!1);showSuccessDialog=k(!1);cirugia=k(null);productosSugeridos=k([]);productosEncontrados=k([]);productosSeleccionados=k([]);categorias=k([]);marcas=k([]);form=this.fb.group({productos:this.fb.array([]),observaciones_generales:[""]});busquedaProducto="";cirugiaId="";kitId="";modoEdicion=!1;categoriaSeleccionada="";marcaSeleccionada="";filtroStock="";todosLosProductos=[];productosFormArray=J(()=>this.form.get("productos"));ngOnInit(){this.cirugiaId=this.route.snapshot.paramMap.get("id")||"",this.modoEdicion=this.route.snapshot.url.some(t=>t.path==="edit"),this.modoEdicion?(this.kitId=this.cirugiaId,this.cargarDatosEdicion()):this.cirugiaId?this.cargarDatos():(this.error.set("ID de cirug\xEDa no proporcionado"),this.loading.set(!1))}cargarDatos(){return S(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let{data:t,error:e}=yield this.supabase.client.from("cirugias").select(`
          *,
          hospital:hospitales(*),
          tipo_cirugia:tipos_cirugia(*)
        `).eq("id",this.cirugiaId).single();if(e)throw e;this.cirugia.set(t),t.tipo_cirugia?.productos_comunes&&(yield this.cargarProductosSugeridos(t.tipo_cirugia.productos_comunes)),yield this.cargarTodosLosProductos()}catch(t){console.error("Error cargando datos:",t),this.error.set(t.message||"Error cargando la informaci\xF3n")}finally{this.loading.set(!1)}})}cargarProductosSugeridos(t){return S(this,null,function*(){try{let e=Array.isArray(t)?t:[];if(e.length>0){let{data:n,error:r}=yield this.supabase.client.from("productos").select(`
            *,
            inventario:inventario(cantidad)
          `).in("id",e).eq("es_activo",!0);if(r)throw r;let d=n?.map(f=>A(T({},f),{stock_disponible:f.inventario?.reduce((y,D)=>y+D.cantidad,0)||0}))||[];this.productosSugeridos.set(d)}}catch(e){console.error("Error cargando productos sugeridos:",e)}})}cargarTodosLosProductos(){return S(this,null,function*(){try{let{data:t,error:e}=yield this.supabase.client.from("productos").select(`
          *,
          inventario:inventario(cantidad)
        `).eq("es_activo",!0).order("nombre");if(e)throw e;let n=t?.map(f=>A(T({},f),{stock_total:f.inventario?.reduce((y,D)=>y+D.cantidad,0)||0,stock_disponible:f.inventario?.reduce((y,D)=>y+D.cantidad,0)||0}))||[];this.todosLosProductos=n;let r=[...new Set(n.map(f=>f.categoria).filter(Boolean))],d=[...new Set(n.map(f=>f.marca).filter(Boolean))];this.categorias.set(r),this.marcas.set(d),this.buscarProductos()}catch(t){console.error("Error cargando productos:",t)}})}buscarProductos(){let t=[...this.todosLosProductos];if(this.busquedaProducto.trim()){let n=this.busquedaProducto.toLowerCase().trim();t=t.filter(r=>r.nombre?.toLowerCase().includes(n)||r.codigo?.toLowerCase().includes(n)||r.descripcion?.toLowerCase().includes(n))}if(this.categoriaSeleccionada&&(t=t.filter(n=>n.categoria===this.categoriaSeleccionada)),this.marcaSeleccionada&&(t=t.filter(n=>n.marca===this.marcaSeleccionada)),this.filtroStock)switch(this.filtroStock){case"disponible":t=t.filter(n=>(n.stock_total||0)>0);break;case"bajo":t=t.filter(n=>{let r=n.stock_total||0,d=n.stock_minimo||0;return r>0&&r<=d});break;case"agotado":t=t.filter(n=>(n.stock_total||0)===0);break}let e=t.slice(0,20);this.productosEncontrados.set(e)}agregarProducto(t){let e=this.form.get("productos");if(this.productosSeleccionados().some(r=>r.id===t.id))return;let n=this.fb.group({_uniqueId:[Date.now()+Math.random()],producto_id:[t.id,M.required],cantidad_solicitada:[1,[M.required,M.min(1)]],observaciones:[""]});e.push(n),this.productosSeleccionados.update(r=>[...r,t])}removerProducto(t){this.form.get("productos").removeAt(t),this.productosSeleccionados.update(n=>n.filter((r,d)=>d!==t))}getProductoNombre(t){return this.productosSeleccionados()[t]?.nombre||""}getProductoCodigo(t){return this.productosSeleccionados()[t]?.codigo||""}trackByProductoId(t,e){return e.value?._uniqueId||e.value?.producto_id||t}onSubmit(){return S(this,null,function*(){if(!(!this.form.valid||this.productosFormArray().length===0))try{this.creandoKit.set(!0),this.error.set(null);let t=this.form.value,e=t.productos.map(d=>{var f=d,{_uniqueId:n}=f,r=R(f,["_uniqueId"]);return r});if(this.modoEdicion){let n=A(T({},t),{productos:e});yield this.actualizarKit(n),this.showSuccessDialog.set(!0)}else{let n={cirugia_id:this.cirugiaId,productos:e,observaciones:t.observaciones_generales||void 0};yield F(this.kitService.crearKit(n)),this.showSuccessDialog.set(!0)}}catch(t){console.error("Error procesando kit:",t),this.error.set(t.message||"Error procesando el kit")}finally{this.creandoKit.set(!1)}})}volver(){this.router.navigate(["/internal/agenda"])}onSuccessDialogClose(){this.showSuccessDialog.set(!1),this.router.navigate(["/internal/agenda"])}cargarDatosEdicion(){return S(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t=yield F(this.kitService.getKit(this.kitId)),e=yield F(this.kitService.getKitProductos(this.kitId));this.cirugiaId=t.cirugia_id;let{data:n,error:r}=yield this.supabase.client.from("cirugias").select(`
          *,
          hospital:hospitales(*),
          tipo_cirugia:tipos_cirugia(*)
        `).eq("id",this.cirugiaId).single();if(r)throw r;this.cirugia.set(n),yield this.cargarTodosLosProductos(),this.llenarFormularioConProductos(e),this.form.patchValue({observaciones_generales:t.observaciones||""})}catch(t){console.error("Error cargando datos para edici\xF3n:",t),this.error.set(t.message||"Error cargando la informaci\xF3n del kit")}finally{this.loading.set(!1)}})}llenarFormularioConProductos(t){let e=this.form.get("productos");for(;e.length!==0;)e.removeAt(0);t.forEach(r=>{let d=this.fb.group({producto_id:[r.producto_id,M.required],nombre:[r.producto?.nombre||""],codigo:[r.producto?.codigo||""],cantidad_solicitada:[r.cantidad_solicitada,[M.required,M.min(1)]],observaciones:[r.observaciones||""]});e.push(d)});let n=t.map(r=>({id:r.producto_id,nombre:r.producto?.nombre,codigo:r.producto?.codigo}));this.productosSeleccionados.set(n)}formatearFecha(t){return t?new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}getStockIcon(t){let e=t.stock_total||t.stock_disponible||0,n=t.stock_minimo||0;return e===0?"\u{1F534}":e<=n?"\u{1F7E1}":"\u{1F7E2}"}getStockColorClass(t){let e=t.stock_total||t.stock_disponible||0,n=t.stock_minimo||0;return e===0?"text-red-600 dark:text-red-400":e<=n?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400"}isProductoAgregado(t){return this.form.get("productos").controls.some(n=>n.get("producto_id")?.value===t)}actualizarKit(t){return S(this,null,function*(){console.log("Actualizando kit:",this.kitId,t);let{error:e}=yield this.supabase.client.from("kits_cirugia").update({observaciones:t.observaciones_generales||null,updated_at:new Date().toISOString()}).eq("id",this.kitId);if(e)throw e;let{error:n}=yield this.supabase.client.from("kit_productos").delete().eq("kit_id",this.kitId);if(n)throw n;let r=t.productos||[];if(r.length>0){let d=r.map(y=>({kit_id:this.kitId,producto_id:y.producto_id,cantidad_solicitada:y.cantidad_solicitada,cantidad_preparada:0,observaciones:y.observaciones})),{error:f}=yield this.supabase.client.from("kit_productos").insert(d);if(f)throw f}yield this.supabase.client.from("kit_trazabilidad").insert({kit_id:this.kitId,usuario_id:"00000000-0000-0000-0000-000000000000",accion:"editado",estado_nuevo:"preparando",observaciones:"Kit editado y productos actualizados"})})}getClienteNombre(){let t=this.cirugia();return t?.cliente?`${t.cliente.nombre} ${t.cliente.apellido}`.trim():"Sin informaci\xF3n"}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=O({type:a,selectors:[["app-kit-builder"]],decls:59,vars:8,consts:[[1,"min-h-screen","bg-[#10284C]","relative","overflow-hidden"],[1,"absolute","inset-0","overflow-hidden","pointer-events-none"],["xmlns","http://www.w3.org/2000/svg",1,"absolute","w-full","h-full"],["id","gradFlow1","x1","0%","y1","0%","x2","100%","y2","100%"],["offset","0%",2,"stop-color","#0098A8","stop-opacity","0.15"],["offset","50%",2,"stop-color","#C8D900","stop-opacity","0.08"],["offset","100%",2,"stop-color","#0098A8","stop-opacity","0.12"],["id","gradRadial1","cx","50%","cy","50%","r","50%"],["offset","0%",2,"stop-color","#C8D900","stop-opacity","0.2"],["offset","100%",2,"stop-color","#0098A8","stop-opacity","0"],["d","M 0 100 Q 150 80 300 100 T 600 100 T 900 100 T 1200 100 L 1200 0 L 0 0 Z","fill","#0098A8","opacity","0.06"],["d","M 0 140 Q 200 120 400 140 T 800 140 T 1200 140 L 1200 0 L 0 0 Z","fill","#C8D900","opacity","0.04"],["d","M 100 300 Q 150 250 200 300 Q 250 350 300 300 Q 350 250 400 300","stroke","#0098A8","stroke-width","3","fill","none","opacity","0.12"],["d","M 800 200 Q 850 150 900 200 Q 950 250 1000 200 Q 1050 150 1100 200","stroke","#C8D900","stroke-width","3","fill","none","opacity","0.1"],["opacity","0.08"],["points","150,400 175,415 175,445 150,460 125,445 125,415","fill","none","stroke","#0098A8","stroke-width","2"],["points","200,400 225,415 225,445 200,460 175,445 175,415","fill","none","stroke","#C8D900","stroke-width","2"],["points","175,445 200,460 200,490 175,505 150,490 150,460","fill","none","stroke","#0098A8","stroke-width","2"],["opacity","0.1"],["cx","85%","cy","25%","r","60","fill","none","stroke","#0098A8","stroke-width","2"],["cx","85%","cy","25%","r","80","fill","none","stroke","#C8D900","stroke-width","1.5"],["cx","85%","cy","25%","r","100","fill","none","stroke","#0098A8","stroke-width","1"],["cx","15%","cy","70%","r","150","fill","url(#gradRadial1)"],["cx","90%","cy","80%","r","120","fill","#C8D900","opacity","0.05"],["d","M 0 500 C 200 450, 400 550, 600 500 S 1000 450, 1200 500","stroke","#0098A8","stroke-width","4","fill","none","opacity","0.08"],["d","M 0 600 C 250 550, 450 650, 700 600 S 1050 550, 1200 600","stroke","#C8D900","stroke-width","3","fill","none","opacity","0.06"],["points","300,600 350,700 250,700","fill","#0098A8","opacity","0.08"],["points","900,500 950,600 850,600","fill","#C8D900","opacity","0.07"],["points","500,150 540,230 460,230","fill","#0098A8","opacity","0.06"],["x1","600","y1","300","x2","650","y2","320","stroke","#0098A8","stroke-width","1"],["x1","650","y1","320","x2","700","y2","300","stroke","#0098A8","stroke-width","1"],["x1","700","y1","300","x2","650","y2","270","stroke","#C8D900","stroke-width","1"],["x1","650","y1","270","x2","600","y2","300","stroke","#C8D900","stroke-width","1"],["cx","600","cy","300","r","4","fill","#0098A8"],["cx","650","cy","320","r","4","fill","#C8D900"],["cx","700","cy","300","r","4","fill","#0098A8"],["cx","650","cy","270","r","4","fill","#C8D900"],["d","M 0 800 Q 300 750 600 800 T 1200 800","stroke","#0098A8","stroke-width","5","fill","none","opacity","0.08"],["d","M 0 850 Q 350 800 700 850 T 1200 850","stroke","#C8D900","stroke-width","4","fill","none","opacity","0.06"],["points","50,200 60,220 80,225 60,230 50,250 40,230 20,225 40,220","fill","#C8D900","opacity","0.12"],["points","1100,400 1115,425 1145,430 1115,435 1100,460 1085,435 1055,430 1085,425","fill","#0098A8","opacity","0.1"],["d","M 0,700 L 100,680 L 200,720 L 300,690 L 400,730 L 500,700 L 600,740 L 700,710 L 800,750 L 900,720 L 1000,760 L 1100,730 L 1200,770","stroke","#0098A8","stroke-width","2","fill","none","opacity","0.09"],[1,"relative","z-10","bg-gradient-to-br","from-[#10284C]/95","to-[#10284C]/60","backdrop-blur-md","border-b","border-white/10","shadow-2xl"],[1,"px-4","py-4"],[1,"flex","justify-center","items-center","mb-3"],[1,"flex","items-center","space-x-3"],["src","/logo.webp","alt","Implameq",1,"h-8","brightness-0","invert"],[1,"text-lg","font-semibold","text-white"],[1,"text-center"],[1,"text-2xl","font-bold","mb-1","text-white"],["class","text-[#C8D900] text-sm",4,"ngIf"],[1,"relative","z-10","px-4","py-6"],[1,"relative","z-10","px-4","py-4"],[3,"close","isOpen","title","kitName"],[1,"text-[#C8D900]","text-sm"],[1,"max-w-lg","mx-auto"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","shadow-xl","p-6","text-center"],[1,"flex","justify-center","mb-4"],[1,"w-12","h-12","border-4","border-[#C8D900]","border-t-transparent","rounded-full","animate-spin"],[1,"text-sm","text-white/90","mt-4"],[1,"bg-red-500/20","backdrop-blur-md","border","border-red-400/30","rounded-2xl","shadow-xl","px-4","py-3"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-red-300","flex-shrink-0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"text-sm","text-red-200"],[1,"max-w-lg","mx-auto","mb-4"],["type","button",1,"w-full","bg-white/10","hover:bg-white/20","text-white","px-4","py-3","rounded-xl","font-medium","transition-all","duration-200","shadow-lg","backdrop-blur-sm","border","border-white/20","active:scale-95","flex","items-center","justify-center","space-x-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"max-w-lg","mx-auto","space-y-6",3,"ngSubmit","formGroup"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","shadow-xl","border","border-white/20","p-6"],[1,"text-lg","font-semibold","text-white","mb-4","flex","items-center","space-x-2"],[1,"w-8","h-8","bg-[#C8D900]","rounded-lg","flex","items-center","justify-center","flex-shrink-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-[#10284C]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],[1,"space-y-3","text-sm"],[1,"flex","justify-between","border-b","border-white/10","pb-2"],[1,"font-medium","text-white/70"],[1,"text-white","font-semibold"],[1,"flex","justify-between"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],["for","busqueda",1,"block","text-sm","font-medium","text-white","mb-2"],["type","text","id","busqueda","placeholder","Buscar por nombre o c\xF3digo...",1,"w-full","px-4","py-3","bg-[#10284C]/50","border","border-white/20","text-white","placeholder-white/50","rounded-xl","focus:ring-2","focus:ring-[#C8D900]","focus:border-transparent","transition","duration-200",3,"ngModelChange","input","ngModel","ngModelOptions"],["for","categoria",1,"block","text-sm","font-medium","text-white","mb-2"],["id","categoria",1,"w-full","px-4","py-3","bg-[#10284C]/50","border","border-white/20","text-white","rounded-xl","focus:ring-2","focus:ring-[#C8D900]","focus:border-transparent","transition","duration-200",3,"ngModelChange","change","ngModel","ngModelOptions"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","stockFilter",1,"block","text-sm","font-medium","text-white","mb-2"],["id","stockFilter",1,"w-full","px-4","py-3","bg-[#10284C]/50","border","border-white/20","text-white","rounded-xl","focus:ring-2","focus:ring-[#C8D900]","focus:border-transparent","transition","duration-200",3,"ngModelChange","change","ngModel","ngModelOptions"],["value","disponible"],["value","bajo"],["value","agotado"],["for","marca",1,"block","text-sm","font-medium","text-white","mb-2"],["id","marca",1,"w-full","px-4","py-3","bg-[#10284C]/50","border","border-white/20","text-white","rounded-xl","focus:ring-2","focus:ring-[#C8D900]","focus:border-transparent","transition","duration-200",3,"ngModelChange","change","ngModel","ngModelOptions"],[1,"text-center","pt-2","border-t","border-white/10"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","font-medium","bg-[#C8D900]","text-[#10284C]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"],[1,"text-center","py-8"],["formArrayName","productos",1,"space-y-4"],[1,"w-8","h-8","bg-white/20","rounded-lg","flex","items-center","justify-center","flex-shrink-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["formControlName","observaciones_generales","rows","3","placeholder","Instrucciones especiales, notas para log\xEDstica...",1,"w-full","px-4","py-3","bg-[#10284C]/50","border","border-white/20","text-white","placeholder-white/50","rounded-xl","focus:ring-2","focus:ring-[#C8D900]","focus:border-transparent","resize-none","transition","duration-200"],[1,"flex","flex-col","sm:flex-row","space-y-3","sm:space-y-0","sm:space-x-4"],["type","button",1,"flex-1","bg-white/10","hover:bg-white/20","text-white","border","border-white/20","px-6","py-3","rounded-xl","font-medium","transition-all","duration-200","shadow-lg","backdrop-blur-sm","active:scale-95",3,"click"],["type","submit",1,"flex-1","bg-[#C8D900]","hover:bg-[#C8D900]/90","text-[#10284C]","px-6","py-3","rounded-xl","font-bold","transition-all","duration-200","shadow-xl","disabled:opacity-50","disabled:cursor-not-allowed","active:scale-95",3,"disabled"],[1,"h-6"],[1,"w-8","h-8","bg-[#0098A8]","rounded-lg","flex","items-center","justify-center","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],[1,"text-sm","text-white/70","mb-4"],[1,"space-y-3"],[1,"flex","justify-between","items-center","p-3","border","border-white/10","rounded-xl","hover:bg-white/5","transition","duration-200","backdrop-blur-sm"],[1,"flex-1"],[1,"font-medium","text-white"],[1,"text-sm","text-white/60"],["type","button",1,"bg-[#0098A8]","hover:bg-[#0098A8]/80","text-white","px-3","py-2","rounded-lg","text-sm","font-medium","transition","duration-200","shadow-md","active:scale-95",3,"click"],[3,"value"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white","mb-4","flex","items-center","space-x-2"],[1,"w-8","h-8","bg-gradient-to-br","from-blue-400","to-blue-600","rounded-lg","flex","items-center","justify-center","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"],[1,"space-y-4","max-h-96","overflow-y-auto"],[1,"border","border-white/10","rounded-xl","p-4","bg-white/5","backdrop-blur-sm","hover:bg-white/10","transition","duration-200"],[1,"flex","justify-between","items-start","mb-3"],[1,"flex","items-center","space-x-2","mt-2"],[1,"inline-flex","items-center","px-2","py-0.5","rounded","text-xs","font-medium","bg-[#0098A8]","text-white"],[1,"inline-flex","items-center","px-2","py-0.5","rounded","text-xs","font-medium","bg-[#C8D900]","text-[#10284C]"],[1,"text-right","ml-4"],[1,"flex","items-center","space-x-2"],[1,"text-lg"],[1,"text-sm","font-bold",3,"ngClass"],[1,"text-xs","text-white/50"],[1,"text-sm","font-semibold","text-white","mt-1"],[1,"text-xs","text-white/70","bg-[#10284C]/30","p-2","rounded","mb-3"],["type","button",1,"w-full","bg-[#0098A8]","hover:bg-[#0098A8]/80","disabled:bg-white/10","text-white","px-3","py-2","rounded-lg","text-sm","font-medium","transition","duration-200","disabled:cursor-not-allowed","active:scale-95",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 6v6m0 0v6m0-6h6m-6 0H6"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","text-white/40","mx-auto","mb-4"],[1,"text-white/60"],[1,"text-sm","text-white/40","mt-1"],[1,"border","border-white/10","rounded-xl","p-4","bg-white/5","backdrop-blur-sm","hover:bg-white/10","transition","duration-200",3,"formGroupName"],["type","hidden","formControlName","_uniqueId"],["type","button",1,"text-red-400","hover:text-red-300","p-1","rounded-lg","hover:bg-red-500/20","transition","duration-200","active:scale-95",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-white","mb-2"],["type","number","formControlName","cantidad_solicitada","min","1",1,"w-full","px-3","py-2","bg-[#10284C]/50","border","border-white/20","text-white","rounded-lg","focus:ring-2","focus:ring-[#C8D900]","focus:border-transparent","transition","duration-200"],["type","text","formControlName","observaciones","placeholder","Notas adicionales...",1,"w-full","px-3","py-2","bg-[#10284C]/50","border","border-white/20","text-white","placeholder-white/50","rounded-lg","focus:ring-2","focus:ring-[#C8D900]","focus:border-transparent","transition","duration-200"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","w-5","h-5","inline","mr-2"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","inline","mr-2"]],template:function(e,n){if(e&1&&(i(0,"div",0)(1,"div",1),g(),i(2,"svg",2)(3,"defs")(4,"linearGradient",3),c(5,"stop",4)(6,"stop",5)(7,"stop",6),o(),i(8,"radialGradient",7),c(9,"stop",8)(10,"stop",9),o()(),c(11,"path",10)(12,"path",11)(13,"path",12)(14,"path",13),i(15,"g",14),c(16,"polygon",15)(17,"polygon",16)(18,"polygon",17),o(),i(19,"g",18),c(20,"circle",19)(21,"circle",20)(22,"circle",21),o(),c(23,"circle",22)(24,"circle",23)(25,"path",24)(26,"path",25)(27,"polygon",26)(28,"polygon",27)(29,"polygon",28),i(30,"g",18),c(31,"line",29)(32,"line",30)(33,"line",31)(34,"line",32)(35,"circle",33)(36,"circle",34)(37,"circle",35)(38,"circle",36),o(),c(39,"path",37)(40,"path",38)(41,"polygon",39)(42,"polygon",40)(43,"path",41),o()(),C(),i(44,"header",42)(45,"div",43)(46,"div",44)(47,"div",45),c(48,"img",46),i(49,"span",47),l(50,"Armar Kit Quir\xFArgico"),o()()(),i(51,"div",48)(52,"h1",49),l(53),o(),_(54,Ve,2,2,"p",50),o()()(),_(55,Ke,7,0,"div",51)(56,Be,8,1,"div",52)(57,Je,103,26,"main",51),o(),i(58,"app-kit-success-dialog",53),h("close",function(){return n.onSuccessDialogClose()}),o()),e&2){let r;s(53),w(n.modoEdicion?"Editar Kit Quir\xFArgico":"Crear Kit Quir\xFArgico"),s(),x("ngIf",n.cirugia()),s(),v(n.loading()?55:-1),s(),v(n.error()?56:-1),s(),v(!n.loading()&&!n.error()?57:-1),s(),x("isOpen",n.showSuccessDialog())("title",n.modoEdicion?`Kit actualizado
exitosamente`:`Kit creado
exitosamente`)("kitName",((r=n.cirugia())==null?null:r.numero_cirugia)||"")}},dependencies:[q,X,ee,G,ie,te,we,ce,fe,he,ae,me,_e,le,se,be,pe,xe,ue,ge,Ce,de,z],styles:[".grid[_ngcontent-%COMP%]{display:grid}.grid-cols-1[_ngcontent-%COMP%]{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.gap-4[_ngcontent-%COMP%]{gap:1rem}.max-h-60[_ngcontent-%COMP%]{max-height:15rem}.overflow-y-auto[_ngcontent-%COMP%]{overflow-y:auto}.space-x-4[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not([hidden]) ~ [_ngcontent-%COMP%]:not([hidden]){margin-left:1rem}.flex-1[_ngcontent-%COMP%]{flex:1 1 0%}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (min-width: 768px){.md\\:grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}}.form-section[_ngcontent-%COMP%]{max-width:42rem;margin:0 auto}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.animate-pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 2s cubic-bezier(.4,0,.6,1) infinite}.max-h-60[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.max-h-60[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9;border-radius:3px}.max-h-60[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.max-h-60[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.dark[_ngcontent-%COMP%]   .max-h-60[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#374151}.dark[_ngcontent-%COMP%]   .max-h-60[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#6b7280}.dark[_ngcontent-%COMP%]   .max-h-60[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}"]})};export{ye as KitBuilderComponent};
