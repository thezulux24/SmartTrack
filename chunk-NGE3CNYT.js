import{a as S}from"./chunk-R5CL5IZ3.js";import{a as I}from"./chunk-DBTWTZYU.js";import"./chunk-C4VFUW4K.js";import{c as V,j as T,p as D,v as A}from"./chunk-3OSVPALZ.js";import{$ as f,Ab as u,Bb as L,Ia as s,S as w,Sa as k,Xa as E,Y as x,Z as g,_ as h,cb as y,ib as b,la as v,lb as G,mb as H,nb as e,ob as o,pb as m,qb as _,tb as p,ub as d,zb as n}from"./chunk-MBDN4FSM.js";import"./chunk-X5YLR3NI.js";import{i as j}from"./chunk-ODN5LVDJ.js";var N=(r,i)=>i.id;function U(r,i){r&1&&(e(0,"div",37)(1,"div",42),m(2,"div",43),o(),e(3,"p",44),n(4,"Cargando hojas de gasto..."),o()())}function P(r,i){if(r&1){let t=_();e(0,"div",38),h(),e(1,"svg",45),m(2,"path",46),o(),f(),e(3,"p",47),n(4),o(),e(5,"button",48),p("click",function(){x(t);let l=d();return g(l.loadHojasGasto())}),n(6," Reintentar "),o()()}if(r&2){let t=d();s(4),u(t.error())}}function O(r,i){if(r&1){let t=_();e(0,"div",39)(1,"h3",49),h(),e(2,"svg",50),m(3,"path",51),o(),n(4," Filtros "),o(),f(),e(5,"div",52)(6,"div")(7,"label",53),n(8,"Estado"),o(),e(9,"select",54),p("change",function(l){x(t);let c=d();return g(c.onFiltroEstadoChange(l.target.value))}),e(10,"option",55),n(11,"Todos los estados"),o(),e(12,"option",56),n(13,"Pendiente"),o(),e(14,"option",57),n(15,"En Proceso"),o(),e(16,"option",58),n(17,"Completada"),o(),e(18,"option",59),n(19,"Validada"),o(),e(20,"option",60),n(21,"Facturada"),o()()(),e(22,"button",61),p("click",function(){x(t);let l=d();return g(l.clearFiltros())}),n(23," Limpiar filtros "),o()()()}if(r&2){let t=d();s(9),y("value",t.filtroEstado())}}function R(r,i){if(r&1){let t=_();e(0,"button",85),p("click",function(l){x(t);let c=d().$implicit;return d(2).editarHoja(c.id),g(l.stopPropagation())}),n(1," Editar "),o()}}function $(r,i){if(r&1){let t=_();e(0,"div",64),p("click",function(){let l=x(t).$implicit,c=d(2);return g(c.verDetalle(l.id))}),e(1,"div",65)(2,"div",66)(3,"div",67)(4,"div",68)(5,"h3",69),n(6),o(),e(7,"span",70),n(8),o()(),e(9,"p",71),n(10),o()(),e(11,"div",72)(12,"p",73),n(13),o(),e(14,"p",74),n(15,"Total"),o()()()(),e(16,"div",75)(17,"div",76)(18,"div")(19,"p",74),n(20,"T\xE9cnico"),o(),e(21,"p",77),n(22),o()(),e(23,"div")(24,"p",74),n(25,"Fecha Cirug\xEDa"),o(),e(26,"p",77),n(27),o()()(),e(28,"div",78)(29,"div",34)(30,"p",74),n(31,"Productos"),o(),e(32,"p",79),n(33),o()(),e(34,"div",34)(35,"p",74),n(36,"Transporte"),o(),e(37,"p",80),n(38),o()(),e(39,"div",34)(40,"p",74),n(41,"Otros"),o(),e(42,"p",81),n(43),o()()(),e(44,"div",82)(45,"button",83),p("click",function(l){let c=x(t).$implicit;return d(2).verDetalle(c.id),g(l.stopPropagation())}),n(46," Ver Detalle "),o(),E(47,R,2,0,"button",84),o()()()}if(r&2){let t=i.$implicit,a=d(2);s(6),u(t.numero_hoja),s(),y("ngClass",a.getEstadoInfo(t.estado).color),s(),L(" ",a.getEstadoInfo(t.estado).label," "),s(2),u(a.getClienteNombre(t)),s(3),u(a.formatMoneda(t.total_general)),s(9),u(a.getTecnicoNombre(t)),s(5),u(a.formatFecha(t.fecha_cirugia)),s(6),u(a.formatMoneda(t.total_productos)),s(5),u(a.formatMoneda(t.total_transporte)),s(5),u(a.formatMoneda(t.total_otros)),s(4),b(a.canEditHoja(t)?47:-1)}}function z(r,i){if(r&1){let t=_();e(0,"div",63),h(),e(1,"svg",86),m(2,"path",87)(3,"path",88),o(),f(),e(4,"p",89),n(5,"No hay hojas de gasto disponibles"),o(),e(6,"button",90),p("click",function(){x(t);let l=d(2);return g(l.nuevaHoja())}),n(7," Crear primera hoja de gasto "),o()()}}function q(r,i){if(r&1&&(e(0,"div",40),G(1,$,48,11,"div",62,N),E(3,z,8,0,"div",63),o()),r&2){let t=d();s(),H(t.hojasGasto()),s(2),b(t.hojasGasto().length===0?3:-1)}}var F=class r{router=w(D);hojaGastoService=w(I);supabaseService=w(A);loading=v(!1);error=v(null);hojasGasto=v([]);currentUserRole=v(null);currentUserId=v(null);filtroEstado=v("");ESTADOS_CONFIG=S;ngOnInit(){return j(this,null,function*(){console.log("\u{1F4CB} HojaGastoListComponent iniciando..."),yield this.loadCurrentUser(),this.loadHojasGasto()})}loadCurrentUser(){return j(this,null,function*(){try{let i=yield this.supabaseService.getSession();if(i?.user?.id){this.currentUserId.set(i.user.id);let{data:t}=yield this.supabaseService.client.from("profiles").select("role").eq("id",i.user.id).single();t&&(this.currentUserRole.set(t.role),console.log("\u{1F464} Usuario actual - Rol:",t.role))}}catch(i){console.error("Error cargando usuario actual:",i)}})}loadHojasGasto(){this.loading.set(!0),this.error.set(null);let i={};this.currentUserRole()==="soporte_tecnico"&&this.currentUserId()&&(i.tecnico_id=this.currentUserId(),console.log("\u{1F50D} Filtrando hojas de gasto para t\xE9cnico:",this.currentUserId())),this.filtroEstado()&&(i.estado=this.filtroEstado()),this.hojaGastoService.getHojasGasto(i).subscribe({next:t=>{this.hojasGasto.set(t),this.loading.set(!1),console.log("\u2705 Hojas de gasto cargadas:",t.length)},error:t=>{console.error("\u274C Error cargando hojas de gasto:",t),this.error.set("Error al cargar las hojas de gasto. Por favor, int\xE9ntelo de nuevo."),this.loading.set(!1)}})}onFiltroEstadoChange(i){this.filtroEstado.set(i),this.loadHojasGasto()}clearFiltros(){this.filtroEstado.set(""),this.loadHojasGasto()}nuevaHoja(){this.router.navigate(["/internal/hojas-gasto/new"])}verDetalle(i){this.router.navigate(["/internal/hojas-gasto/detail",i])}editarHoja(i){this.router.navigate(["/internal/hojas-gasto/edit",i])}volver(){this.router.navigate(["/internal"])}getEstadoInfo(i){return S[i]||{label:i,color:"bg-gray-100 text-gray-800"}}getClienteNombre(i){return i.cirugia?.cliente?`${i.cirugia.cliente.nombre} ${i.cirugia.cliente.apellido}`:"N/A"}getTecnicoNombre(i){return i.tecnico?.full_name?i.tecnico.full_name:"N/A"}formatMoneda(i){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(i)}formatFecha(i){return new Date(i).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit"})}cambiarEstado(i,t,a){a.stopPropagation(),this.hojaGastoService.cambiarEstado(i,t).subscribe({next:l=>{let c=this.hojasGasto(),C=c.findIndex(M=>M.id===i);C!==-1&&(c[C]=l,this.hojasGasto.set([...c]))},error:l=>{console.error("Error cambiando estado:",l),this.error.set("Error al cambiar el estado. Por favor, int\xE9ntelo de nuevo.")}})}canEditHoja(i){let t=this.currentUserRole(),a=this.currentUserId();return!t||!(i.estado==="borrador"||i.estado==="revision")?!1:t==="soporte_tecnico"?i.tecnico_id===a:t==="logistica"||t==="admin"}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=k({type:r,selectors:[["app-hoja-gasto-list"]],decls:48,vars:4,consts:[[1,"min-h-screen","relative","overflow-hidden"],[1,"absolute","inset-0","z-0"],[1,"absolute","inset-0","bg-[#10284C]"],["xmlns","http://www.w3.org/2000/svg",1,"absolute","w-full","h-full"],["points","100,20 120,30 120,50 100,60 80,50 80,30","fill","#0098A8","opacity","0.1","transform","scale(1.5)"],["points","750,100 770,110 770,130 750,140 730,130 730,110","fill","#C8D900","opacity","0.09"],["cx","15%","cy","20%","r","100","fill","#0098A8","opacity","0.12"],["cx","80%","cy","15%","r","140","fill","#C8D900","opacity","0.08"],["cx","50%","cy","75%","r","120","fill","#0098A8","opacity","0.1"],["cx","25%","cy","85%","r","80","fill","#C8D900","opacity","0.11"],["points","300,50 350,150 250,150","fill","#0098A8","opacity","0.08"],["points","1100,400 1150,500 1050,500","fill","#C8D900","opacity","0.07"],["x","65%","y","40%","width","140","height","140","fill","#0098A8","opacity","0.09","transform","rotate(45 70 45)"],["x","10%","y","55%","width","100","height","100","fill","#C8D900","opacity","0.08","transform","rotate(30 15 60)"],["x1","0%","y1","25%","x2","100%","y2","30%","stroke","#0098A8","stroke-width","3","opacity","0.1"],["x1","0%","y1","65%","x2","100%","y2","60%","stroke","#C8D900","stroke-width","2","opacity","0.09"],["x1","20%","y1","0%","x2","25%","y2","100%","stroke","#0098A8","stroke-width","2","opacity","0.08"],["x1","75%","y1","0%","x2","80%","y2","100%","stroke","#C8D900","stroke-width","2","opacity","0.07"],["points","600,150 610,170 630,175 610,180 600,200 590,180 570,175 590,170","fill","#0098A8","opacity","0.1"],["points","200,450 210,470 230,475 210,480 200,500 190,480 170,475 190,470","fill","#C8D900","opacity","0.09"],["d","M 900 200 Q 920 220 900 240","stroke","#0098A8","stroke-width","15","fill","none","opacity","0.08"],["d","M 150 600 Q 170 620 150 640","stroke","#C8D900","stroke-width","12","fill","none","opacity","0.09"],[1,"absolute","inset-0","bg-gradient-to-br","from-[#10284C]/60","via-[#10284C]/85","to-[#10284C]/95"],[1,"relative","z-10","px-4","py-6"],[1,"max-w-4xl","mx-auto","space-y-6"],[1,"flex","flex-col","sm:flex-row","justify-between","items-center","gap-4"],["src","https://www.implameq.com/wp-content/uploads/logotipo-impla-300x78.png.webp","alt","Implameq",1,"h-10","w-auto","brightness-0","invert"],[1,"flex","items-center","gap-2"],[1,"px-4","py-2","bg-[#C8D900]","text-[#10284C]","rounded-lg","hover:bg-[#d4e820]","transition-colors","font-medium","flex","items-center","gap-2","active:scale-95",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"hidden","sm:inline"],[1,"px-4","py-2","bg-white/10","text-white","border","border-white/20","rounded-lg","hover:bg-white/20","transition-colors","font-medium","flex","items-center","gap-2","backdrop-blur-sm","active:scale-95",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-center"],[1,"text-3xl","sm:text-4xl","font-bold","text-[#C8D900]","mb-2"],[1,"text-white/80","text-sm"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","p-6","shadow-xl"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","p-6","shadow-xl","text-center"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","p-4","shadow-xl"],[1,"space-y-4"],[1,"h-6"],[1,"flex","justify-center","items-center","h-64"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-[#C8D900]"],[1,"text-sm","text-white/70","mt-4","text-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4","text-red-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"text-sm","text-white","mb-4"],["type","button",1,"px-6","py-2","bg-red-500/20","text-red-300","border","border-red-400/40","rounded-lg","hover:bg-red-500/30","transition-all","font-semibold","active:scale-95",3,"click"],[1,"text-sm","font-medium","text-white","mb-3","flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-[#C8D900]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"],[1,"space-y-3"],[1,"block","text-xs","text-white/70","mb-1"],[1,"w-full","px-3","py-2","text-sm","bg-[#10284C]/50","border","border-white/20","rounded-lg","text-white","focus:ring-2","focus:ring-[#C8D900]","focus:border-transparent","backdrop-blur-sm",3,"change","value"],["value",""],["value","pendiente"],["value","en_proceso"],["value","completada"],["value","validada"],["value","facturada"],[1,"w-full","text-xs","text-white/70","hover:text-white","transition-colors",3,"click"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","shadow-xl","hover:bg-[#0098A8]/25","transition-all","duration-200","cursor-pointer"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","p-8","text-center","shadow-xl"],[1,"bg-[#0098A8]/20","backdrop-blur-md","rounded-2xl","border","border-white/20","shadow-xl","hover:bg-[#0098A8]/25","transition-all","duration-200","cursor-pointer",3,"click"],[1,"p-4","border-b","border-white/20"],[1,"flex","justify-between","items-start","gap-3"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-1"],[1,"text-lg","font-semibold","text-white"],[1,"inline-flex","px-2","py-1","text-xs","font-semibold","rounded-full",3,"ngClass"],[1,"text-sm","text-white/80"],[1,"text-right"],[1,"text-lg","font-bold","text-[#C8D900]"],[1,"text-xs","text-white/70"],[1,"p-4"],[1,"grid","grid-cols-2","gap-4","mb-3"],[1,"text-sm","font-medium","text-white"],[1,"grid","grid-cols-3","gap-2","pt-3","border-t","border-white/20"],[1,"text-sm","font-semibold","text-blue-300"],[1,"text-sm","font-semibold","text-green-300"],[1,"text-sm","font-semibold","text-gray-300"],[1,"mt-4","flex","gap-2"],[1,"flex-1","bg-[#C8D900]","hover:bg-[#d4e820]","text-[#10284C]","px-3","py-2","rounded-lg","text-xs","font-medium","transition-all","active:scale-95",3,"click"],[1,"bg-[#0098A8]","hover:bg-[#0098A8]/80","text-white","px-3","py-2","rounded-lg","text-xs","font-medium","transition-all","active:scale-95"],[1,"bg-[#0098A8]","hover:bg-[#0098A8]/80","text-white","px-3","py-2","rounded-lg","text-xs","font-medium","transition-all","active:scale-95",3,"click"],["fill","currentColor","viewBox","0 0 20 20",1,"w-12","h-12","text-[#C8D900]/50","mx-auto","mb-4"],["d","M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"],["fill-rule","evenodd","d","M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6.586A2 2 0 0117.414 13L16 14.414V17a2 2 0 01-2 2H6a2 2 0 01-2-2v-2.586L2.586 13A2 2 0 012 11.414V5z","clip-rule","evenodd"],[1,"text-white/70","mb-4"],[1,"bg-[#C8D900]","hover:bg-[#d4e820]","text-[#10284C]","px-6","py-3","rounded-xl","font-bold","transition-all","shadow-xl","active:scale-95",3,"click"]],template:function(t,a){t&1&&(e(0,"div",0)(1,"div",1)(2,"div",2),h(),e(3,"svg",3),m(4,"polygon",4)(5,"polygon",5)(6,"circle",6)(7,"circle",7)(8,"circle",8)(9,"circle",9)(10,"polygon",10)(11,"polygon",11)(12,"rect",12)(13,"rect",13)(14,"line",14)(15,"line",15)(16,"line",16)(17,"line",17)(18,"polygon",18)(19,"polygon",19)(20,"path",20)(21,"path",21),o()(),f(),m(22,"div",22),o(),e(23,"main",23)(24,"div",24)(25,"div",25),m(26,"img",26),e(27,"div",27)(28,"button",28),p("click",function(){return a.nuevaHoja()}),h(),e(29,"svg",29),m(30,"path",30),o(),f(),e(31,"span",31),n(32,"Nueva"),o()(),e(33,"button",32),p("click",function(){return a.volver()}),h(),e(34,"svg",29),m(35,"path",33),o(),f(),e(36,"span",31),n(37,"Volver"),o()()()(),e(38,"div",34)(39,"h1",35),n(40,"Hojas de Gasto"),o(),e(41,"p",36),n(42,"Registro de gastos quir\xFArgicos por t\xE9cnicos"),o()(),E(43,U,5,0,"div",37)(44,P,7,1,"div",38)(45,O,24,1,"div",39)(46,q,4,1,"div",40),m(47,"div",41),o()()()),t&2&&(s(43),b(a.loading()?43:-1),s(),b(!a.loading()&&a.error()?44:-1),s(),b(!a.loading()&&!a.error()?45:-1),s(),b(!a.loading()&&!a.error()?46:-1))},dependencies:[T,V],encapsulation:2})};export{F as HojaGastoListComponent};
