import{a as G,b as C,c as q,d as z,h as L,k as B,n as U,o as R,p as $,q as Q,w as J,y as K}from"./chunk-DRTBTDHH.js";import{a as O}from"./chunk-EERVG3VT.js";import{$ as u,Da as A,Ea as D,G as a,J as N,Ja as W,N as p,Oa as j,Q as d,S as k,Ta as M,Z as t,_ as e,aa as I,ba as b,ca as c,ha as l,ia as f,ja as V,u as w,w as x,x as _,y as P,z as T}from"./chunk-IAYZCRTW.js";import"./chunk-LJ5XHLMQ.js";import{h as F}from"./chunk-FK42CRUA.js";function X(n,r){n&1&&(t(0,"div",12)(1,"div",13)(2,"div",14),u(3,"div",15)(4,"div",16),e(),t(5,"p",17),l(6,"Cargando informaci\xF3n del usuario..."),e()()())}function Y(n,r){if(n&1){let i=I();t(0,"div",12)(1,"div",13)(2,"div",18),P(),t(3,"svg",19),u(4,"path",20),e(),T(),t(5,"p",21),l(6),e()(),t(7,"button",22),b("click",function(){x(i);let s=c();return _(s.logout())}),l(8," Volver al login "),e()()()}if(n&2){let i=c();a(6),f(i.error)}}function Z(n,r){n&1&&(t(0,"div",40),l(1," El nombre es requerido (m\xEDnimo 2 caracteres) "),e())}function ee(n,r){if(n&1&&(t(0,"option",41),l(1),e()),n&2){let i=r.$implicit;d("value",i.value),a(),V(" ",i.label," ")}}function te(n,r){n&1&&(t(0,"div",40),l(1," Debes seleccionar un \xE1rea de trabajo "),e())}function ie(n,r){n&1&&(t(0,"div",40),l(1," Formato de tel\xE9fono inv\xE1lido "),e())}function oe(n,r){n&1&&(t(0,"span"),l(1,"Crear Perfil"),e())}function ne(n,r){n&1&&(t(0,"span",42),P(),t(1,"svg",43),u(2,"circle",44)(3,"path",45),e(),l(4," Creando perfil... "),e())}function le(n,r){if(n&1){let i=I();t(0,"div",12)(1,"h2",23),l(2," Completa tu perfil para continuar "),e(),t(3,"form",24),b("ngSubmit",function(){x(i);let s=c();return _(s.onSubmitProfile())}),t(4,"div",25)(5,"label",26),l(6," Nombre completo * "),e(),u(7,"input",27),p(8,Z,2,0,"div",28),e(),t(9,"div",25)(10,"label",29),l(11," \xC1rea de trabajo * "),e(),t(12,"select",30)(13,"option",31),l(14,"Selecciona tu \xE1rea"),e(),p(15,ee,2,2,"option",32),e(),p(16,te,2,0,"div",28),e(),t(17,"div",25)(18,"label",33),l(19," Tel\xE9fono (opcional) "),e(),u(20,"input",34),p(21,ie,2,0,"div",28),e(),t(22,"div",35)(23,"button",36),p(24,oe,2,0,"span",37)(25,ne,5,0,"span",38),e(),t(26,"button",39),b("click",function(){x(i);let s=c();return _(s.logout())}),l(27," Cerrar sesi\xF3n "),e()()()()}if(n&2){let i,o,s,g,v,h,S,E,y,m=c();a(3),d("formGroup",m.profileForm),a(4),k("ring-2",((i=m.profileForm.get("full_name"))==null?null:i.invalid)&&((i=m.profileForm.get("full_name"))==null?null:i.touched))("ring-red-400",((o=m.profileForm.get("full_name"))==null?null:o.invalid)&&((o=m.profileForm.get("full_name"))==null?null:o.touched)),a(),d("ngIf",((s=m.profileForm.get("full_name"))==null?null:s.invalid)&&((s=m.profileForm.get("full_name"))==null?null:s.touched)),a(4),k("ring-2",((g=m.profileForm.get("role"))==null?null:g.invalid)&&((g=m.profileForm.get("role"))==null?null:g.touched))("ring-red-400",((v=m.profileForm.get("role"))==null?null:v.invalid)&&((v=m.profileForm.get("role"))==null?null:v.touched)),a(3),d("ngForOf",m.roleOptions),a(),d("ngIf",((h=m.profileForm.get("role"))==null?null:h.invalid)&&((h=m.profileForm.get("role"))==null?null:h.touched)),a(4),k("ring-2",((S=m.profileForm.get("phone"))==null?null:S.invalid)&&((S=m.profileForm.get("phone"))==null?null:S.touched))("ring-red-400",((E=m.profileForm.get("phone"))==null?null:E.invalid)&&((E=m.profileForm.get("phone"))==null?null:E.touched)),a(),d("ngIf",((y=m.profileForm.get("phone"))==null?null:y.invalid)&&((y=m.profileForm.get("phone"))==null?null:y.touched)),a(2),d("disabled",m.savingProfile),a(),d("ngIf",!m.savingProfile),a(),d("ngIf",m.savingProfile)}}function re(n,r){if(n&1&&(t(0,"div",61)(1,"span",62),l(2,"Tel\xE9fono:"),e(),t(3,"span",66),l(4),e()()),n&2){let i=c(2);a(4),f(i.userProfile.phone)}}function ae(n,r){if(n&1){let i=I();t(0,"div",12)(1,"div",46)(2,"div",47)(3,"div",48)(4,"span",49),l(5),e()(),t(6,"div",50),P(),t(7,"svg",51),u(8,"path",52)(9,"path",53),e()()(),T(),t(10,"h2",54),l(11),e(),t(12,"p",55),l(13),e(),t(14,"div",56)(15,"span",57),l(16),e()(),t(17,"p",58),l(18,"Implameq S.A.S."),e()(),t(19,"div",59),p(20,re,5,1,"div",60),t(21,"div",61)(22,"span",62),l(23,"Estado:"),e(),t(24,"span",63),l(25),e()()(),t(26,"div",64)(27,"button",65),b("click",function(){x(i);let s=c();return _(s.acceder())}),l(28," Acceder al Sistema "),e(),t(29,"button",39),b("click",function(){x(i);let s=c();return _(s.logout())}),l(30," Cerrar sesi\xF3n "),e()()()}if(n&2){let i=c();a(5),f(i.displayName.charAt(0).toUpperCase()),a(6),f(i.displayName),a(2),f(i.userProfile.email),a(3),f(i.roleDisplayName),a(4),d("ngIf",i.userProfile.phone),a(5),f(i.userProfile.is_active?"Activo":"Inactivo")}}var H=class n{_authService=w(O);_supabaseService=w(M);_router=w(j);_fb=w(J);loading=!0;userProfile=null;error=null;showProfileForm=!1;savingProfile=!1;profileForm=this._fb.group({full_name:["",[C.required,C.minLength(2)]],role:["",C.required],area:[""],phone:["",[C.pattern(/^[\+]?[\d\s\-\(\)]+$/)]]});roleOptions=[{value:"comercial",label:"Comercial",area:"comercial"},{value:"soporte_tecnico",label:"Soporte T\xE9cnico",area:"soporte"},{value:"logistica",label:"Log\xEDstica",area:"logistica"},{value:"admin",label:"Administrador",area:"admin"}];ngOnInit(){return F(this,null,function*(){try{let r=yield this._supabaseService.getSession(),i=r?.user?.id;if(!i){this._router.navigate(["/auth"]);return}let o=yield this._supabaseService.getUserProfile(i);o?this.userProfile=o:(this.showProfileForm=!0,this.profileForm.patchValue({full_name:r.user.user_metadata?.full_name||""}))}catch(r){console.error("Error cargando perfil:",r),this.error=r?.message??"Error al cargar informaci\xF3n del usuario"}finally{this.loading=!1}})}onSubmitProfile(){return F(this,null,function*(){if(this.profileForm.invalid){this.markFormGroupTouched();return}this.savingProfile=!0;try{let r=yield this._supabaseService.getSession(),i=r?.user?.id;if(!i)throw new Error("No se encontr\xF3 sesi\xF3n de usuario");let o=this.profileForm.value,s=this.roleOptions.find(h=>h.value===o.role),g={id:i,full_name:o.full_name,email:r.user.email,role:o.role,area:s?.area||o.role,phone:o.phone||null,is_active:!0},v=yield this._supabaseService.createUserProfile(g);this.userProfile=v,this.showProfileForm=!1,this.error=null}catch(r){console.error("Error creando perfil:",r),this.error=r?.message??"Error al crear el perfil"}finally{this.savingProfile=!1}})}markFormGroupTouched(){Object.keys(this.profileForm.controls).forEach(r=>{this.profileForm.get(r)?.markAsTouched()})}get displayName(){return this.userProfile?.full_name||this.userProfile?.email||"Usuario"}get roleDisplayName(){return{client:"Cliente",comercial:"Comercial",soporte_tecnico:"Soporte T\xE9cnico",logistica:"Log\xEDstica",admin:"Administrador"}[this.userProfile?.role||""]||this.userProfile?.role||"Sin rol"}acceder(){this.userProfile?.role&&(this.userProfile.role==="client"?this._router.navigate(["/client"]):this._router.navigate(["/internal"]))}logout(){return F(this,null,function*(){yield this._authService.logOut(),this._router.navigate(["/auth/log-in"])})}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=N({type:n,selectors:[["app-welcome-home"]],decls:17,vars:5,consts:[[1,"font-neo","relative","min-h-screen","overflow-hidden"],[1,"absolute","inset-0","z-0"],["src","06.jpg","alt","Medical background",1,"w-full","h-full","object-cover"],[1,"absolute","inset-0",2,"background","linear-gradient(180deg, rgba(16, 40, 76, 0.75) 0%, rgba(0, 152, 168, 0.65) 100%)"],[1,"relative","z-10","flex","items-center","justify-center","min-h-screen","px-6","py-10"],[1,"w-full","max-w-md"],[1,"flex","flex-col","items-center","text-center","mb-8"],[1,"text-2xl","font-semibold","text-white","mb-6"],[1,"mb-4"],["src","https://www.implameq.com/wp-content/uploads/logotipo-impla-300x78.png.webp","alt","Implameq",1,"w-48","h-auto","brightness-0","invert"],[1,"text-sm","text-white/80","mb-8"],["class","bg-[#10284C]/40 backdrop-blur-sm rounded-3xl p-8 shadow-2xl border-3 border-[#C8D900]",4,"ngIf"],[1,"bg-[#10284C]/40","backdrop-blur-sm","rounded-3xl","p-8","shadow-2xl","border-3","border-[#C8D900]"],[1,"text-center"],[1,"animate-pulse"],[1,"h-4","bg-white/20","rounded","w-3/4","mx-auto","mb-2"],[1,"h-4","bg-white/20","rounded","w-1/2","mx-auto"],[1,"text-sm","text-white/70","mt-4"],[1,"text-red-400"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"text-sm","text-white"],["type","button",1,"mt-6","w-full","bg-white","hover:bg-white/90","text-[#0098A8]","font-bold","text-sm","h-12","rounded-lg","shadow-lg",3,"click"],[1,"text-xl","font-semibold","text-white","text-center","mb-6"],[1,"space-y-5",3,"ngSubmit","formGroup"],[1,"space-y-2"],["for","full_name",1,"block","text-sm","font-medium","text-white"],["type","text","id","full_name","formControlName","full_name","placeholder","Escribe tu nombre aqu\xED",1,"w-full","bg-accent","border-none","rounded-lg","h-12","px-3","text-sm","placeholder:text-heading/60","text-heading","font-medium","focus:outline-none","focus:ring-2","focus:ring-white","transition-all"],["class","text-red-300 text-xs mt-1",4,"ngIf"],["for","role",1,"block","text-sm","font-medium","text-white"],["id","role","formControlName","role",1,"w-full","bg-[#C8D900]","border-none","rounded-lg","h-12","px-3","text-sm","text-heading","font-medium","focus:outline-none","focus:ring-2","focus:ring-white","transition-all"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","phone",1,"block","text-sm","font-medium","text-white"],["type","tel","id","phone","formControlName","phone","placeholder","+57 300 123 4567",1,"w-full","bg-[#C8D900]","border-none","rounded-lg","h-12","px-3","text-sm","placeholder:text-heading/60","text-heading","font-medium","focus:outline-none","focus:ring-2","focus:ring-white","transition-all"],[1,"space-y-3","pt-2"],["type","submit",1,"w-full","bg-white","hover:bg-white/90","text-[#0098A8]","font-bold","text-base","h-12","rounded-lg","shadow-lg","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"disabled"],[4,"ngIf"],["class","flex items-center justify-center",4,"ngIf"],["type","button",1,"w-full","bg-[#10284C]","hover:bg-[#10284C]/80","text-white","border-2","border-white/30","font-semibold","text-sm","h-12","rounded-lg","transition-all",3,"click"],[1,"text-red-300","text-xs","mt-1"],[3,"value"],[1,"flex","items-center","justify-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-4","w-4","text-[#0098A8]"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"flex","flex-col","items-center","mb-6"],[1,"relative","mb-4"],[1,"w-24","h-24","rounded-full","overflow-hidden","border-4","border-white/20","bg-gradient-to-r","from-[#C8D900]","to-[#0098A8]","flex","items-center","justify-center"],[1,"text-white","text-3xl","font-bold"],[1,"absolute","bottom-0","right-0","bg-[#0098A8]","rounded-full","p-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 13a3 3 0 11-6 0 3 3 0 016 0z"],[1,"text-xl","font-semibold","text-white","mb-1"],[1,"text-sm","text-white/70","mb-3"],[1,"bg-[#C8D900]","px-4","py-1","rounded-full","mb-4"],[1,"text-sm","font-semibold","text-[#10284C]"],[1,"text-xs","text-white/60","mb-6"],[1,"border-t","border-white/20","pt-4","mb-6","space-y-2"],["class","flex justify-between text-sm",4,"ngIf"],[1,"flex","justify-between","text-sm"],[1,"text-white/70"],[1,"text-[#C8D900]","font-medium"],[1,"space-y-3"],["type","button",1,"w-full","bg-[#C8D900]","hover:bg-[#B5C600]","text-[#10284C]","font-bold","text-sm","h-12","rounded-lg","shadow-lg","transition-all","duration-200",3,"click"],[1,"text-white","font-medium"]],template:function(i,o){i&1&&(t(0,"div",0)(1,"div",1),u(2,"img",2)(3,"div",3),e(),t(4,"div",4)(5,"div",5)(6,"div",6)(7,"h1",7),l(8),e(),t(9,"div",8),u(10,"img",9),e(),t(11,"p",10),l(12,"Implantes m\xE9dico - Quir\xFArgicos"),e()(),p(13,X,7,0,"div",11)(14,Y,9,1,"div",11)(15,le,28,20,"div",11)(16,ae,31,6,"div",11),e()()()),i&2&&(a(8),V(" ",o.showProfileForm?"Completar Perfil":"Bienvenido a"," "),a(5),d("ngIf",o.loading),a(),d("ngIf",!o.loading&&o.error),a(),d("ngIf",!o.loading&&!o.error&&o.showProfileForm),a(),d("ngIf",!o.loading&&!o.error&&!o.showProfileForm&&o.userProfile))},dependencies:[W,A,D,K,L,$,Q,G,R,q,z,B,U],encapsulation:2})};export{H as default};
