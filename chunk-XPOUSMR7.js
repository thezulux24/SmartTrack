import{a as Y}from"./chunk-Q6XZXIU7.js";import{$ as T,Ba as B,E as S,Ea as R,G as d,J as G,Ja as W,N as V,Q as j,S as x,T as f,V as I,W as y,X as k,Y as i,Z as n,_ as m,aa as h,ba as s,c as L,da as l,ea as u,fa as p,ga as O,ma as A,oa as q,q as U,qa as z,u as F,va as N,w as v,x as b,y as g,z as _}from"./chunk-NR6UGQL3.js";import"./chunk-LJ5XHLMQ.js";import{h as M}from"./chunk-FK42CRUA.js";var $=class r{supabase=F(Y);getMyCirugias(){return L(this.getTechnicianCirugias())}getTechnicianCirugias(){return M(this,null,function*(){try{let t=yield this.supabase.getCurrentUserId();if(!t)throw new Error("Usuario no autenticado");let{data:e,error:a}=yield this.supabase.client.from("cirugias").select(`
          *,
          hospital_data:hospital_id(id, nombre, direccion, telefono, contacto_principal),
          tipo_cirugia_data:tipo_cirugia_id(id, nombre, descripcion, duracion_promedio),
          tecnico_asignado:tecnico_asignado_id(id, full_name, email, phone),
          usuario_creador:usuario_creador_id(id, full_name, email)
        `).eq("tecnico_asignado_id",t).order("fecha_programada",{ascending:!0});if(a)throw console.error("Error loading technician cirugias:",a),a;return console.log("\u2705 Cirug\xEDas del t\xE9cnico cargadas:",e),e||[]}catch(t){throw console.error("\u274C Error in getTechnicianCirugias:",t),t}})}getMyCirugiasForDateRange(t,e){return L(this.getTechnicianCirugiasForDateRange(t,e))}getTechnicianCirugiasForDateRange(t,e){return M(this,null,function*(){try{let a=yield this.supabase.getCurrentUserId();if(!a)throw new Error("Usuario no autenticado");let{data:o,error:c}=yield this.supabase.client.from("cirugias").select(`
          *,
          hospital_data:hospital_id(id, nombre, direccion, telefono, contacto_principal),
          tipo_cirugia_data:tipo_cirugia_id(id, nombre, descripcion, duracion_promedio),
          tecnico_asignado:tecnico_asignado_id(id, full_name, email, phone),
          usuario_creador:usuario_creador_id(id, full_name, email)
        `).eq("tecnico_asignado_id",a).gte("fecha_programada",t).lte("fecha_programada",e).order("fecha_programada",{ascending:!0});if(c)throw c;return o||[]}catch(a){throw console.error("\u274C Error getting cirugias for date range:",a),a}})}getTechnicianStats(){return M(this,null,function*(){try{let t=yield this.supabase.getCurrentUserId();if(!t)throw new Error("Usuario no autenticado");let e=new Date().toISOString().split("T")[0],{data:a,error:o}=yield this.supabase.client.from("cirugias").select("id",{count:"exact"}).eq("tecnico_asignado_id",t);if(o)throw o;let{data:c,error:C}=yield this.supabase.client.from("cirugias").select("id",{count:"exact"}).eq("tecnico_asignado_id",t).in("estado",["programada","en_curso"]);if(C)throw C;let{data:E,error:w}=yield this.supabase.client.from("cirugias").select("id",{count:"exact"}).eq("tecnico_asignado_id",t).eq("estado","completada");if(w)throw w;let{data:D,error:H}=yield this.supabase.client.from("cirugias").select("id",{count:"exact"}).eq("tecnico_asignado_id",t).gte("fecha_programada",e).lt("fecha_programada",`${e}T23:59:59`);if(H)throw H;return{totalCirugias:a?.length||0,cirugiasPendientes:c?.length||0,cirugiasCompletadas:E?.length||0,cirugiasHoy:D?.length||0}}catch(t){return console.error("\u274C Error getting technician stats:",t),{totalCirugias:0,cirugiasPendientes:0,cirugiasCompletadas:0,cirugiasHoy:0}}})}markCirugiaAsCompleted(t){return M(this,null,function*(){try{let e=yield this.supabase.getCurrentUserId();if(!e)throw new Error("Usuario no autenticado");let{data:a,error:o}=yield this.supabase.client.from("cirugias").select("id, tecnico_asignado_id").eq("id",t).eq("tecnico_asignado_id",e).single();if(o||!a)throw new Error("No tienes permisos para modificar esta cirug\xEDa");let{error:c}=yield this.supabase.client.from("cirugias").update({estado:"completada",updated_at:new Date().toISOString(),updated_by:e}).eq("id",t);if(c)throw c}catch(e){throw console.error("\u274C Error marking cirugia as completed:",e),e}})}addTechnicianNotes(t,e){return M(this,null,function*(){try{let a=yield this.supabase.getCurrentUserId();if(!a)throw new Error("Usuario no autenticado");let{data:o,error:c}=yield this.supabase.client.from("cirugias").select("id, tecnico_asignado_id, notas").eq("id",t).eq("tecnico_asignado_id",a).single();if(c||!o)throw new Error("No tienes permisos para modificar esta cirug\xEDa");let C=o.notas||"",E=`[T\xE9cnico - ${new Date().toLocaleDateString()}]: ${e}`,w=C?`${C}

${E}`:E,{error:D}=yield this.supabase.client.from("cirugias").update({notas:w,updated_at:new Date().toISOString(),updated_by:a}).eq("id",t);if(D)throw D}catch(a){throw console.error("\u274C Error adding technician notes:",a),a}})}static \u0275fac=function(e){return new(e||r)};static \u0275prov=U({token:r,factory:r.\u0275fac,providedIn:"root"})};var K=()=>["/internal/agenda"],X=()=>({weekday:"short"}),Z=()=>[0,1,2,3,4,5,6],ee=(r,t)=>t.titulo,te=(r,t)=>t.date.getTime(),P=(r,t)=>t.id,ie=(r,t)=>t.getTime();function ne(r,t){r&1&&(i(0,"div",17)(1,"div",19)(2,"div",20)(3,"div",21),m(4,"div",22)(5,"div",23)(6,"div",24),n(),i(7,"p",25),l(8,"Cargando mis cirug\xEDas..."),n()()()())}function ae(r,t){if(r&1){let e=T();i(0,"div",17)(1,"div",19)(2,"div",20)(3,"div",26),g(),i(4,"svg",27),m(5,"path",28),n(),_(),i(6,"p",29),l(7),n()(),i(8,"button",30),h("click",function(){v(e);let o=s();return b(o.refreshData())}),l(9," Reintentar "),n()()()()}if(r&2){let e=s();d(7),u(e.error())}}function re(r,t){r&1&&(g(),i(0,"svg",48),m(1,"path",53),n())}function oe(r,t){r&1&&(g(),i(0,"svg",48),m(1,"path",54),n())}function de(r,t){r&1&&(g(),i(0,"svg",48),m(1,"path",54),n())}function le(r,t){if(r&1&&(i(0,"div",46)(1,"div",47)(2,"div"),V(3,re,2,0,":svg:svg",48)(4,oe,2,0,":svg:svg",48)(5,de,2,0,":svg:svg",48),n(),i(6,"div",49)(7,"p",50),l(8),n(),i(9,"p",51),l(10),n()(),i(11,"span",52),l(12),n()()()),r&2){let e=t.$implicit;x(e.tipo==="urgente"?"bg-red-50 border-red-200 dark:bg-red-900/20":e.tipo==="advertencia"?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20":"bg-blue-50 border-blue-200 dark:bg-blue-900/20"),d(2),x(e.tipo==="urgente"?"text-red-500":e.tipo==="advertencia"?"text-yellow-500":"text-blue-500"),d(),f(e.tipo==="urgente"?3:e.tipo==="advertencia"?4:5),d(4),x(e.tipo==="urgente"?"text-red-800 dark:text-red-300":e.tipo==="advertencia"?"text-yellow-800 dark:text-yellow-300":"text-blue-800 dark:text-blue-300"),d(),p(" ",e.titulo," "),d(),x(e.tipo==="urgente"?"text-red-700 dark:text-red-400":e.tipo==="advertencia"?"text-yellow-700 dark:text-yellow-400":"text-blue-700 dark:text-blue-400"),d(),p(" ",e.mensaje," "),d(),x(e.tipo==="urgente"?"text-red-600 dark:text-red-400":e.tipo==="advertencia"?"text-yellow-600 dark:text-yellow-400":"text-blue-600 dark:text-blue-400"),d(),p(" ",e.tiempo," ")}}function se(r,t){if(r&1&&(i(0,"div",31)(1,"div",32)(2,"h3",43),l(3,"Mis Alertas"),n(),i(4,"div",44),y(5,le,13,14,"div",45,ee),n()()()),r&2){let e=s(2);d(5),k(e.alerts())}}function ce(r,t){if(r&1&&(i(0,"div",57)(1,"span",60),l(2),n()()),r&2){let e=t.$implicit;d(2),u(e)}}function me(r,t){if(r&1){let e=T();i(0,"button",65),h("click",function(){let o=v(e).$implicit,c=s(4);return b(c.selectEvent(o))}),i(1,"div",66),l(2),n(),i(3,"div",67),l(4),n()()}if(r&2){let e=t.$implicit,a=s(4);x(a.getTipoUrgencia(e)==="urgente"?"bg-red-100 text-red-700 border-red-200":"bg-blue-100 text-blue-700 border-blue-200"),d(2),u(a.getClienteNombre(e)),d(2),u(a.formatHora(e.hora_inicio))}}function ge(r,t){if(r&1&&(i(0,"div",61)(1,"div",62),l(2),n(),i(3,"div",63),y(4,me,5,4,"button",64,P),n()()),r&2){let e=t.$implicit;x(e.isCurrentMonth?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-700"),d(),x(e.isToday?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":e.isCurrentMonth?"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-500"),d(),p(" ",e.date.getDate()," "),d(2),k(e.events)}}function ue(r,t){if(r&1&&(i(0,"div",19)(1,"div",55)(2,"div",56),y(3,ce,3,1,"div",57,I),n(),i(5,"div",58),y(6,ge,6,5,"div",59,te),n()()()),r&2){let e=s(2);d(3),k(e.weekDays),d(3),k(e.calendarDays())}}function pe(r,t){if(r&1&&(i(0,"div",70)(1,"div",52),l(2),n(),i(3,"div",73),l(4),n()()),r&2){let e=t.$implicit,a=s(3);d(),x(a.isToday(e)?"text-green-600 dark:text-green-400 font-bold":"text-gray-700 dark:text-gray-300"),d(),p(" ",e.toLocaleDateString("es-ES",A(6,X))," "),d(),x(a.isToday(e)?"text-green-600 dark:text-green-400 font-bold":"text-gray-900 dark:text-white"),d(),p(" ",e.getDate()," ")}}function xe(r,t){if(r&1){let e=T();i(0,"button",77),h("click",function(){let o=v(e).$implicit,c=s(5);return b(c.selectEvent(o))}),i(1,"div",66),l(2),n(),i(3,"div",67),l(4),n()()}if(r&2){let e=t.$implicit,a=s(5);x(a.getTipoUrgencia(e)==="urgente"?"bg-red-100 text-red-700 border-red-200 hover:bg-red-200":"bg-blue-100 text-blue-700 border-blue-200 hover:bg-blue-200"),d(2),u(a.getClienteNombre(e)),d(2),u(a.getTipoCirugiaNombre(e))}}function _e(r,t){if(r&1&&(i(0,"div",75),y(1,xe,5,4,"button",76,P),n()),r&2){let e=t.$implicit,a=s().$implicit,o=s(3);d(),k(o.getEventsForDayHour(e,a))}}function he(r,t){if(r&1&&(i(0,"div",72)(1,"div",74),l(2),n(),y(3,_e,3,0,"div",75,I),n()),r&2){let e=t.$implicit,a=s(3);d(2),p(" ",a.formatHour(e)," "),d(),k(A(1,Z))}}function ve(r,t){if(r&1&&(i(0,"div",19)(1,"div",55)(2,"div",68),m(3,"div",69),y(4,pe,5,7,"div",70,ie),n(),i(6,"div",71),y(7,he,5,2,"div",72,I),n()()()),r&2){let e=s(2);d(4),k(e.getWeekDays()),d(3),k(e.hours)}}function be(r,t){if(r&1){let e=T();i(0,"button",84),h("click",function(){let o=v(e).$implicit,c=s(4);return b(c.selectEvent(o))}),i(1,"div",85)(2,"h4",86),l(3),n(),i(4,"span",87),l(5),n()(),i(6,"div",88)(7,"div",7),g(),i(8,"svg",9),m(9,"path",89),n(),_(),i(10,"span"),l(11),n()(),i(12,"div",7),g(),i(13,"svg",9),m(14,"path",90),n(),_(),i(15,"span"),l(16),n()(),i(17,"div",7),g(),i(18,"svg",9),m(19,"path",91),n(),_(),i(20,"span"),l(21),n()(),i(22,"div",7),g(),i(23,"svg",9),m(24,"path",92),n(),_(),i(25,"span"),l(26),n()(),i(27,"div",7),g(),i(28,"svg",9),m(29,"path",89),n(),_(),i(30,"span"),l(31),n()()()()}if(r&2){let e=t.$implicit,a=s(4);x(a.getTipoUrgencia(e)==="urgente"?"border-l-red-500 bg-red-50 dark:bg-red-900/20":"border-l-blue-500 bg-blue-50 dark:bg-blue-900/20"),d(3),u(a.getClienteNombre(e)),d(),x(a.getTipoUrgencia(e)==="urgente"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"),d(),p(" ",a.getStatusLabel(e.estado)," "),d(6),O("",a.formatHora(e.hora_inicio)," - ",a.getHoraFin(e),""),d(5),u(a.getHospitalNombre(e)),d(5),p("Dr. ",e.medico_cirujano,""),d(5),u(a.getTipoCirugiaNombre(e)),d(5),p("Duraci\xF3n: ",a.getDuracionEstimada(e),"")}}function fe(r,t){r&1&&(i(0,"div",83),l(1," Sin cirug\xEDas asignadas "),n())}function Ce(r,t){if(r&1&&(i(0,"div",79)(1,"div",80),l(2),n(),i(3,"div",81),y(4,be,32,12,"button",82,P,!1,fe,2,0,"div",83),n()()),r&2){let e=t.$implicit,a=s(3);d(2),p(" ",a.formatHour(e)," "),d(2),k(a.getEventsForHour(e))}}function we(r,t){if(r&1&&(i(0,"div",41)(1,"div",32)(2,"h3",43),l(3),n(),i(4,"div",78),y(5,Ce,7,2,"div",79,I),n()()()),r&2){let e=s(2);d(3),p(" ",e.getCurrentDayDate()," "),d(2),k(e.hours)}}function ye(r,t){r&1&&(i(0,"div",19)(1,"div",93)(2,"div",94)(3,"div",95),l(4,"\u{1F468}\u200D\u2695\uFE0F"),n(),i(5,"h3",96),l(6,"No tienes cirug\xEDas asignadas"),n(),i(7,"p",97),l(8,"Cuando se te asignen cirug\xEDas, aparecer\xE1n aqu\xED"),n(),i(9,"button",98),l(10," Ver Agenda General "),n()()()()),r&2&&(d(9),j("routerLink",A(1,K)))}function ke(r,t){if(r&1){let e=T();i(0,"main",17)(1,"div",31)(2,"div",32)(3,"div",33)(4,"button",34),h("click",function(){v(e);let o=s();return b(o.previousPeriod())}),g(),i(5,"svg",35),m(6,"path",36),n()(),_(),i(7,"h2",37),l(8),n(),i(9,"button",34),h("click",function(){v(e);let o=s();return b(o.nextPeriod())}),g(),i(10,"svg",35),m(11,"path",38),n()()(),_(),i(12,"div",39)(13,"button",40),h("click",function(){v(e);let o=s();return b(o.setView("month"))}),l(14," Mes "),n(),i(15,"button",40),h("click",function(){v(e);let o=s();return b(o.setView("week"))}),l(16," Semana "),n(),i(17,"button",40),h("click",function(){v(e);let o=s();return b(o.setView("day"))}),l(18," D\xEDa "),n()()()(),V(19,se,7,0,"div",31)(20,ue,8,0,"div",19)(21,ve,9,0,"div",19)(22,we,7,1,"div",41)(23,ye,11,2,"div",19),m(24,"div",42),n()}if(r&2){let e=s();d(8),p(" ",e.getCurrentPeriodTitle()," "),d(5),x(e.currentView()==="month"?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400"),d(2),x(e.currentView()==="week"?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400"),d(2),x(e.currentView()==="day"?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400"),d(2),f(e.alerts().length>0?19:-1),d(),f(e.currentView()==="month"?20:-1),d(),f(e.currentView()==="week"?21:-1),d(),f(e.currentView()==="day"?22:-1),d(),f(e.cirugias().length===0?23:-1)}}function Ee(r,t){if(r&1&&(i(0,"div",115)(1,"span",116),l(2,"Documento:"),n(),i(3,"span",117),l(4),n()()),r&2){let e=s(3);d(4),u(e.getClienteDocumento(e.selectedEventDetails()))}}function Se(r,t){if(r&1&&(i(0,"div",115)(1,"span",116),l(2,"Tel\xE9fono:"),n(),i(3,"span",117),l(4),n()()),r&2){let e=s(3);d(4),u(e.getClienteTelefono(e.selectedEventDetails()))}}function De(r,t){if(r&1&&(i(0,"div",110)(1,"div",111)(2,"div",126),g(),i(3,"svg",127),m(4,"path",91),n()(),_(),i(5,"h5",86),l(6,"Cliente"),n()(),i(7,"div",114),V(8,Ee,5,1,"div",115)(9,Se,5,1,"div",115),n()()),r&2){let e=s(2);d(8),f(e.getClienteDocumento(e.selectedEventDetails())?8:-1),d(),f(e.getClienteTelefono(e.selectedEventDetails())?9:-1)}}function Te(r,t){if(r&1&&(i(0,"div",110)(1,"div",111)(2,"div",128),g(),i(3,"svg",129),m(4,"path",130),n()(),_(),i(5,"h5",86),l(6,"Notas"),n()(),i(7,"p",131),l(8),n()()),r&2){let e=s(2);d(8),p(" ",e.selectedEventDetails().notas," ")}}function Me(r,t){if(r&1){let e=T();i(0,"div",99),h("click",function(){v(e);let o=s();return b(o.closeModal())}),i(1,"div",100),h("click",function(o){return v(e),b(o.stopPropagation())}),i(2,"div",101)(3,"div",102)(4,"h3",37),l(5," Mi Cirug\xEDa Asignada "),n(),i(6,"button",103),h("click",function(){v(e);let o=s();return b(o.closeModal())}),g(),i(7,"svg",35),m(8,"path",104),n()()()(),_(),i(9,"div",105)(10,"div",14)(11,"div",106),l(12),n(),i(13,"h4",107),l(14),n(),i(15,"p",108),l(16),n()(),i(17,"div",109)(18,"div",110)(19,"div",111)(20,"div",112),g(),i(21,"svg",113),m(22,"path",89),n()(),_(),i(23,"h5",86),l(24,"Programaci\xF3n"),n()(),i(25,"div",114)(26,"div",115)(27,"span",116),l(28,"Fecha:"),n(),i(29,"span",117),l(30),q(31,"date"),n()(),i(32,"div",115)(33,"span",116),l(34,"Hora inicio:"),n(),i(35,"span",117),l(36),n()(),i(37,"div",115)(38,"span",116),l(39,"Hora fin (est.):"),n(),i(40,"span",117),l(41),n()(),i(42,"div",115)(43,"span",116),l(44,"Duraci\xF3n:"),n(),i(45,"span",117),l(46),n()()()(),i(47,"div",110)(48,"div",111)(49,"div",118),g(),i(50,"svg",119),m(51,"path",91),n()(),_(),i(52,"h5",86),l(53,"Equipo M\xE9dico"),n()(),i(54,"div",114)(55,"div",115)(56,"span",116),l(57,"Cirujano:"),n(),i(58,"span",117),l(59),n()(),i(60,"div",115)(61,"span",116),l(62,"T\xE9cnico:"),n(),i(63,"span",117),l(64),n()()()(),i(65,"div",110)(66,"div",111)(67,"div",120),g(),i(68,"svg",121),m(69,"path",90),n()(),_(),i(70,"h5",86),l(71,"Ubicaci\xF3n"),n()(),i(72,"div",114)(73,"div",115)(74,"span",116),l(75,"Hospital:"),n(),i(76,"span",117),l(77),n()()()(),V(78,De,10,2,"div",110)(79,Te,9,1,"div",110),n()(),i(80,"div",122)(81,"div",123)(82,"button",124),h("click",function(){v(e);let o=s();return b(o.navigateToEvent(o.selectedEventDetails()))}),l(83," Ver Detalles "),n(),i(84,"button",125),h("click",function(){v(e);let o=s();return b(o.closeModal())}),l(85," Cerrar "),n()()()()()}if(r&2){let e=s();d(11),x(e.getTipoUrgencia(e.selectedEventDetails())==="urgente"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"),d(),p(" ",e.getStatusLabel(e.selectedEventDetails().estado)," "),d(2),p(" ",e.getClienteNombre(e.selectedEventDetails())," "),d(2),p(" ",e.getTipoCirugiaNombre(e.selectedEventDetails())," "),d(14),u(z(31,14,e.selectedEventDetails().fecha_programada,"dd/MM/yyyy")),d(6),u(e.formatHora(e.selectedEventDetails().hora_inicio)),d(5),u(e.getHoraFin(e.selectedEventDetails())),d(5),u(e.getDuracionEstimada(e.selectedEventDetails())),d(13),p("Dr. ",e.selectedEventDetails().medico_cirujano,""),d(5),u(e.getTecnicoNombre(e.selectedEventDetails())),d(13),u(e.getHospitalNombre(e.selectedEventDetails())),d(),f(e.getClienteDocumento(e.selectedEventDetails())||e.getClienteTelefono(e.selectedEventDetails())?78:-1),d(),f(e.selectedEventDetails().notas?79:-1)}}var J=class r{technicianAgendaService=F($);currentView=S("month");currentDate=S(new Date);selectedEvent=S(null);loading=S(!1);error=S(null);cirugias=S([]);showModal=S(!1);selectedEventDetails=S(null);alerts=N(()=>{let t=[],e=new Date;return new Date(e).setDate(e.getDate()+1),this.cirugias().forEach(o=>{this.isToday(new Date(o.fecha_programada))&&(o.estado==="programada"?t.push({tipo:"info",titulo:"Cirug\xEDa Programada Hoy",mensaje:`${this.getClienteNombre(o)} - ${this.formatHora(o.hora_inicio)}`,tiempo:"Hoy"}):o.estado==="en_curso"&&t.push({tipo:"urgente",titulo:"Cirug\xEDa en Curso",mensaje:`${this.getClienteNombre(o)} - ${this.getTipoCirugiaNombre(o)}`,tiempo:"En curso"})),this.isTomorrow(o.fecha_programada)&&o.estado==="programada"&&t.push({tipo:"advertencia",titulo:"Cirug\xEDa Ma\xF1ana",mensaje:`${this.getClienteNombre(o)} - ${this.formatHora(o.hora_inicio)}`,tiempo:"Ma\xF1ana"}),o.prioridad==="urgencia"&&o.estado!=="completada"&&t.push({tipo:"urgente",titulo:"Cirug\xEDa Urgente Asignada",mensaje:`${this.getClienteNombre(o)} - ${this.getTipoCirugiaNombre(o)}`,tiempo:this.getTimeAgo(o.created_at||"")})}),t.slice(0,5)});weekDays=["Dom","Lun","Mar","Mi\xE9","Jue","Vie","S\xE1b"];hours=Array.from({length:24},(t,e)=>e);ngOnInit(){this.loadMyCirugias()}loadMyCirugias(){this.loading.set(!0),this.error.set(null),this.technicianAgendaService.getMyCirugias().subscribe({next:t=>{console.log("\u2705 Mis cirug\xEDas cargadas:",t),this.cirugias.set(t),this.loading.set(!1)},error:t=>{console.error("\u274C Error loading my cirugias:",t),this.error.set("Error al cargar mis cirug\xEDas asignadas"),this.loading.set(!1)}})}calendarDays=N(()=>{let t=this.currentDate(),e=t.getFullYear(),a=t.getMonth(),o=new Date(e,a,1),c=new Date(e,a+1,0),C=new Date(o);C.setDate(C.getDate()-o.getDay());let E=[],w=new Date(C);for(let D=0;D<42;D++){let H=this.getEventsForDate(w);E.push({date:new Date(w),isCurrentMonth:w.getMonth()===a,isToday:this.isToday(w),events:H}),w.setDate(w.getDate()+1)}return E});getEventsForDate(t){return this.cirugias().filter(e=>new Date(e.fecha_programada).toDateString()===t.toDateString())}getEventsForHour(t){let e=this.currentDate();return this.cirugias().filter(a=>new Date(a.fecha_programada).toDateString()!==e.toDateString()||!a.hora_inicio?!1:parseInt(a.hora_inicio.split(":")[0])===t)}getEventsForDayHour(t,e){let o=this.getWeekDays()[t];return this.cirugias().filter(c=>new Date(c.fecha_programada).toDateString()!==o.toDateString()||!c.hora_inicio?!1:parseInt(c.hora_inicio.split(":")[0])===e)}getWeekDays(){let t=new Date(this.currentDate()),e=new Date(t);e.setDate(t.getDate()-t.getDay());let a=[];for(let o=0;o<7;o++){let c=new Date(e);c.setDate(e.getDate()+o),a.push(c)}return a}isToday(t){let e=new Date;return t.toDateString()===e.toDateString()}isTomorrow(t){let e=new Date;return e.setDate(e.getDate()+1),new Date(t).toDateString()===e.toDateString()}getCurrentPeriodTitle(){let t=this.currentDate();switch(this.currentView()){case"month":return t.toLocaleDateString("es-ES",{month:"long",year:"numeric"});case"week":let a=this.getWeekDays()[0],o=this.getWeekDays()[6];return`${a.toLocaleDateString("es-ES",{day:"numeric",month:"short"})} - ${o.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})}`;case"day":return t.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"});default:return""}}getCurrentDayDate(){return this.currentDate().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}getStatusLabel(t){return{programada:"Programada",en_curso:"En Curso",completada:"Completada",cancelada:"Cancelada",urgencia:"Urgencia"}[t]||t}formatHour(t){return`${t.toString().padStart(2,"0")}:00`}formatHora(t){return t?t.substring(0,5):"Sin hora"}setView(t){this.currentView.set(t)}previousPeriod(){let t=new Date(this.currentDate());switch(this.currentView()){case"month":t.setMonth(t.getMonth()-1);break;case"week":t.setDate(t.getDate()-7);break;case"day":t.setDate(t.getDate()-1);break}this.currentDate.set(t)}nextPeriod(){let t=new Date(this.currentDate());switch(this.currentView()){case"month":t.setMonth(t.getMonth()+1);break;case"week":t.setDate(t.getDate()+7);break;case"day":t.setDate(t.getDate()+1);break}this.currentDate.set(t)}selectEvent(t){this.selectedEventDetails.set(t),this.showModal.set(!0),console.log("Mi cirug\xEDa seleccionada:",t)}closeModal(){this.showModal.set(!1),this.selectedEventDetails.set(null)}navigateToEvent(t){this.closeModal()}getHospitalNombre(t){return t.hospital_data?.nombre||"Hospital no especificado"}getTipoCirugiaNombre(t){return t.tipo_cirugia_data?.nombre||"Tipo no especificado"}getTecnicoNombre(t){return t.tecnico_asignado?.full_name||"Sin asignar"}getDuracionEstimada(t){if(t.duracion_estimada){let e=Math.floor(t.duracion_estimada/60),a=t.duracion_estimada%60;return e>0?`${e}h ${a}m`:`${a}m`}return"No estimada"}getTimeAgo(t){if(!t)return"Reciente";let e=new Date,a=new Date(t),o=Math.floor((e.getTime()-a.getTime())/(1e3*60));return o<60?`${o} min`:o<1440?`${Math.floor(o/60)}h`:`${Math.floor(o/1440)}d`}getTipoUrgencia(t){return t.estado==="urgencia"||t.prioridad==="urgencia"?"urgente":"programada"}getHoraFin(t){if(!t.hora_inicio||!t.duracion_estimada)return"";let[e,a]=t.hora_inicio.split(":").map(Number),c=e*60+a+t.duracion_estimada,C=Math.floor(c/60),E=c%60;return`${C.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}`}refreshData(){this.loadMyCirugias()}getClienteNombre(t){return t.cliente?`${t.cliente.nombre} ${t.cliente.apellido}`:"Cliente no especificado"}getClienteDocumento(t){return t.cliente?`${t.cliente.documento_tipo}: ${t.cliente.documento_numero}`:null}getClienteTelefono(t){return t.cliente&&t.cliente.telefono||null}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=G({type:r,selectors:[["app-agenda-tecnico"]],decls:25,vars:7,consts:[[1,"bg-gray-50","dark:bg-gray-900","min-h-screen"],[1,"bg-gradient-to-r","from-green-600","to-emerald-700","text-white","shadow-lg"],[1,"px-4","py-4"],[1,"flex","justify-between","items-center","mb-3"],[1,"flex","items-center","space-x-3"],["src","https://www.implameq.com/wp-content/uploads/logotipo-impla-300x78.png.webp","alt","Implameq",1,"h-8","brightness-0","invert"],[1,"text-lg","font-semibold"],[1,"flex","items-center","space-x-2"],[1,"bg-white/20","hover:bg-white/30","text-white","px-3","py-2","rounded-lg","text-sm","font-medium","transition","duration-200","shadow-md","backdrop-blur-sm",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"bg-white/20","hover:bg-white/30","text-white","px-3","py-2","rounded-lg","text-sm","font-medium","transition","duration-200","shadow-md","backdrop-blur-sm",3,"routerLink"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-center"],[1,"text-2xl","font-bold","mb-1"],[1,"text-green-100","text-sm"],[1,"px-4","py-6"],[1,"fixed","inset-0","bg-black","bg-opacity-50","z-50","flex","items-end","sm:items-center","justify-center","p-4"],[1,"max-w-lg","mx-auto"],[1,"bg-white","rounded-xl","shadow-md","dark:bg-gray-800","p-6","text-center"],[1,"animate-pulse","space-y-4"],[1,"h-4","bg-gray-200","rounded","w-3/4","mx-auto"],[1,"h-4","bg-gray-200","rounded","w-1/2","mx-auto"],[1,"h-4","bg-gray-200","rounded","w-2/3","mx-auto"],[1,"text-sm","text-gray-500","mt-4"],[1,"text-red-600","dark:text-red-400"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"text-sm"],["type","button",1,"mt-4","w-full","text-white","bg-red-600","hover:bg-red-700","focus:ring-4","focus:outline-none","focus:ring-red-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center",3,"click"],[1,"max-w-lg","mx-auto","mb-6"],[1,"bg-white","rounded-xl","shadow-md","dark:bg-gray-800","dark:border","dark:border-gray-700","p-4"],[1,"flex","items-center","justify-between","mb-4"],[1,"p-2","text-gray-600","hover:bg-gray-100","rounded-lg","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"flex","bg-gray-100","dark:bg-gray-700","rounded-lg","p-1"],[1,"flex-1","px-3","py-2","text-sm","font-medium","rounded-md","transition-colors",3,"click"],[1,"max-w-lg","mx-auto","space-y-4"],[1,"h-6"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white","mb-3"],[1,"space-y-3"],[1,"p-3","rounded-lg","border",3,"class"],[1,"p-3","rounded-lg","border"],[1,"flex","items-start","space-x-3"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","mt-0.5"],[1,"flex-1"],[1,"text-sm","font-medium"],[1,"text-xs","mt-1"],[1,"text-xs","font-medium"],["fill-rule","evenodd","d","M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule","evenodd"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule","evenodd"],[1,"bg-white","rounded-xl","shadow-md","dark:bg-gray-800","dark:border","dark:border-gray-700","overflow-hidden"],[1,"grid","grid-cols-7","bg-gray-50","dark:bg-gray-700"],[1,"p-2","text-center"],[1,"grid","grid-cols-7"],[1,"min-h-[80px]","p-1","border-b","border-r","border-gray-200","dark:border-gray-600",3,"class"],[1,"text-xs","font-medium","text-gray-500","dark:text-gray-400"],[1,"min-h-[80px]","p-1","border-b","border-r","border-gray-200","dark:border-gray-600"],[1,"text-xs","font-medium","mb-1","w-6","h-6","flex","items-center","justify-center","rounded"],[1,"space-y-1"],[1,"w-full","text-left","px-2","py-1","rounded","text-xs","border","truncate","hover:shadow-sm","transition-shadow",3,"class"],[1,"w-full","text-left","px-2","py-1","rounded","text-xs","border","truncate","hover:shadow-sm","transition-shadow",3,"click"],[1,"font-medium","truncate"],[1,"truncate"],[1,"grid","grid-cols-8","bg-gray-50","dark:bg-gray-700","border-b","border-gray-200","dark:border-gray-600"],[1,"p-2"],[1,"p-2","text-center","border-l","border-gray-200","dark:border-gray-600"],[1,"overflow-y-auto","max-h-96"],[1,"grid","grid-cols-8","border-b","border-gray-100","dark:border-gray-700"],[1,"text-sm","font-semibold"],[1,"p-2","text-xs","font-medium","text-gray-500","dark:text-gray-400","bg-gray-50","dark:bg-gray-700"],[1,"p-1","min-h-[50px]","border-l","border-gray-100","dark:border-gray-700"],[1,"w-full","text-left","px-2","py-1","rounded","text-xs","border","mb-1","transition-colors",3,"class"],[1,"w-full","text-left","px-2","py-1","rounded","text-xs","border","mb-1","transition-colors",3,"click"],[1,"space-y-2"],[1,"flex","items-start","space-x-3","pb-3","border-b","border-gray-100","dark:border-gray-700","last:border-b-0"],[1,"text-sm","font-medium","text-gray-500","dark:text-gray-400","w-16"],[1,"flex-1","space-y-2"],[1,"w-full","text-left","p-3","rounded-lg","border-l-4","hover:shadow-md","transition-shadow",3,"class"],[1,"text-sm","text-gray-400","dark:text-gray-500","italic"],[1,"w-full","text-left","p-3","rounded-lg","border-l-4","hover:shadow-md","transition-shadow",3,"click"],[1,"flex","justify-between","items-start","mb-2"],[1,"font-semibold","text-gray-900","dark:text-white"],[1,"px-2","py-1","rounded-full","text-xs","font-medium"],[1,"space-y-1","text-sm","text-gray-600","dark:text-gray-300"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"],[1,"bg-white","rounded-xl","shadow-md","dark:bg-gray-800","p-8","text-center"],[1,"text-gray-400","dark:text-gray-500"],[1,"text-4xl","mb-4"],[1,"text-lg","font-medium","text-gray-900","dark:text-white","mb-2"],[1,"text-gray-500","dark:text-gray-400","mb-4"],[1,"bg-gradient-to-r","from-lime-400","to-green-500","hover:from-lime-500","hover:to-green-600","text-white","px-6","py-2.5","rounded-lg","font-medium","shadow-lg","transition-all","duration-200",3,"routerLink"],[1,"fixed","inset-0","bg-black","bg-opacity-50","z-50","flex","items-end","sm:items-center","justify-center","p-4",3,"click"],[1,"bg-white","dark:bg-gray-800","rounded-t-2xl","sm:rounded-2xl","w-full","max-w-lg","max-h-[90vh]","overflow-y-auto","shadow-2xl",3,"click"],[1,"sticky","top-0","bg-white","dark:bg-gray-800","px-6","py-4","border-b","border-gray-200","dark:border-gray-700","rounded-t-2xl","sm:rounded-t-2xl"],[1,"flex","items-center","justify-between"],[1,"p-2","text-gray-400","hover:text-gray-600","dark:hover:text-gray-300","rounded-lg","hover:bg-gray-100","dark:hover:bg-gray-700",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","space-y-6"],[1,"inline-flex","px-3","py-1","rounded-full","text-xs","font-medium","mb-3"],[1,"text-xl","font-bold","text-gray-900","dark:text-white"],[1,"text-gray-600","dark:text-gray-400","mt-1"],[1,"space-y-4"],[1,"bg-gray-50","dark:bg-gray-700","rounded-lg","p-4"],[1,"flex","items-center","space-x-3","mb-3"],[1,"bg-blue-100","dark:bg-blue-900/30","p-2","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600","dark:text-blue-400"],[1,"space-y-2","text-sm"],[1,"flex","justify-between"],[1,"text-gray-600","dark:text-gray-400"],[1,"font-medium"],[1,"bg-green-100","dark:bg-green-900/30","p-2","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-green-600","dark:text-green-400"],[1,"bg-purple-100","dark:bg-purple-900/30","p-2","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-purple-600","dark:text-purple-400"],[1,"sticky","bottom-0","bg-white","dark:bg-gray-800","px-6","py-4","border-t","border-gray-200","dark:border-gray-700","rounded-b-2xl","sm:rounded-b-2xl"],[1,"flex","space-x-3"],[1,"flex-1","bg-gradient-to-r","from-lime-400","to-green-500","hover:from-lime-500","hover:to-green-600","text-white","px-4","py-2.5","rounded-lg","font-medium","shadow-lg","transition-all","duration-200","text-center",3,"click"],[1,"px-4","py-2.5","text-gray-700","dark:text-gray-300","bg-gray-100","dark:bg-gray-700","hover:bg-gray-200","dark:hover:bg-gray-600","rounded-lg","font-medium","transition-colors",3,"click"],[1,"bg-orange-100","dark:bg-orange-900/30","p-2","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-orange-600","dark:text-orange-400"],[1,"bg-yellow-100","dark:bg-yellow-900/30","p-2","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-yellow-600","dark:text-yellow-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-sm","text-gray-600","dark:text-gray-400"]],template:function(e,a){e&1&&(i(0,"section",0)(1,"header",1)(2,"div",2)(3,"div",3)(4,"div",4),m(5,"img",5),i(6,"span",6),l(7,"Mi Agenda de Cirug\xEDas"),n()(),i(8,"div",7)(9,"button",8),h("click",function(){return a.refreshData()}),g(),i(10,"svg",9),m(11,"path",10),n()(),_(),i(12,"button",11),g(),i(13,"svg",12),m(14,"path",13),n(),l(15," Agenda General "),n()()(),_(),i(16,"div",14)(17,"h1",15),l(18),n(),i(19,"p",16),l(20,"Mis cirug\xEDas asignadas"),n()()()(),V(21,ne,9,0,"div",17)(22,ae,10,1,"div",17)(23,ke,25,12,"main",17)(24,Me,86,17,"div",18),n()),e&2&&(d(12),j("routerLink",A(6,K)),d(6),u(a.getCurrentPeriodTitle()),d(3),f(a.loading()?21:-1),d(),f(!a.loading()&&a.error()?22:-1),d(),f(!a.loading()&&!a.error()?23:-1),d(),f(a.showModal()&&a.selectedEventDetails()?24:-1))},dependencies:[R,B,W],styles:[".calendar-day[_ngcontent-%COMP%]{min-height:80px}.calendar-event[_ngcontent-%COMP%]{font-size:.75rem;padding:.25rem .5rem;margin-bottom:.25rem;border-radius:.375rem;border-width:1px;cursor:pointer;transition:all .15s ease-in-out}.calendar-event[_ngcontent-%COMP%]:hover{box-shadow:0 1px 3px #0000001a;transform:translateY(-1px)}.alert-urgent[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-red 2s infinite}@keyframes _ngcontent-%COMP%_pulse-red{0%,to{background-color:#ef44441a}50%{background-color:#ef444433}}@media (max-width: 640px){.calendar-day[_ngcontent-%COMP%]{min-height:70px;padding:.25rem}.calendar-event[_ngcontent-%COMP%]{font-size:.6875rem;padding:.125rem .375rem}}"]})};export{J as AgendaTecnicoComponent};
